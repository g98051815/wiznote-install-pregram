!function e(t,n,o){function r(a,l){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!l&&s)return s(a,!0);if(i)return i(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return r(n?n:e)},c,c.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){"use strict";function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function r(e){return 3*e.length/4-o(e)}function i(e){var t,n,r,i,a,l,s=e.length;a=o(e),l=new u(3*s/4-a),r=a>0?s-4:s;var d=0;for(t=0,n=0;t<r;t+=4,n+=3)i=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],l[d++]=i>>16&255,l[d++]=i>>8&255,l[d++]=255&i;return 2===a?(i=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,l[d++]=255&i):1===a&&(i=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,l[d++]=i>>8&255,l[d++]=255&i),l}function a(e){return d[e>>18&63]+d[e>>12&63]+d[e>>6&63]+d[63&e]}function l(e,t,n){for(var o,r=[],i=t;i<n;i+=3)o=(e[i]<<16)+(e[i+1]<<8)+e[i+2],r.push(a(o));return r.join("")}function s(e){for(var t,n=e.length,o=n%3,r="",i=[],a=16383,s=0,c=n-o;s<c;s+=a)i.push(l(e,s,s+a>c?c:s+a));return 1===o?(t=e[n-1],r+=d[t>>2],r+=d[t<<4&63],r+="=="):2===o&&(t=(e[n-2]<<8)+e[n-1],r+=d[t>>10],r+=d[t>>4&63],r+=d[t<<2&63],r+="="),i.push(r),i.join("")}n.byteLength=r,n.toByteArray=i,n.fromByteArray=s;for(var d=[],c=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=0,m=f.length;g<m;++g)d[g]=f[g],c[f.charCodeAt(g)]=g;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],2:[function(e,t,n){(function(t){"use strict";function o(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function r(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=a.prototype):(null===e&&(e=new a(t)),e.length=t),e}function a(e,t,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return l(this,e,t,n)}function l(e,t,n,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?g(e,t,n,o):"string"==typeof t?u(e,t,n):m(e,t)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t,n,o){return s(t),t<=0?i(e,t):void 0!==n?"string"==typeof o?i(e,t).fill(n,o):i(e,t).fill(n):i(e,t)}function c(e,t){if(s(t),e=i(e,t<0?0:0|p(t)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function u(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var o=0|T(t,n);e=i(e,o);var r=e.write(t,n);return r!==o&&(e=e.slice(0,r)),e}function f(e,t){var n=t.length<0?0:0|p(t.length);e=i(e,n);for(var o=0;o<n;o+=1)e[o]=255&t[o];return e}function g(e,t,n,o){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(o||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===o?new Uint8Array(t):void 0===o?new Uint8Array(t,n):new Uint8Array(t,n,o),a.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=a.prototype):e=f(e,t),e}function m(e,t){if(a.isBuffer(t)){var n=0|p(t.length);return e=i(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||q(t.length)?i(e,0):f(e,t);if("Buffer"===t.type&&Q(t.data))return f(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function p(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function h(e){return+e!=e&&(e=0),a.alloc(+e)}function T(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return W(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Z(e).length;default:if(o)return W(e).length;t=(""+t).toLowerCase(),o=!0}}function E(e,t,n){var o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,n);case"utf8":case"utf-8":return x(this,t,n);case"ascii":return L(this,t,n);case"latin1":case"binary":return R(this,t,n);case"base64":return w(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,t,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function v(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function b(e,t,n,o,r){if(0===e.length)return-1;if("string"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=a.from(t,o)),a.isBuffer(t))return 0===t.length?-1:y(e,t,n,o,r);if("number"==typeof t)return t=255&t,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,o,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,o,r){function i(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}var a=1,l=e.length,s=t.length;if(void 0!==o&&(o=String(o).toLowerCase(),"ucs2"===o||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;a=2,l/=2,s/=2,n/=2}var d;if(r){var c=-1;for(d=n;d<l;d++)if(i(e,d)===i(t,c===-1?0:d-c)){if(c===-1&&(c=d),d-c+1===s)return c*a}else c!==-1&&(d-=d-c),c=-1}else for(n+s>l&&(n=l-s),d=n;d>=0;d--){for(var u=!0,f=0;f<s;f++)if(i(e,d+f)!==i(t,f)){u=!1;break}if(u)return d}return-1}function A(e,t,n,o){n=Number(n)||0;var r=e.length-n;o?(o=Number(o),o>r&&(o=r)):o=r;var i=t.length;if(i%2!==0)throw new TypeError("Invalid hex string");o>i/2&&(o=i/2);for(var a=0;a<o;++a){var l=parseInt(t.substr(2*a,2),16);if(isNaN(l))return a;e[n+a]=l}return a}function C(e,t,n,o){return X(W(t,e.length-n),e,n,o)}function S(e,t,n,o){return X(K(t),e,n,o)}function N(e,t,n,o){return S(e,t,n,o)}function _(e,t,n,o){return X(Z(t),e,n,o)}function D(e,t,n,o){return X(j(t,e.length-n),e,n,o)}function w(e,t,n){return 0===t&&n===e.length?J.fromByteArray(e):J.fromByteArray(e.slice(t,n))}function x(e,t,n){n=Math.min(e.length,n);for(var o=[],r=t;r<n;){var i=e[r],a=null,l=i>239?4:i>223?3:i>191?2:1;if(r+l<=n){var s,d,c,u;switch(l){case 1:i<128&&(a=i);break;case 2:s=e[r+1],128===(192&s)&&(u=(31&i)<<6|63&s,u>127&&(a=u));break;case 3:s=e[r+1],d=e[r+2],128===(192&s)&&128===(192&d)&&(u=(15&i)<<12|(63&s)<<6|63&d,u>2047&&(u<55296||u>57343)&&(a=u));break;case 4:s=e[r+1],d=e[r+2],c=e[r+3],128===(192&s)&&128===(192&d)&&128===(192&c)&&(u=(15&i)<<18|(63&s)<<12|(63&d)<<6|63&c,u>65535&&u<1114112&&(a=u))}}null===a?(a=65533,l=1):a>65535&&(a-=65536,o.push(a>>>10&1023|55296),a=56320|1023&a),o.push(a),r+=l}return O(o)}function O(e){var t=e.length;if(t<=ee)return String.fromCharCode.apply(String,e);for(var n="",o=0;o<t;)n+=String.fromCharCode.apply(String,e.slice(o,o+=ee));return n}function L(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(127&e[r]);return o}function R(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(e[r]);return o}function I(e,t,n){var o=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>o)&&(n=o);for(var r="",i=t;i<n;++i)r+=V(e[i]);return r}function B(e,t,n){for(var o=e.slice(t,n),r="",i=0;i<o.length;i+=2)r+=String.fromCharCode(o[i]+256*o[i+1]);return r}function k(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,o,r,i){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<i)throw new RangeError('"value" argument is out of bounds');if(n+o>e.length)throw new RangeError("Index out of range")}function P(e,t,n,o){t<0&&(t=65535+t+1);for(var r=0,i=Math.min(e.length-n,2);r<i;++r)e[n+r]=(t&255<<8*(o?r:1-r))>>>8*(o?r:1-r)}function U(e,t,n,o){t<0&&(t=4294967295+t+1);for(var r=0,i=Math.min(e.length-n,4);r<i;++r)e[n+r]=t>>>8*(o?r:3-r)&255}function z(e,t,n,o,r,i){if(n+o>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,n,o,r){return r||z(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),$.write(e,t,n,o,23,4),n+4}function H(e,t,n,o,r){return r||z(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),$.write(e,t,n,o,52,8),n+8}function G(e){if(e=Y(e).replace(te,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function Y(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function V(e){return e<16?"0"+e.toString(16):e.toString(16)}function W(e,t){t=t||1/0;for(var n,o=e.length,r=null,i=[],a=0;a<o;++a){if(n=e.charCodeAt(a),n>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(a+1===o){(t-=3)>-1&&i.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&(t-=3)>-1&&i.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function K(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function j(e,t){for(var n,o,r,i=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),o=n>>8,r=n%256,i.push(r),i.push(o);return i}function Z(e){return J.toByteArray(G(e))}function X(e,t,n,o){for(var r=0;r<o&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function q(e){return e!==e}var J=e("base64-js"),$=e("ieee754"),Q=e("isarray");n.Buffer=a,n.SlowBuffer=h,n.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:o(),n.kMaxLength=r(),a.poolSize=8192,a._augment=function(e){return e.__proto__=a.prototype,e},a.from=function(e,t,n){return l(null,e,t,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(e,t,n){return d(null,e,t,n)},a.allocUnsafe=function(e){return c(null,e)},a.allocUnsafeSlow=function(e){return c(null,e)},a.isBuffer=function(e){return!(null==e||!e._isBuffer)},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,o=t.length,r=0,i=Math.min(n,o);r<i;++r)if(e[r]!==t[r]){n=e[r],o=t[r];break}return n<o?-1:o<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Q(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var o=a.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var i=e[n];if(!a.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(o,r),r+=i.length}return o},a.byteLength=T,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},a.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?x(this,0,e):E.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,o,r){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===o&&(o=0),void 0===r&&(r=this.length),t<0||n>e.length||o<0||r>this.length)throw new RangeError("out of range index");if(o>=r&&t>=n)return 0;if(o>=r)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,o>>>=0,r>>>=0,this===e)return 0;for(var i=r-o,l=n-t,s=Math.min(i,l),d=this.slice(o,r),c=e.slice(t,n),u=0;u<s;++u)if(d[u]!==c[u]){i=d[u],l=c[u];break}return i<l?-1:l<i?1:0},a.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1},a.prototype.indexOf=function(e,t,n){return b(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return b(this,e,t,n,!1)},a.prototype.write=function(e,t,n,o){if(void 0===t)o="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)o=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t=0|t,isFinite(n)?(n=0|n,void 0===o&&(o="utf8")):(o=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var i=!1;;)switch(o){case"hex":return A(this,e,t,n);case"utf8":case"utf-8":return C(this,e,t,n);case"ascii":return S(this,e,t,n);case"latin1":case"binary":return N(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),i=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ee=4096;a.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var o;if(a.TYPED_ARRAY_SUPPORT)o=this.subarray(e,t),o.__proto__=a.prototype;else{var r=t-e;o=new a(r,(void 0));for(var i=0;i<r;++i)o[i]=this[i+e]}return o},a.prototype.readUIntLE=function(e,t,n){e=0|e,t=0|t,n||k(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o},a.prototype.readUIntBE=function(e,t,n){e=0|e,t=0|t,n||k(e,t,this.length);for(var o=this[e+--t],r=1;t>0&&(r*=256);)o+=this[e+--t]*r;return o},a.prototype.readUInt8=function(e,t){return t||k(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return t||k(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return t||k(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e=0|e,t=0|t,n||k(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return r*=128,o>=r&&(o-=Math.pow(2,8*t)),o},a.prototype.readIntBE=function(e,t,n){e=0|e,t=0|t,n||k(e,t,this.length);for(var o=t,r=1,i=this[e+--o];o>0&&(r*=256);)i+=this[e+--o]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},a.prototype.readInt8=function(e,t){return t||k(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},a.prototype.readInt16LE=function(e,t){t||k(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){t||k(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return t||k(e,4,this.length),$.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return t||k(e,4,this.length),$.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return t||k(e,8,this.length),$.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return t||k(e,8,this.length),$.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,o){if(e=+e,t=0|t,n=0|n,!o){var r=Math.pow(2,8*n)-1;M(this,e,t,n,r,0)}var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,o){if(e=+e,t=0|t,n=0|n,!o){var r=Math.pow(2,8*n)-1;M(this,e,t,n,r,0)}var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t=0|t,n||M(this,e,t,1,255,0),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=0|t,n||M(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=0|t,n||M(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=0|t,n||M(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):U(this,e,t,!0),t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=0|t,n||M(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},a.prototype.writeIntLE=function(e,t,n,o){if(e=+e,t=0|t,!o){var r=Math.pow(2,8*n-1);M(this,e,t,n,r-1,-r)}var i=0,a=1,l=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===l&&0!==this[t+i-1]&&(l=1),this[t+i]=(e/a>>0)-l&255;return t+n},a.prototype.writeIntBE=function(e,t,n,o){if(e=+e,t=0|t,!o){var r=Math.pow(2,8*n-1);M(this,e,t,n,r-1,-r)}var i=n-1,a=1,l=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===l&&0!==this[t+i+1]&&(l=1),this[t+i]=(e/a>>0)-l&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t=0|t,n||M(this,e,t,1,127,-128),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t=0|t,n||M(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t=0|t,n||M(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t=0|t,n||M(this,e,t,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):U(this,e,t,!0),t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t=0|t,n||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},a.prototype.writeFloatLE=function(e,t,n){return F(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return H(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return H(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,o){if(n||(n=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-n&&(o=e.length-t+n);var r,i=o-n;if(this===e&&n<t&&t<o)for(r=i-1;r>=0;--r)e[r+t]=this[r+n];else if(i<1e3||!a.TYPED_ARRAY_SUPPORT)for(r=0;r<i;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},a.prototype.fill=function(e,t,n,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!a.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof e&&(e=255&e);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var i;if("number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var l=a.isBuffer(e)?e:W(new a(e,o).toString()),s=l.length;for(i=0;i<n-t;++i)this[i+t]=l[i%s]}return this};var te=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":1,ieee754:3,isarray:4}],3:[function(e,t,n){n.read=function(e,t,n,o,r){var i,a,l=8*r-o-1,s=(1<<l)-1,d=s>>1,c=-7,u=n?r-1:0,f=n?-1:1,g=e[t+u];for(u+=f,i=g&(1<<-c)-1,g>>=-c,c+=l;c>0;i=256*i+e[t+u],u+=f,c-=8);for(a=i&(1<<-c)-1,i>>=-c,c+=o;c>0;a=256*a+e[t+u],u+=f,c-=8);if(0===i)i=1-d;else{if(i===s)return a?NaN:(g?-1:1)*(1/0);a+=Math.pow(2,o),i-=d}return(g?-1:1)*a*Math.pow(2,i-o)},n.write=function(e,t,n,o,r,i){var a,l,s,d=8*i-r-1,c=(1<<d)-1,u=c>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,g=o?0:i-1,m=o?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(s=Math.pow(2,-a))<1&&(a--,s*=2),t+=a+u>=1?f/s:f*Math.pow(2,1-u),t*s>=2&&(a++,s/=2),a+u>=c?(l=0,a=c):a+u>=1?(l=(t*s-1)*Math.pow(2,r),a+=u):(l=t*Math.pow(2,u-1)*Math.pow(2,r),a=0));r>=8;e[n+g]=255&l,g+=m,l/=256,r-=8);for(a=a<<r|l,d+=r;d>0;e[n+g]=255&a,g+=m,a/=256,d-=8);e[n+g-m]|=128*p}},{}],4:[function(e,t,n){var o={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==o.call(e)}},{}],5:[function(e,t,n){"use strict";function o(e){return e?(e.total=!!e.total,e.dom=e.dom,e.cursor=!!e.cursor):e={dom:null,cursor:!1,total:!0},e}var r=e("./common/env"),i=e("./common/const"),a=e("./domUtils/domExtend"),l=e("./amend/amend"),s=e("./common/historyUtils"),d=e("./common/base64"),c=e("./common/wizStyle"),u=e("./rangeUtils/rangeExtend"),f=e("./tableUtils/tableCore"),g=e("./todoUtils/todoCore"),m=e("./linkUtils/linkUtils"),p=e("./imgUtils/imgUtils"),h=e("./nightMode/nightModeUtils"),T=e("./editor/base"),E=e("./editor/editorEvent"),v={version:"1.0",init:function(e){return r.init("editor",e),r.dependency.files.init(),T.init(),l.initUser(),l.setUsersData(),r.win.WizTemplate&&r.win.WizTemplate.init({document:r.doc,lang:r.options.lang,clientType:r.options.clientType}),v},on:function(e){if(r.readonly!==!1)return r.win.WizReader&&r.win.WizReader.off(),T.on(),r.win.WizTemplate&&r.win.WizTemplate.on(!1),r.options.autoFocus&&(r.win.WizTemplate?r.win.WizTemplate.focus():v.focus()),setTimeout(function(){"function"==typeof e&&e()},0),v},off:function(e,t){if(r.readonly!==!0)return r.win.WizTemplate&&r.win.WizTemplate.off(),T.off(),r.win.WizReader&&r.win.WizReader.on(e,t),v},backupCaret:function(){return u.backupCaret()},clearWizDom:function(){return a.clearChild(r.doc.body,[]),l.hideAmendInfo(),v},execCommand:function(){return a.execCommand.apply(this,arguments)},find:function(e,t,n,o){return T.find(e,t,n,o)},focus:function(){return a.focus(),v},getBodyText:function(){return a.getBodyText()},getContentHtml:function(e){return g.checkTodoStyle(),a.getContentHtml(e)},insertDefaultStyle:function(e,t){return c.insertDefaultStyle(e,t),v},insertCustomStyle:function(e,t,n){return c.insertCustomStyle(e,t,n),v},insertB64Html:function(e,t){T.insertHtml(d.decode(e),t)},insertHtml:function(e,t){T.insertHtml(e,t)},isModified:function(){return r.readonly===!1&&a.getContentHtml()!=T.getOriginalHtml()},modifySelectionDom:function(e,t){T.modifySelectionDom(e,t)},redo:function(){return s.redo(),v},removeFormat:function(e,t,n){return c.removeFormat(e,t,n),v},removeStyleById:function(e){return c.removeStyleById(e),v},replace:function(e,t,n){return T.replace(e,t,n)},replaceAll:function(e,t,n){T.replaceAll(e,t,n)},restoreCaret:function(){return u.restoreCaret()},saveSnap:function(){return s.saveSnap(!1),v},setUnModified:function(){T.setOriginalHtml()},undo:function(){return s.undo(),v},ListenerType:E.TYPE,addListener:function(e,t){return E.addListener(e,t),v},removeListener:function(e,t){return E.removeListener(e,t),v},triggerListener:function(e,t){return E.triggerListener(e,t),v},startTrackEvent:function(e,t){E.startTrackEvent(e,t)},stopTrackEvent:function(e,t){E.stopTrackEvent(e,t)},amend:{on:function(){return l.start(),v},off:function(){return l.startReverse(),v},isEdited:function(){return l.isAmendEdited()},isEditing:function(){return l.isAmendEditing()},hasAmendSpanByCursor:function(){return l.hasAmendSpanByCursor()},accept:function(e){l.accept(o(e))},refuse:function(e){l.refuse(o(e))}},img:{getAll:function(e){return p.getAll(e).join(",")},insertAsAttachment:function(e,t){T.insertDom(p.makeAttachmentDom(e,t),!0)},insertByPath:function(e){T.insertDom(p.makeDomByPath(e),!0)},removeCur:function(){var e="img["+i.ATTR.IMG_EDITING+"]";p.remove(e)},replaceCur:function(e){var t="img["+i.ATTR.IMG_EDITING+"]";p.replaceSrc(t,e)}},link:{on:function(){m.on()},off:function(){m.off()},getCurrentLink:function(){return m.getCurrentLink()},removeSelectedLink:function(){m.removeSelectedLink()},setCurrentLink:function(e){m.setCurrentLink(e)}},table:{canCreateTable:f.canCreateTable,clearCellValue:f.clearCellValue,deleteCols:f.deleteCols,deleteRows:f.deleteRows,deleteTable:f.deleteTable,distributeCols:f.distributeCols,insertCol:f.insertCol,insertRow:f.insertRow,insertTable:f.insertTable,merge:f.merge,setCellAlign:f.setCellAlign,setCellBg:f.setCellBg,split:f.split},todo:{setTodo:g.setTodo,setTodoInfo:g.setTodoInfo},nightMode:{on:function(e,t,n){h.on(e,t,n)},off:function(){h.off()}},utils:{clearStyleFromHtml:function(e,t){return a.clearStyleFromHtml(e,t)}}};window.WizEditor=v,t.exports=v},{"./amend/amend":7,"./common/base64":14,"./common/const":15,"./common/env":17,"./common/historyUtils":18,"./common/wizStyle":22,"./domUtils/domExtend":26,"./editor/base":27,"./editor/editorEvent":28,"./imgUtils/imgUtils":34,"./linkUtils/linkUtils":35,"./nightMode/nightModeUtils":39,"./rangeUtils/rangeExtend":41,"./tableUtils/tableCore":44,"./todoUtils/todoCore":49}],6:[function(e,t,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=e("./common/env"),i=e("./common/const"),a=e("./common/utils"),l=(e("./common/base64"),e("./common/wizStyle")),s=e("./imgUtils/imgUtils"),d=e("./nightMode/nightModeUtils"),c=e("./amend/amendInfo"),u=e("./amend/amendUser"),f=e("./todoUtils/todoCore"),g=e("./highlightUtils/highlightUtils"),m=e("./reader/base"),p=e("./markdown/markdownRender"),h={init:function(e){return r.init("reader",e),r.dependency.files.init(),m.init(),p.init(),r.options.noAmend||(u.initUser(r.options.userInfo),u.setUsersData(r.options.usersData)),r.win.WizTemplate&&r.win.WizTemplate.init({document:r.doc,lang:r.options.lang,clientType:r.options.clientType}),h},on:function(e,t){return e&&e.noteType&&(r.options.noteType=e.noteType),r.options.pc.pluginModified=!1,m.on(),h.amendInfo.on(),r.win.WizTemplate&&r.win.WizTemplate.on(!0),r.options.noteType==i.NOTE_TYPE.MARKDOWN?h.markdown(t):r.options.noteType==i.NOTE_TYPE.MATHJAX?h.mathJax(t):setTimeout(function(){"function"==typeof t&&t()},0),h},off:function(){return g.off(),h.amendInfo.off(),r.win.WizTemplate&&r.win.WizTemplate.off(),m.off(),h},closeDocument:function(){return f.closeDocument()},getWordCount:function(){var e=r.doc.body.innerText?r.doc.body.innerText:"",t=a.getWordCount(e);return JSON.stringify(t)},highlight:{next:function(){g.next()},on:function(e,t){return g.on(e,t)},off:function(){g.off()},previous:function(){g.previous()}},insertDefaultStyle:function(e,t){return l.insertDefaultStyle(e,t),h},insertCustomStyle:function(e,t,n){return l.insertCustomStyle(e,t,n),h},removeStyleById:function(e){return l.removeStyleById(e),h},markdown:function(e,t){t=t?t:r.options.timeout.markdown,e=e||r.options.callback.markdown;var n=!1,a=function(){e&&/^function$/i.test("undefined"==typeof e?"undefined":o(e))&&!n&&(e(),n=!0)};p.markdown({markdown:function(e){r.client.sendCmdToWiznote(i.CLIENT_EVENT.WizMarkdownRender),e?setTimeout(a,t):a()},mathJax:function(){a()}})},mathJax:function(e,t){t=t?t:r.options.timeout.mathJax,e=e||r.options.callback.mathJax;var n=!1,o=function(){e&&!n&&(e(),n=!0)};setTimeout(o,t),p.mathJax(function(){o()})},setPluginModify:function(e){return r.options.pc.pluginModified?r.options.pc.pluginModified:(r.options.noteType==i.NOTE_TYPE.COMMON&&(r.options.pc.pluginModified=!!e),r.options.pc.pluginModified)},amendInfo:{on:function(){return r.options.noAmend?h:(c.init({readonly:!0},{onAccept:null,onRefuse:null}),h)},off:function(){return c.remove(),h}},img:{getAll:function(e){return s.getAll(e).join(",")}},todo:{setTodoInfo:f.setTodoInfo,onCheckDocLock:f.onCheckDocLock},nightMode:{on:function(e,t,n){d.on(e,t,n)},off:function(){d.off()}}};window.WizReader=h,t.exports=h},{"./amend/amendInfo":8,"./amend/amendUser":9,"./common/base64":14,"./common/const":15,"./common/env":17,"./common/utils":21,"./common/wizStyle":22,"./highlightUtils/highlightUtils":30,"./imgUtils/imgUtils":34,"./markdown/markdownRender":38,"./nightMode/nightModeUtils":39,"./reader/base":42,"./todoUtils/todoCore":49}],7:[function(e,t,n){"use strict";function o(){function e(e,t){if(!e)return!1;var n=d.getLastDeepChild(e),o=d.getParentByFilter(n,function(e){return e==t},!0);return!!o}var t,n,o,i,a=!1;return t=m.getRange(),n=r.doc.queryCommandValue("formatBlock"),/^h[1-6]+$/i.test(n)&&t&&t.startOffset==d.getEndOffset(t.startContainer)&&(o=d.getParentByTagName(t.startContainer,n,!0),a=e(o,t.startContainer)),!(!a||!o)&&(i=r.doc.createElement("div"),i.appendChild(r.doc.createElement("br")),d.after(i,o),m.setRange(i,0),!0)}var r=e("../common/env"),i=e("../common/const"),a=e("../common/lang"),l=a.getLang(),s=e("../common/utils"),d=e("../domUtils/domExtend"),c=e("./amendUtils/amendExtend"),u=e("./amendUser"),f=e("./amendInfo"),g=e("../common/historyUtils"),m=e("../rangeUtils/rangeExtend"),p=e("../wizBlockUtils/wizBlockUtils"),h=e("../tableUtils/tableCore"),T=e("../tableUtils/tableUtils"),E=e("../todoUtils/todoCore");!function(){var e=d.modifyNodeStyle;d.modifyNodeStyle=function(t,n,o){var r;return 1==t.nodeType&&o&&o[i.ATTR.SPAN_DELETE]&&d.isTag(t,"img")?(c.deleteImg(t,u.getCurUser()),t):1==t.nodeType&&o&&o[i.ATTR.SPAN_DELETE]&&d.isEmptyDom(t)?(r=t.parentNode,r.removeChild(t),d.removeEmptyParent(r),t):1==t.nodeType&&o&&o[i.ATTR.SPAN_DELETE]&&d.isSelfClosingTag(t)?t:o&&o[i.ATTR.SPAN_DELETE]&&c.getWizDeleteParent(t)?t:e(t,n,o)};var t=d.addDomForGetDomList;d.addDomForGetDomList=function(e,n){c.isWizDelete(n)||3==n.nodeType&&!d.getParentByTagName(n,["td","th"],!1,null)&&d.getParentByTagName(n,"table",!1,null)||t(e,n);
}}();var v=!1,b={initUser:function(){u.initUser(r.options.userInfo)},setUsersData:function(){u.setUsersData(r.options.usersData)},start:function(){v=!0,b.stopReverse(),y.bind(),b.startAmendInfo(),r.event.add(i.EVENT.BEFORE_SAVESNAP,y.onBeforeSaveSnap),r.event.add(i.EVENT.AFTER_RESTORE_HISTORY,y.onAfterRestoreHistory)},stop:function(){v=!1,y.unbind(),f.remove(),!b.isAmendEdited(),r.event.remove(i.EVENT.BEFORE_SAVESNAP,y.onBeforeSaveSnap),r.event.remove(i.EVENT.AFTER_RESTORE_HISTORY,y.onAfterRestoreHistory)},startReverse:function(){b.stop(),y.bindReverse(),b.startAmendInfo()},stopReverse:function(){y.unbindReverse(),f.remove(),!b.isAmendEdited()},startAmendInfo:function(e){f.init(e,{onAccept:y.onAccept,onRefuse:y.onRefuse})},stopAmendInfo:function(){f.remove()},hideAmendInfo:function(){f.hide(!0)},isAmendEdited:function(){return c.isAmendEdited()},isAmendEditing:function(){return v},hasAmendSpanByCursor:function(){var e=c.getAmendDoms({selection:!0,selectAll:!1});return e.insertList.length>0||e.deleteList.length>0||e.deletedInsertList.length>0},accept:function(e){var t,n=r.doc.getSelection(),o={};if(e.total)o.selection=!0,o.selectAll=!0;else if(e.dom&&!e.isSelection)o.domList=c.getSameTimeStampDom(e.dom),o.selection=!1;else{if(0===n.rangeCount)return;o.selection=!0,o.selectAll=!1}g.saveSnap(!1),t=o.selection&&!o.selectAll?c.getSelectedAmendDoms():c.getAmendDoms(o),t&&(c.splitSelectedAmendDoms(t),c.wizAmendDelete(t.deleteList),c.wizAmendDelete(t.deletedInsertList),c.wizAmendSave(t.insertList)),d.clearChild(r.doc.body,[])},refuse:function(e){var t,n=r.doc.getSelection(),o={};if(e.total)o.selection=!0,o.selectAll=!0;else if(e.dom&&!e.isSelection)o.domList=c.getSameTimeStampDom(e.dom),o.selection=!1;else{if(0===n.rangeCount)return;o.selection=!0,o.selectAll=!1}if(g.saveSnap(!1),t=o.selection&&!o.selectAll?c.getSelectedAmendDoms():c.getAmendDoms(o)){c.splitSelectedAmendDoms(t);var i=t.deletedInsertList.length>0&&0==t.deleteList.length&&0==t.insertList.length;c.wizAmendSave(t.deleteList),i&&c.wizAmendSave(t.deletedInsertList),c.wizAmendDelete(t.insertList),i||c.wizAmendDelete(t.deletedInsertList)}d.clearChild(r.doc.body,[])},splitAmendDomByRange:function(e){return c.splitAmendDomByRange(e)},getFragmentForCopy:function(e){var t,n=m.getRange(),o=null;return!n||n.collapsed?o:(t=d.getParentRoot([n.startContainer,n.endContainer]),b.isAmendEditing()&&t&&t.getAttribute(i.ATTR.SPAN_DELETE)==u.getCurUser().hash?alert(e?l.Err.Cut_Null:l.Err.Copy_Null):(o=r.doc.createElement("div"),o.appendChild(n.cloneContents())),o)},fragmentFilter:function(e){var t,n,o;if(!e)return!1;for(t=e.querySelectorAll("span["+i.ATTR.SPAN_DELETE+'="'+u.getCurUser().hash+'"]'),n=t.length-1;n>=0;n--)o=t[n],o.parentNode.removeChild(o)},readyForPaste:function(){var e,t,n,o,a,l,s,f,g,p,h,T,E,v,y,A,C=r.doc.getSelection();0!==C.rangeCount&&(C.isCollapsed||(e=C.getRangeAt(0),t=d.getParentByTagName(e.endContainer,["td","th"],!0,null),c.removeSelection(u.getCurUser()),c.removeUserDel(null,u.getCurUser())),e=C.getRangeAt(0),n=e.endContainer,o=e.endOffset,d.isTag(n,["td","th"])&&0===o&&t!==n&&(n=t,o=d.getEndOffset(n)),v=c.splitInsertDom(n,o,!0,u.getCurUser()),a=(new Date).valueOf(),l=c.createDomForPaste(a),s=l.start,f=l.content,g=l.end,y=c.getWizAmendImgParent(n),v.split?(3==n.nodeType&&(n=n.parentNode),d.before([s,f,g],n,o>0)):y?d.after([s,f,g],y):1==n.nodeType?(A=!1,d.isTag(n,["td","th"])&&(d.isEmptyDom(n)&&(n.innerHTML="",n.appendChild(d.createSpan())),A=!0),o<n.childNodes.length?d.before([s,f,g],n.childNodes[o]):A?(n.appendChild(s),n.appendChild(f),n.appendChild(g)):d.after([s,f,g],n)):3==n.nodeType&&(c.splitDeletedDom(n,o)?d.after([s,f,g],n.parentNode):o<n.nodeValue.length?(E=r.doc.createTextNode(n.nodeValue.substr(o)),n.nodeValue=n.nodeValue.substr(0,o),d.after([s,f,g,E],n)):(h=d.getParentByTagName(n,"a",!0,null),p=n.nextSibling,h?d.after([s,f,g],h):p?d.before([s,f,g],p):(T=n.parentNode,T.insertBefore(s,null),T.insertBefore(f,null),T.insertBefore(g,null)))),m.setRange(f.childNodes[0],0,f.childNodes[0],1),setTimeout(function(){g=r.doc.querySelector("span["+i.ATTR.SPAN_PASTE_TYPE+'="'+i.TYPE.PASTE.END+'"]['+i.ATTR.SPAN_PASTE_ID+'="'+g.getAttribute(i.ATTR.SPAN_PASTE_ID)+'"]'),b.fixPaste(s,g,u.getCurUser())},200))},fixPaste:function(e,t,n){c.modifyDomForPaste(e,t,n)}},y={bind:function(){y.unbind(),r.event.add(i.EVENT.ON_KEY_DOWN,y.onKeyDown),r.event.add(i.EVENT.ON_COMPOSITION_START,y.onCompositionStart),r.event.add(i.EVENT.ON_COMPOSITION_END,y.onCompositionEnd),r.client.type.isIOS||r.client.type.isAndroid?r.event.add(i.EVENT.ON_TOUCH_START,y.onTouchStart):(r.event.add(i.EVENT.ON_MOUSE_DOWN,y.onMouseDown),r.event.add(i.EVENT.ON_MOUSE_UP,y.onMouseUp)),r.event.add(i.EVENT.ON_DRAG_START,y.onDragDrop),r.event.add(i.EVENT.ON_DRAG_ENTER,y.onDragDrop),r.event.add(i.EVENT.ON_DROP,y.onDragDrop)},unbind:function(){r.event.remove(i.EVENT.ON_KEY_DOWN,y.onKeyDown),r.event.remove(i.EVENT.ON_COMPOSITION_START,y.onCompositionStart),r.event.remove(i.EVENT.ON_COMPOSITION_END,y.onCompositionEnd),r.event.remove(i.EVENT.ON_MOUSE_DOWN,y.onMouseDown),r.event.remove(i.EVENT.ON_MOUSE_UP,y.onMouseUp),r.event.remove(i.EVENT.ON_TOUCH_START,y.onTouchStart),r.event.remove(i.EVENT.ON_DRAG_START,y.onDragDrop),r.event.remove(i.EVENT.ON_DRAG_ENTER,y.onDragDrop),r.event.remove(i.EVENT.ON_DROP,y.onDragDrop)},bindReverse:function(){y.unbindReverse(),r.event.add(i.EVENT.ON_KEY_DOWN,y.onKeyDown),r.event.add(i.EVENT.ON_COMPOSITION_START,y.onCompositionStart),r.event.add(i.EVENT.ON_COMPOSITION_END,y.onCompositionEnd),!r.client.type.isIOS&&r.client.type.isAndroid&&(r.event.add(i.EVENT.ON_MOUSE_DOWN,y.onMouseDown),r.event.add(i.EVENT.ON_MOUSE_UP,y.onMouseUp))},unbindReverse:function(){r.event.remove(i.EVENT.ON_KEY_DOWN,y.onKeyDown),r.event.remove(i.EVENT.ON_COMPOSITION_START,y.onCompositionStart),r.event.remove(i.EVENT.ON_COMPOSITION_END,y.onCompositionEnd),r.event.remove(i.EVENT.ON_MOUSE_DOWN,y.onMouseDown),r.event.remove(i.EVENT.ON_MOUSE_UP,y.onMouseUp)},onAccept:function(e){b.accept(e)},onRefuse:function(e){b.refuse(e)},onBeforeSaveSnap:function(){f.hide(!0)},onAfterRestoreHistory:function(){b.startAmendInfo()},onCompositionStart:function(){i.COMPOSITION_START=!0},onCompositionEnd:function(){i.COMPOSITION_START=!1,setTimeout(function(){g.saveSnap(!0)},0)},onDragDrop:function(e){return s.stopEvent(e),!1},onKeyDown:function(e){var t=e.keyCode||e.which,n=r.doc.getSelection();8!==t&&46!==t||m.clearFillCharByCollapsed(),h.onKeyDown(e)&&E.onKeyDown(e)&&(0===n.rangeCount||i.COMPOSITION_START||(b.isAmendEditing()?y.onKeyDownAmend(e):y.onKeyDownReverse(e)))},onKeyDownAmend:function(e){var t,n,a,l,f,p,h,T,E,v,b,y=e.keyCode||e.which,A=r.doc.getSelection();if(8===y)return g.saveSnap(!1),A.isCollapsed?(m.selectCharIncludeFillChar(!0),c.removeSelection(u.getCurUser()),b=m.getRangeParentRoot(),A.collapseToStart(),t=A.getRangeAt(0),n=t.startContainer,3==n.nodeType&&(n=n.parentNode),c.removeUserDel(b,u.getCurUser()),A.collapseToStart()):(c.removeSelection(u.getCurUser()),c.removeUserDel(null,u.getCurUser()),A.collapseToStart()),m.caretFocus(),void s.stopEvent(e);if(46===y)return g.saveSnap(!1),A.isCollapsed&&m.selectCharIncludeFillChar(!1),c.removeSelection(u.getCurUser()),c.removeUserDel(null,u.getCurUser()),A.collapseToEnd(),m.caretFocus(),void s.stopEvent(e);if(!s.checkNonTxtKey(e)){var C,S;if(g.saveSnap(!1),A.isCollapsed||(c.removeSelection(u.getCurUser()),c.removeUserDel(null,u.getCurUser())),t=A.getRangeAt(0),n=t.endContainer,a=t.endOffset,13===y){var N=c.getWizDeleteParent(n),_=c.getWizInsertParent(n),D=!!_&&c.getWizAmendImgParent(n),w=N||_;if(w&&1===w.childNodes.length&&(!d.isUsableTextNode(w.childNodes[0])||1===w.childNodes[0].nodeType&&d.isTag(w.childNodes[0],"br")))!function(){var e=w.parentNode,t=r.doc.createElement("br");e.insertBefore(t,w),e.removeChild(w),m.setRange(t,1,t,1)}();else if(_&&D)!function(){var e=d.createSpan();e.innerHTML=i.FILL_CHAR,d.after(e,_),m.setRange(e,1,e,1)}();else if(_)!function(){var e=d.createSpan();e.innerHTML=i.FILL_CHAR,C=c.splitInsertDom(n,a,!0,u.getCurUser()),C.isInsert&&C.split?(d.after(e,_),m.setRange(e,1,e,1)):C.isInsert&&(d.before(e,_,a>0),m.setRange(e,1,e,1))}();else if(N)!function(){var e=d.createSpan();e.innerHTML=i.FILL_CHAR,C=c.splitDeletedDom(n,a),C?(d.after(e,N),m.setRange(e,1,e,1)):(d.before(e,N,a>0),m.setRange(e,1,e,1))}();else if(o())return void s.stopEvent(e);return void A.collapseToEnd()}if(C=c.splitInsertDom(n,a,!1,u.getCurUser()),S=c.getWizAmendImgParent(n),C.isInsert&&!C.split&&!S)return 0===a&&1===C.insertDom.nodeType?(d.before(r.doc.createTextNode(i.FILL_CHAR),C.insertDom.childNodes[0]),m.setRange(C.insertDom,1,null,null)):m.setRange(n,a,null,null),t=A.getRangeAt(0),void(9===y&&(t.insertNode(d.getTab()),A.modify("move","forward","character"),A.modify("move","forward","character"),A.modify("move","forward","character"),A.modify("move","forward","character"),s.stopEvent(e)));l=c.createDomForInsert(u.getCurUser()),C.split?(3==n.nodeType&&(n=n.parentNode),d.before(l,n,a>0)):S?d.after(l,S):1==n.nodeType?a<n.childNodes.length?n.getAttribute(i.ATTR.SPAN)&&(0===n.childNodes.length||1===n.childNodes.length&&d.isTag(n.childNodes[0],"br"))?(d.before(l,n),n.parentNode.removeChild(n)):d.before(l,n.childNodes[a]):d.isTag(n,["td","th"])||d.hasClass(n,i.CLASS.TODO_MAIN)?(d.isEmptyDom(n)&&(n.innerHTML=""),n.appendChild(l)):d.after(l,n):3==n.nodeType&&(c.splitDeletedDom(n,a)?d.after(l,n.parentNode):a<n.nodeValue.length?(E=n.nodeValue.substr(a),v=r.doc.createTextNode(E),n.nodeValue=n.nodeValue.substr(0,a),d.after([l,v],n)):(p=d.getParentByTagName(n,"a",!0,null),T=p?d.getNextNode(n):null,h=T?d.getParentByTagName(T,"a",!0,null):null,f=n.nextSibling,p&&p!==h?d.after(l,p):f?d.before(l,f):n.parentNode.insertBefore(l,null))),9===y?(l.appendChild(d.getTab()),m.setRange(l,2,null,null),s.stopEvent(e)):m.setRange(l.childNodes[0],1,null,null)}},onKeyDownReverse:function(e){function t(e,t){if(e){var n,o;o=c.getWizAmendParent(e),o&&1===o.childNodes.length&&(n=d.createSpan(),n.innerHTML=i.FILL_CHAR+i.FILL_CHAR,d.before(n,o,t>0),o.parentNode.removeChild(o),m.setRange(n,t>0?0:2,n,1))}}var n=e.keyCode||e.which,a=r.doc.getSelection(),l=c.fixedAmendRange();if(8===n)return g.saveSnap(!1),void(a.isCollapsed&&l.leftDom&&(l.startImg=c.getWizAmendImgParent(l.leftDom),l.startImg?(l.startDom=l.startImg,l.startOffset=0,m.setRange(l.startDom,l.startOffset,l.endDom,l.endOffset)):3===l.leftDom.nodeType&&1==l.leftDom.nodeValue.length&&t(l.leftDom,-1)));if(46===n)return g.saveSnap(!1),void(a.isCollapsed&&l.rightDom&&(l.endImg=c.getWizAmendImgParent(l.rightDom),l.endImg?(l.endDom=l.endImg,l.endOffset=l.endImg.childNodes.length,m.setRange(l.startDom,l.startOffset,l.endDom,l.endOffset)):3===l.rightDom.nodeType&&1==l.rightDom.nodeValue.length&&t(l.rightDom,1)));if(!s.checkNonTxtKey(e)){g.saveSnap(!1),b.splitAmendDomByRange(l);var u=T.checkCaretInTableContainer();return p.insertEmptyLine(u.tableContainer,u.after),13===n&&o()?void s.stopEvent(e):void 0}},onMouseDown:function(e){var t=f.isInfo(e.target);t&&s.stopEvent(e),f.stop()},onMouseUp:function(e){f.start()},onTouchStart:function(e){}};t.exports=b},{"../common/const":15,"../common/env":17,"../common/historyUtils":18,"../common/lang":19,"../common/utils":21,"../domUtils/domExtend":26,"../rangeUtils/rangeExtend":41,"../tableUtils/tableCore":44,"../tableUtils/tableUtils":47,"../todoUtils/todoCore":49,"../wizBlockUtils/wizBlockUtils":53,"./amendInfo":8,"./amendUser":9,"./amendUtils/amendExtend":11}],8:[function(e,t,n){"use strict";function o(){var e,t=u.doc.getElementById(f.ID.AMEND_INFO);return t&&t.parentNode.removeChild(t),t=u.doc.createElement("div"),e=u.doc.createElement("div"),h.setContenteditable(e,!1),t.appendChild(e),t.id=f.ID.AMEND_INFO,h.css(t,{position:"absolute","z-index":f.CSS.Z_INDEX.amendInfo,display:"none",padding:"6px","font-family":'"Microsoft Yahei","微软雅黑",Helvetica,SimSun,SimHei'}),e.innerHTML=r(),h.css(e,{"background-color":"white",padding:"0px","font-size":"12px",border:"1px solid #D8D8D8","-webkit-border-radius":"4px","-moz-border-radius":"4px","-border-radius":"4px","-webkit-box-shadow":"rgba(0, 0, 0, 0.24) 0px 3px 3px","-moz-box-shadow":"rgba(0, 0, 0, 0.24) 0px 3px 3px","box-shadow":"rgba(0, 0, 0, 0.24) 0px 3px 3px","min-width":"160px","max-width":"280px","min-height":"50px"}),C.template.appendChild(t),t}function r(){return u.client.type.isIOS||u.client.type.isMac||u.client.type.isAndroid?'<div id="'+f.ID.AMEND_INFO_SINGLE+'" style="display:none; padding: 8px 16px;"><img id="'+f.ID.AMEND_INFO_IMG+'" class="'+f.CLASS.IMG_NOT_DRAG+'" style="width: 40px; height: 40px !important; position: absolute; -webkit-border-radius: 40px;-moz-border-radius:40px;border-radius:40px;"><ul style="list-style-type: none;margin: 4px 0 0 50px;padding-left: 0;"><li style="line-height: 18px;white-space: nowrap;padding: 2px 0;"><span id="'+f.ID.AMEND_INFO_NAME+'" style="color:#000;font-size:12px;font-weight:bold;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:inline-block;"></span><span id="'+f.ID.AMEND_INFO_CONTENT+'" style="color:#000;font-size:12px;margin-left:.5em;display:inline-block;overflow:hidden;float:right"></span></li><li style="line-height: 18px;text-align: right;"><span id="'+f.ID.AMEND_INFO_TIME+'" style="color:#A3A3A3;font-size:12px;"></span></li></ul></div><div id="'+f.ID.AMEND_INFO_MULTI+'" style="display:none; padding: 8px 16px;"><p style="margin: 4px 16px;">'+p.Amend.MultiInfo+'</p></div><div id="'+f.ID.AMEND_INFO_TOOLS+'" style="padding:0;margin:0;box-sizing: border-box;"><div style="line-height: 26px;width: 50%;display:inline-block;text-align: center;padding:0 8px;margin:0;box-sizing: border-box;"><a id="'+f.ID.AMEND_INFO_REFUSE+'" href="javascript:void(0);" style="font-size:12px;display:block;cursor:pointer;color:#447BD8;text-decoration: blink;">'+p.Amend.BtnRefuse+'</a></div><div style="line-height: 26px;width: 50%;display:inline-block;text-align: center;padding:0 8px;margin:0;box-sizing: border-box;"><a id="'+f.ID.AMEND_INFO_ACCEPT+'" href="javascript:void(0);" style="font-size:12px;display:block;cursor:pointer;color:#447BD8;text-decoration: blink;">'+p.Amend.BtnAccept+"</a></div></div>":'<div id="'+f.ID.AMEND_INFO_SINGLE+'" style="display:none; padding: 8px 16px;"><img id="'+f.ID.AMEND_INFO_IMG+'" class="'+f.CLASS.IMG_NOT_DRAG+'" style="width: 40px; height: 40px !important; position: absolute;"><ul style="list-style-type: none;margin: 4px 0 0 50px;padding-left: 0;"><li style="line-height: 18px;white-space: nowrap;padding: 2px 0;"><span id="'+f.ID.AMEND_INFO_NAME+'" style="color:#000;font-size:12px;font-weight:bold;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:inline-block;"></span><span id="'+f.ID.AMEND_INFO_CONTENT+'" style="color:#000;font-size:12px;margin-left:.5em;display:inline-block;overflow:hidden;float:right"></span></li><li style="line-height: 18px;text-align: right;"><span id="'+f.ID.AMEND_INFO_TIME+'" style="color:#A3A3A3;font-size:12px;"></span></li></ul></div><div id="'+f.ID.AMEND_INFO_MULTI+'" style="display:none; padding: 8px 16px;"><p style="margin: 4px 16px;">'+p.Amend.MultiInfo+'</p></div><div id="'+f.ID.AMEND_INFO_TOOLS+'" style="padding:0;margin:0;box-sizing:border-box;border-top:1px solid #D8D8D8"><div style="line-height: 26px;width: 50%;display:inline-block;text-align: center;padding:0 8px;margin:0;box-sizing: border-box;border-right: 1px solid #D8D8D8"><a id="'+f.ID.AMEND_INFO_ACCEPT+'" href="javascript:void(0);" style="font-size:12px;display:block;cursor:pointer;color:#447BD8;text-decoration: blink;">'+p.Amend.BtnAccept+'</a></div><div style="line-height: 26px;width: 50%;display:inline-block;text-align: center;padding:0 8px;margin:0;box-sizing: border-box;"><a id="'+f.ID.AMEND_INFO_REFUSE+'" href="javascript:void(0);" style="font-size:12px;display:block;cursor:pointer;color:#447BD8;text-decoration: blink;">'+p.Amend.BtnRefuse+"</a></div></div>"}function i(){return{dom:C.cur,isSelection:!!C.isSelection}}function a(e){var t=C.cur,n=t.getAttribute(f.ATTR.SPAN_USERID),o=E.getUserByGuid(n),r=o?o.name:p.Amend.UserNameDefault,i=t.getAttribute(f.ATTR.SPAN_TIMESTAMP),a=!!t.getAttribute(f.ATTR.SPAN_DELETE),o=E.getUserByGuid(n);i=i.substring(0,i.length-3),C.curPos=e,C.img.src=o?o.imgUrl:"",C.name.innerText=r,C.name.setAttribute("title",r),C.content.innerText=a?p.Amend.Delete:p.Amend.Edit,C.time.innerText=i,C.multiUser.style.display="none",C.singleUser.style.display="block"}function l(e){C.curPos=e,C.singleUser.style.display="none",C.multiUser.style.display="block"}function s(e){C.main.parentNode==C.template&&(u.doc.body.appendChild(C.main),C.singleUser=u.doc.getElementById(f.ID.AMEND_INFO_SINGLE),C.multiUser=u.doc.getElementById(f.ID.AMEND_INFO_MULTI),C.img=u.doc.getElementById(f.ID.AMEND_INFO_IMG),C.name=u.doc.getElementById(f.ID.AMEND_INFO_NAME),C.content=u.doc.getElementById(f.ID.AMEND_INFO_CONTENT),C.time=u.doc.getElementById(f.ID.AMEND_INFO_TIME),C.tools=u.doc.getElementById(f.ID.AMEND_INFO_TOOLS),C.btnAccept=u.doc.getElementById(f.ID.AMEND_INFO_ACCEPT),C.btnRefuse=u.doc.getElementById(f.ID.AMEND_INFO_REFUSE)),C.cur?a(e):l(e),S.bindInfoBtn(),C.readonly?C.tools.style.display="none":C.tools.style.display="block",h.css(C.main,{top:"0px",left:"0px",display:"block",visibility:"hidden"}),h.setLayout({layerObj:C.main,target:e,layout:f.TYPE.POS.upLeft,fixed:!1,noSpace:!1,reverse:!0}),h.css(C.main,{display:"block",visibility:"visible"})}function d(){C.main&&(S.unbindInfoBtn(),C.cur=null,C.curPos=null,C.isMulti=!1,C.isSelection=!1,C.img.src="",C.name.innerText="",C.name.setAttribute("title",""),C.content.innerText="",h.css(C.main,{display:"none"}),C.template.appendChild(C.main))}function c(){var e=u.doc.getElementById(f.ID.AMEND_INFO);e&&e.parentNode.removeChild(e)}var u=e("../common/env"),f=e("../common/const"),g=e("../common/utils"),m=e("../common/lang"),p=m.getLang(),h=e("../domUtils/domBase"),T=e("./amendUtils/amendBase"),E=e("./amendUser"),v=e("../common/wizUserAction"),b={onAccept:null,onRefuse:null},y=!1,A={x:null,y:null},C={cur:null,curPos:null,isMulti:!1,isSelection:!1,template:null,main:null,img:null,name:null,content:null,time:null,btnAccept:null,btnRefuse:null,init:function(e,t){C.template=u.doc.createElement("div"),C.main=o(),C.readonly=!(!e||!e.readonly),h.setContenteditable(C.main,!1),t&&t.onAccept&&(b.onAccept=t.onAccept),t&&t.onRefuse&&(b.onRefuse=t.onRefuse),S.unbind(),S.bind()},remove:function(){S.unbind(),c(),C.main=null,C.img=null,C.name=null,C.content=null,C.time=null,C.btnAccept=null,C.btnRefuse=null},show:function(e,t){clearTimeout(C.showTimer),clearTimeout(C.hideTimer);var n=g.isArray(e),o=n&&e.length>1,r=n?o?null:e[0]:e,i=!1;C.isSelection=n,C.isMulti!==o||r!==C.cur?(C.hide(!0),i=!0):(!C.curPos||Math.abs(C.curPos.left-t.left)>75||Math.abs(C.curPos.top-t.top)>24)&&(i=!0),i&&(C.showTimer=setTimeout(function(){C.isMulti=o,C.cur=r,s(t)},2*f.AMEND.INFO_TIMER))},hide:function(e){clearTimeout(C.showTimer),clearTimeout(C.hideTimer),(C.cur||C.isMulti)&&(e?d():C.hideTimer=setTimeout(d,f.AMEND.INFO_TIMER))},isInfo:function(e){var t=h.getParentByFilter(e,function(e){return e==C.main},!0);return!!t},start:function(){y=!1},stop:function(){C.hide(!0),y=!0}},S={bind:function(){u.client.type.isIOS||u.client.type.isAndroid?(u.event.add(f.EVENT.ON_TOUCH_START,S.handler.onTouchstart),u.event.add(f.EVENT.ON_TOUCH_END,S.handler.onMouseMove)):u.event.add(f.EVENT.ON_MOUSE_MOVE,S.handler.onMouseMove)},unbind:function(){u.event.remove(f.EVENT.ON_TOUCH_START,S.handler.onTouchstart),u.event.remove(f.EVENT.ON_TOUCH_END,S.handler.onMouseMove),u.event.remove(f.EVENT.ON_MOUSE_MOVE,S.handler.onMouseMove)},bindInfoBtn:function(){S.unbindInfoBtn(),u.client.type.isIOS||u.client.type.isAndroid?C.main.addEventListener("touchend",S.handler.onClick):C.main.addEventListener("click",S.handler.onClick)},unbindInfoBtn:function(){u.client.type.isIOS||u.client.type.isAndroid?C.main.removeEventListener("touchend",S.handler.onClick):C.main.removeEventListener("click",S.handler.onClick)},handler:{onMouseMove:function(e){var t=g.getEventClientPos(e);if((A.x!==t.x||A.y!==t.y)&&(A=t,!y)){var n,o=e.target,r=C.isInfo(o),i={width:20,height:20};if(r)return clearTimeout(C.showTimer),void clearTimeout(C.hideTimer);var a,l=u.doc.getSelection(),s=T.getWizDeleteParent(o)||T.getWizInsertParent(o);!l.isCollapsed&&s&&l.containsNode(s,!0)&&(a=l.isCollapsed?null:T.getAmendDoms({selection:!0,selectAll:!1})),a&&(a=a.deletedInsertList.concat(a.insertList,a.deleteList),0===a.length&&(a=null));var d;a||s?(d=parseInt(u.win.getComputedStyle(s)["font-size"]),isNaN(d)&&(d=14),n=h.getPageScroll(),i.left=t.x+n.left,i.top=t.y+n.top-d,i.top<s.offsetTop&&(i.top=s.offsetTop),C.show(a||s,i)):C.hide(!1)}},onTouchstart:function(e){var t=e.target,n=C.isInfo(t);n||C.hide(!1)},onClick:function(e){var t;t=e.changedTouches?e.changedTouches[0].target:e.target,t.id==f.ID.AMEND_INFO_ACCEPT?S.handler.onAccept(e):t.id==f.ID.AMEND_INFO_REFUSE&&S.handler.onRefuse(e),g.stopEvent(e)},onAccept:function(e){b.onAccept&&b.onAccept(i()),C.hide(!0),v.save(v.ActionId.ClickAcceptFromAmendInfo)},onRefuse:function(e){b.onRefuse&&b.onRefuse(i()),C.hide(!0),v.save(v.ActionId.ClickRefuseFromAmendInfo)}}};t.exports=C},{"../common/const":15,"../common/env":17,"../common/lang":19,"../common/utils":21,"../common/wizUserAction":23,"../domUtils/domBase":25,"./amendUser":9,"./amendUtils/amendBase":10}],9:[function(e,t,n){"use strict";function o(e){return e}function r(e){if(f.client.type.isWeb)return"/wizas/a/users/avatar/"+e+"?default=true&_"+(new Date).valueOf();if(f.client.type.isWin)try{var t=external.GetAvatarByUserGUID(e);return t?t:m}catch(e){console.error(e)}else f.client.type.isMac||f.client.type.isIOS||f.client.type.isAndroid;return m}function i(e){if(f.client.type.isWeb);else if(f.client.type.isWin)try{return external.GetAliasByUserGUID(e)}catch(e){console.error(e)}else f.client.type.isMac||f.client.type.isIOS||f.client.type.isAndroid;return null}function a(){return T?T:T=f.doc.getElementById(g.ID.AMEND_USER_INFO)}function l(){T=f.doc.createElement("meta"),T.id=g.ID.AMEND_USER_INFO,T.name=g.ID.AMEND_USER_INFO,f.doc.getElementsByTagName("HEAD")[0].insertBefore(T,null)}function s(){if(!E){var e,t,n;if(E={},v={},T=a())try{v=JSON.parse(T.content);for(e in v)v.hasOwnProperty(e)&&(t=v[e],t.user_guid=e,n=i(e),n?t.user_name=n:t.user_name=t.name,E[e]=new p(t))}catch(e){}}}function d(e){var t,n,o=e.hash,r=g.COLOR.length,i={};if(s(),E[o])return E[o].color;for(t in E)E.hasOwnProperty(t)&&(n=E[t].color,i[n]=!0);for(t=0;t<r;t++)if(n=g.COLOR[t],!i[n])return n;return g.COLOR[0]}function c(e){E[e.guid]=e,v[e.guid]={color:e.color,name:e.name}}function u(){T||l(),T.content=JSON.stringify(v)}var f=e("../common/env"),g=e("../common/const"),m="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAExUlEQVRYR9WZz08bRxTHvya1CHbUSHXCiZzCIaaBBOUUEveQSORWYwwRxRCpqtIqjZL8XQkEUppAbQMX6hgh5UetRiFV4MABQXoK2AgUx1vNzs7u7Hpmf3m3Vc3Blm2Gz/vOd95784goiqLgf/aIhAVdrVaxu7sLKomC7u7uwKQJBPrFi5eoVvfx6VMdZONOnIhjf78KBQoINQEnrwcuD+DkyS9bhvcNfXR0hFKppEKqWqp8BE0l1N7XgPXvKOjq6kJfX29L4L6hCfDh4aEnYBbQjRuD+PhxD4nEV77gfUEvLy/rXm1S2GIJQ3VtJ9TdoFtDfuKxOK5fv+YJ3jM0BfZmCd4y5tcUPp3+Njzo1dVV1Go1X5Yw+Z1oTOLWVI91HMfg4KBrcE9KLy0tq+mrVUvwwGSxzs5ODAxcDgt6yXWWcLIEVd5QezgzFA704iKBdk5rQmCLJdRzwYEPD2fCgS4WF408LMkSooOmhsl5mBYcTmlFQTY7HA50oVi0LRxeLcHDj4QGXShKK50jsGpfsyWY2uR5dCQbjtL5QsHUSzgVDidL8AcxNOiVlRXUagdccTEfSqGfLVmCt4RRpBTcHB0JR+lS6Tn29va04iIBdsgSvCVoxlMQ/SKKTCYdPPT29jb+qFSEB5HvJbxYgnqctq2958+jpyfpCtx1RVxY+M1eYUsKYyrqAWmf85ZgwAx+bOxm8ND0D4rLOK+wXZbQg+F6bALfQAOj2Syi0agjuGul5+cXTA1+EJbg7UFeZ4bS6OjoCA762fy87udWsoTMHkT43PiYIzD5gmul19bW8OHD36Yy7tUSVg/T8q6VeCjIjX8XLDRZ/OkzojZNdX6zhNUSzOPEGrFYLFhotlpxcQkHBwdaZTS3l7LCYWeJeDyGoTBvLgy8XC5jl1jFppeQZQm/luC3wLWn+V9qNBqYm/u1qb3kewmZDXjVe5JJ9PdfdGWJlqHJAk9+mQOBl1nC6dCRTZrIuTt41qh8Kc0WmZmZ1dXmFbTzMCtOly71I3nunGeVPaU80eo7Ozv4vfRcvzY1WULrK8wBqW7HRG7cF3DL0GSBqenHRk9iKc3WQ8eGka0ABwZtpzADNZ4VTE7kfKscCPSjqWm9vZRnDGoJVv1uTf7H0A8fTen24DOGSGH23q3JiX9f6Xq9jnfv/sKfb954BmbTqYsX+nDmTBcSiYTnAFynvK2tLZDhef3zZ60S0huHLNXxHrZTnXwWiUTQffYsUqkrrgKQQpMLbD6fF+ZhN4WD9zB/cTC/ZsN3YwysN1CZNE6fOiUMwgT99u061tfXjRmb4IrkpnCIgOVBNAObdg/A1z1JfJO6qgegQ5fLqyDFwnqnY/M2L4WD75GZh5nCIqWlFqOyq7sdaWvDnZ9uq+A69Ozsk1AUtt4rhd2fNkpg4wWzULT9JZ/d/uF7tLe3U+iNjU1tPGAMBu1uzbJKZ1W4FUuIhpQX+nqRSl2l0O/fb6BSqZhbTX32xmUJm14iVGCN5VjbMfx850cK/erVa2xuburb4LaBl6U1mSVE6zpZwphhE4s0cP/eXQqdzxewX61Kcy6bS9ComPLm0ixKa34PXXMyoMDkoUNPP56Rt5fcITGUEgMH6mGLPdl/fh/cv4t/ANultPKz243RAAAAAElFTkSuQmCC",p=function(e){e||(e={}),this.guid=e.user_guid||"",this.hash=o(this.guid),this.name=e.user_name||"",this.imgUrl=e.img_url?e.img_url:r(this.guid),this.color=e.color||d(this)},h=null,T=null,E=null,v=null,b={initUser:function(e){return s(),e?(h=new p(e),void c(h)):null},getCurUser:function(){return u(),h},getUserByGuid:function(e){return h&&e===h.guid?h:E&&E[e]?E[e]:(s(),E[e])},removeAllUserInfo:function(){var e=f.doc.getElementById(g.ID.AMEND_USER_INFO);e&&e.parentNode.removeChild(e),T=null,E=null,v=null},setUsersData:function(e){var t,n,o,r,i;if(e)for(t=0,n=e.length;t<n;t++)o=e[t],r=E[o.user_guid],i=v[o.user_guid],r&&o.user_name&&(r.name=o.user_name),r&&o.img_url&&(r.imgUrl=o.img_url),i&&o.user_name&&(i.name=o.user_name)}};t.exports=b},{"../common/const":15,"../common/env":17}],10:[function(e,t,n){"use strict";var o=e("../../common/env"),r=e("../../common/const"),i=e("../../common/utils"),a=e("../../domUtils/domBase"),l=e("../../rangeUtils/rangeBase"),s={getAmendDoms:function(e){var t,n,o,l={},d={},c={insertList:[],deleteList:[],deletedInsertList:[]},u=[];if(e.selection)l[r.ATTR.SPAN_INSERT]="",c.insertList=s.getWizSpanFromRange(e.selectAll,l),c.deletedInsertList=a.removeListFilter(c.insertList,function(e){return e.getAttribute(r.ATTR.SPAN_DELETE)}),d[r.ATTR.SPAN_DELETE]="",c.deleteList=s.getWizSpanFromRange(e.selectAll,d),u=a.removeListFilter(c.deleteList,function(e){return e.getAttribute(r.ATTR.SPAN_INSERT)}),c.deletedInsertList=i.removeDup(c.deletedInsertList.concat(u));else for(t=0,n=e.domList.length;t<n;t++)o=e.domList[t],o.getAttribute(r.ATTR.SPAN_DELETE)&&o.getAttribute(r.ATTR.SPAN_INSERT)?c.deletedInsertList.push(o):o.getAttribute(r.ATTR.SPAN_DELETE)?c.deleteList.push(o):o.getAttribute(r.ATTR.SPAN_INSERT)&&c.insertList.push(o);return c},getSameTimeStampDom:function(e){function t(e,t,a){var l,d,c,u=n(e),f=e.getAttribute(r.ATTR.SPAN_TIMESTAMP),g=e.getAttribute(r.ATTR.SPAN_USERID);if(f)for(var m=o(e,t);m;)l=s.getWizInsertParent(m)||s.getWizDeleteParent(m),m=l,m&&m.getAttribute(r.ATTR.SPAN_USERID)!==g?m=null:m&&(d=m.getAttribute(r.ATTR.SPAN_TIMESTAMP),c=n(m),u===c&&i.isSameAmendTime(m.getAttribute(r.ATTR.SPAN_TIMESTAMP),f)?(t?a.splice(0,0,m):a.push(m),m=o(m,t)):m=null)}function n(e){return e.getAttribute(r.ATTR.SPAN_DELETE)&&e.getAttribute(r.ATTR.SPAN_INSERT)?1:e.getAttribute(r.ATTR.SPAN_INSERT)?2:e.getAttribute(r.ATTR.SPAN_DELETE)?3:0}function o(e,t){return t?a.getPreviousNode(e,!1,null):a.getNextNode(e,!1,null)}if(!e||1!=e.nodeType)return[];var l=[];return t(e,!0,l),l.push(e),t(e,!1,l),l},getSelectedAmendDoms:function(){function e(e,t,n){if(0===e.length||0===n)return null;var o=e[0];return o===t||a.contains(o,t)?(e.splice(0,1),{dom:t,offset:n}):null}function t(e,t,n){if(0===e.length)return null;var o=3===t.nodeType?t.length:t.childNodes.length;if(n===o)return null;var r=e[e.length-1];return r===t||a.contains(r,t)?(e.splice(e.length-1,1),{dom:t,offset:n}):null}var n,r,i,l,d=o.doc.getSelection(),c=d.getRangeAt(0),u=s.getAmendDoms({selection:!0,selectAll:!1});if(0===u.insertList.length&&0===u.deleteList.length&&0===u.deletedInsertList.length)return null;if(d.isCollapsed)return u;n=c.startContainer,i=c.startOffset,r=c.endContainer,l=c.endOffset;var f=e(u.deleteList,n,i);f||(f=e(u.insertList,n,i),f||(f=e(u.deletedInsertList,n,i)));var g={};return r===n&&f?(g.dom=f.dom,g.offset=l):(g=t(u.deleteList,r,l),g||(g=t(u.insertList,r,l),g||(g=t(u.deletedInsertList,r,l)))),u.start=f,u.end=g,u},getWizAmendImgParent:function(e){return a.getParentByFilter(e,function(e){return e&&1===e.nodeType&&e.getAttribute(r.ATTR.IMG)},!0)},getWizAmendParent:function(e){return a.getParentByFilter(e,function(e){return e&&1===e.nodeType&&(e.getAttribute(r.ATTR.SPAN_INSERT)||e.getAttribute(r.ATTR.SPAN_DELETE))},!0)},getWizDeleteParent:function(e){return a.getParentByFilter(e,function(e){return e&&1===e.nodeType&&e.getAttribute(r.ATTR.SPAN_DELETE)},!0)},getWizInsertParent:function(e){return a.getParentByFilter(e,function(e){return e&&1===e.nodeType&&e.getAttribute(r.ATTR.SPAN_INSERT)&&!e.getAttribute(r.ATTR.SPAN_DELETE)&&e.childNodes.length>0},!0)},getWizSpanFromRange:function(e,t){function n(e){if(!e||1!==e.nodeType)return!1;var n;for(n in t)if(t.hasOwnProperty(n)&&(!e.getAttribute(n)||t[n]&&e.getAttribute(n)!=t[n]))return!1;return!0}var r,i,s,d="span";if(!t)return[];for(r in t)t.hasOwnProperty(r)&&(d+=t[r]?"["+r+'="'+t[r]+'"]':"["+r+"]");var c,u,f,g,m,p,h,T,E,v=o.doc.getSelection(),b=[];if(e){var y=o.doc.querySelectorAll(d);for(r=0,i=y.length;r<i;r++)b.push(y[r]);return b}if(0===v.rangeCount)return[];if(v.isCollapsed)return u=l.getRangeAnchor(!1),c=a.getPreviousNode(u,!1,null),u&&(u=a.getParentByFilter(u,n,!0),u&&b.push(u)),b;if(c=l.getRangeAnchor(!0),u=l.getRangeAnchor(!1),!c||!u)return[];if(f=a.getParentByFilter(c,n,!0),g=a.getParentByFilter(u,n,!0),f&&f==g)return[f];for(m=a.getParentRoot([c,u]),p=m.querySelectorAll(d),h=a.getIndexListByDom(c),T=a.getIndexListByDom(u),f&&b.push(f),r=0,i=p.length;r<i;r++)s=p[r],E=a.getIndexListByDom(s),a.compareIndexList(h,E)<=0&&a.compareIndexList(T,E)>=0&&b.push(s);return b},isAmendEdited:function(){var e=s.getAmendDoms({selection:!0,selectAll:!0});return!!e&&(e.deleteList.length>0||e.insertList.length>0||e.deletedInsertList.length>0)},isWizAmend:function(e){return s.getWizAmendParent(e)},isWizDelete:function(e){return!!s.getWizDeleteParent(e)},isWizInsert:function(e){return!!s.getWizInsertParent(e)}};t.exports=s},{"../../common/const":15,"../../common/env":17,"../../common/utils":21,"../../domUtils/domBase":25,"../../rangeUtils/rangeBase":40}],11:[function(e,t,n){"use strict";var o=e("../../common/env"),r=e("../../common/const"),i=e("../../common/utils"),a=e("../../domUtils/domExtend"),l=e("../../rangeUtils/rangeExtend"),s=e("./../amendUser"),d=e("./amendBase");d.add2SelectedAmendDoms=function(e,t){t&&(t.getAttribute(r.ATTR.SPAN_INSERT)&&t.getAttribute(r.ATTR.SPAN_DELETE)?e.deletedInsertList.push(t):t.getAttribute(r.ATTR.SPAN_INSERT)?e.insertList.push(t):t.getAttribute(r.ATTR.SPAN_DELETE)&&e.deleteList.push(t))},d.createDomForImg=function(e,t){var n=o.doc.createElement("span");return d.setDefaultAttr(n,t),n.setAttribute(r.ATTR.IMG,"1"),e==r.TYPE.IMG_DELETE&&(n.removeAttribute(r.ATTR.SPAN_INSERT),n.setAttribute(r.ATTR.SPAN_DELETE,t.hash)),d.setUserImgContainerStyle(n),n},d.createDomForInsert=function(e){var t=o.doc.createElement("span");return d.setDefaultAttr(t,e),d.setUserInsertStyle(t,e),t.innerHTML=r.FILL_CHAR,t},d.createDomForReverse=function(){var e=o.doc.createElement("span");return e.innerHTML=r.FILL_CHAR,e},d.createDomForPaste=function(e){var t,n,o;return t=a.createSpan(),t.setAttribute(r.ATTR.SPAN_PASTE_TYPE,r.TYPE.PASTE.START),t.setAttribute(r.ATTR.SPAN_PASTE_ID,e),t.innerHTML=r.FILL_CHAR,n=a.createSpan(),n.setAttribute(r.ATTR.SPAN_PASTE_TYPE,r.TYPE.PASTE.CONTENT),n.setAttribute(r.ATTR.SPAN_PASTE_ID,e),n.innerHTML=r.FILL_CHAR+r.FILL_CHAR,o=a.createSpan(),o.setAttribute(r.ATTR.SPAN_PASTE_TYPE,r.TYPE.PASTE.END),o.setAttribute(r.ATTR.SPAN_PASTE_ID,e),o.innerHTML=r.FILL_CHAR,{start:t,content:n,end:o}},d.deleteImg=function(e,t){var n,o=d.getWizAmendImgParent(e);if(o)return void(o.getAttribute(r.ATTR.SPAN_DELETE)||(o.setAttribute(r.ATTR.SPAN_USERID,t.hash),o.setAttribute(r.ATTR.SPAN_DELETE,t.hash),n=o.querySelector("img["+r.ATTR.IMG_MASK+"]"),a.css(n,r.CSS.IMG.MASK),a.css(n,r.CSS.IMG_DELETED)));var i=l.isRangeEdge(e),s=d.packageImg(e,r.TYPE.IMG_DELETE,t);i.isStart&&(i.startDom=s,i.startOffset=0),i.isEnd&&(i.endDom=s.parentNode,i.endOffset=a.getDomIndex(s)+1),i.isCollapsed&&i.isStart?l.setRange(i.startDom,a.getEndOffset(i.startDom),null,null):i.isCollapsed||!i.isStart&&!i.isEnd||l.setRange(i.startDom,i.startOffset,i.endDom,i.endOffset);
},d.fixSelectionByDeleteImg=function(){var e,t,n,i,l=o.doc.getSelection(),s=l.getRangeAt(0),c=!1,u=!1;0!==l.rangeCount&&(e=d.getWizAmendImgParent(s.startContainer),e&&!e.getAttribute(r.ATTR.SPAN_DELETE)&&(e=null),e?(c=!0,n=0):(e=s.startContainer,n=s.startOffset),l.isCollapsed?(t=e,u=c):(t=d.getWizAmendImgParent(s.endContainer),t?u=!0:(t=s.endContainer,i=s.endOffset)),u&&t&&t.nextSibling?(i=0,t=t.nextSibling):u&&t?(i=a.getDomIndex(t)+1,t=t.parentNode):i=s.endOffset,l.isCollapsed?l.collapse(t,i):(l.collapse(e,n),l.extend(t,i)))},d.modifyDomForPaste=function(e,t,n){if(e&&t){1===e.childNodes.length&&e.innerText==r.FILL_CHAR&&(e.innerHTML=""),1===t.childNodes.length&&t.innerText==r.FILL_CHAR&&(t.innerHTML="");var l=a.getParentRoot([e,t]);if(l){var s,c,u,f,g,m,p,h;for(p=a.getDomListA2B({startDom:e,startOffset:0,endDom:t,endOffset:a.getEndOffset(t)}),h=p.list,f=0,g=h.length;f<g;f++)if(m=h[f],s=m.parentNode,u=d.getWizAmendParent(m),s){if(u)m=u;else if(3==m.nodeType){if(i.isEmpty(m.nodeValue))continue;a.isWizSpan(s)&&0===s.children.length?m=s:(c=d.createDomForInsert(n),c.innerHTML="",s.insertBefore(c,m),c.appendChild(m),m=c)}if(a.isTag(m,"img"))m=d.packageImg(m,r.TYPE.IMG_INSERT,n);else if(a.isSelfClosingTag(m))continue;d.setDefaultAttr(m,n),d.setUserInsertStyle(m,n)}for(l!=o.doc.body&&l!=o.doc.body.parentNode&&l.parentNode&&(l=l.parentNode),h=l.querySelectorAll("span["+r.ATTR.SPAN_PASTE_TYPE+"]"),f=0,g=h.length;f<g;f++)m=h[f],0===m.childNodes.length?m.parentNode.removeChild(m):(m.removeAttribute(r.ATTR.SPAN_PASTE_TYPE),m.removeAttribute(r.ATTR.SPAN_PASTE_ID))}}},d.packageImg=function(e,t,n){var i,l,s,c=d.createDomForImg(t,n);for(i=e.parentNode,l=e.nextSibling;l&&3==l.nodeType&&l.nodeValue==r.FILL_CHAR;)s=l,l=l.nextSibiling,s.parentNode.removeChild(s);c.appendChild(e);var u=o.doc.createElement("img");return u.className+=r.CLASS.IMG_NOT_DRAG,u.setAttribute(r.ATTR.IMG_MASK,"1"),e.style.maxWidth&&(u.style.maxWidth=e.style.maxWidth),e.style.maxHeight&&(u.style.maxHeight=e.style.maxHeight),e.style.width&&(u.style.width=e.style.width),e.style.height&&(u.style.height=e.style.height),a.css(u,r.CSS.IMG.MASK),t==r.TYPE.IMG_DELETE?a.css(u,r.CSS.IMG_DELETED):a.css(u,r.CSS.IMG_INSERT),c.appendChild(u),i.insertBefore(c,l),c},d.removeUserDel=function(e,t){var n,o,i,s,c=[];for(e||(e=l.getRangeParentRoot()),e&&(a.isBody(e)||(e=e.parentNode),i=d.getWizAmendImgParent(e),i&&i.getAttribute(r.ATTR.SPAN_USERID)!==t.hash&&(i=null),i?c.push(i):(a.search(e,"["+r.ATTR.SPAN_INSERT+'="'+t.hash+'"]['+r.ATTR.SPAN_DELETE+'="'+t.hash+'"]',c),a.search(e,"["+r.ATTR.SPAN_USERID+'="'+t.hash+'"] ['+r.ATTR.SPAN_DELETE+'="'+t.hash+'"]',c))),n=0,o=c.length;n<o;n++)i=c[n],s=i.parentNode,s.removeChild(i),a.removeEmptyParent(s)},d.getDeletedStyle=function(e){var t={};t[r.ATTR.SPAN_DELETE]=e.hash,t[r.ATTR.SPAN_USERID]=e.hash,t[r.ATTR.SPAN_TIMESTAMP]=i.getTime();var n={color:e.color,"text-decoration":"line-through"};return{attr:t,style:n}},d.removeSelection=function(e){var t,n=o.doc.getSelection(),r=n.getRangeAt(0),i=r.startContainer,a=r.startOffset,s=r.endContainer,c=r.endOffset,u=d.getWizAmendImgParent(i),f=d.getWizAmendImgParent(s);if(f||(t=d.splitInsertDom(s,c,!0,e),t.isInsert&&t.split&&l.setRange(i,a,s,c)),u||(t=d.splitInsertDom(i,a,!0,e),t.isInsert&&t.split&&(s===i&&(s=t.insertDom.nextSibling,c=s.childNodes.length),i=t.insertDom,a=t.insertDom.childNodes.length,l.setRange(i,a,s,c))),!n.isCollapsed){var g=d.getDeletedStyle(e);l.modifySelectionDom(g.style,g.attr),d.fixSelectionByDeleteImg()}},d.setDefaultAttr=function(e,t){1==e.nodeType&&(e.setAttribute(r.ATTR.SPAN,r.ATTR.SPAN),e.setAttribute(r.ATTR.SPAN_INSERT,t.hash),e.setAttribute(r.ATTR.SPAN_USERID,t.hash),e.setAttribute(r.ATTR.SPAN_TIMESTAMP,i.getTime()))},d.setUserImgContainerStyle=function(e){a.css(e,r.CSS.IMG.SPAN)},d.setUserInsertStyle=function(e,t){a.css(e,{color:t.color,"text-decoration":"underline"})},d.fixedAmendRange=function(){var e,t,n,r,i,s,c=o.doc.getSelection(),u=c.getRangeAt(0),f=u.startContainer,g=u.endContainer,m=u.startOffset,p=u.endOffset;return c.isCollapsed?(t=l.getRangeAnchor(!1),e=3===g.nodeType&&p>0&&p<g.nodeValue.length?t:a.getPreviousNode(t,!1,null)):(n=l.getRangeAnchor(!0),r=l.getRangeAnchor(!1),i=d.getWizAmendImgParent(n),s=d.getWizAmendImgParent(r),i&&(f=i,m=0),s&&(g=s,p=s.childNodes.length),(i||s)&&l.setRange(f,m,g,p)),{startImg:i,endImg:s,startDom:f,startOffset:m,endDom:g,endOffset:p,leftDom:e,rightDom:t}},d.splitAmendDomByRange=function(e){var t,n,r,i=o.doc.getSelection(),a=e.startContainer,s=e.endContainer,c=e.startOffset,u=e.endOffset;i.isCollapsed?(n=d.getWizAmendImgParent(e.leftDom),r=d.getWizAmendImgParent(e.rightDom),r?(s=r,u=0,l.setRange(s,u,s,u)):n&&(a=n,c=n.childNodes.length,l.setRange(a,c,a,c)),t=i.getRangeAt(0),s=t.endContainer,u=t.endOffset):(i.deleteFromDocument(),t=i.getRangeAt(0),s=t.endContainer,u=t.endOffset);var f=d.splitAmendDomForReverse(s,u);return f?(l.setRange(f,1,f,1),f):null},d.splitDeletedDom=function(e,t){if(1==e.nodeType)return!1;var n=null;return!!d.isWizDelete(e)&&(n=d.splitWizDomWithTextNode(e,t),!!n)},d.splitInsertDom=function(e,t,n,o){var l={insertDom:null,isInsert:!1,split:!1};if(!e)return l;if(1==e.nodeType&&t>0?(e=e.childNodes[t-1],t=a.getEndOffset(e)):1==e.nodeType&&(e=e.childNodes[0]),!e)return l;var s,c,u=d.getWizAmendImgParent(e),f=d.getWizInsertParent(e);return l.insertDom=f,f||1!=e.nodeType?u?l:(f&&(n||f.getAttribute(r.ATTR.SPAN_USERID)!==o.hash)?l.split=!0:f&&(s=f.getAttribute(r.ATTR.SPAN_TIMESTAMP),c=i.getTime(),i.getDateForTimeStr(c)-i.getDateForTimeStr(s)>=r.AMEND_TIME_SPACE?l.split=!0:f.setAttribute(r.ATTR.SPAN_TIMESTAMP,c)),l.split&&(l.split=!!d.splitWizDomWithTextNode(e,t)),l.isInsert=!!f,l):l},d.splitAmendDomForReverse=function(e,t){var n=d.getWizAmendImgParent(e);if(!n&&1==e.nodeType&&t>0?(e=e.childNodes[t-1],t=a.getEndOffset(e)):n||1!=e.nodeType||(e=e.childNodes[0]),!e)return null;var o=d.getWizInsertParent(e),r=d.getWizDeleteParent(e),i=o||r,l=d.createDomForReverse();if(n)a.before(l,n,t>0);else{if(!i)return null;if(i=d.splitWizDomWithTextNode(e,t),!i)return null;a.after(l,i)}return l},d.splitSelectedAmendDoms=function(e){if(e&&(e.start||e.end)){var t,n=o.doc.getSelection(),r=n.getRangeAt(0),i=r.startContainer,a=r.startOffset,s=r.endContainer,c=r.endOffset;e.start&&e.end&&e.start.dom==e.end.dom?(d.splitWizDomWithTextNode(e.end.dom,e.end.offset),t=d.splitWizDomWithTextNode(e.start.dom,e.start.offset),t=t.nextSibling,d.add2SelectedAmendDoms(e,t),i=t,a=0,s=t,c=t.childNodes.length):(e.start&&(t=d.splitWizDomWithTextNode(e.start.dom,e.start.offset),t=t.nextSibling,d.add2SelectedAmendDoms(e,t),i=t,a=0),e.end&&(t=d.splitWizDomWithTextNode(e.end.dom,e.end.offset),d.add2SelectedAmendDoms(e,t),s=t,c=t.childNodes.length)),delete e.start,delete e.end,l.setRange(i,a,s,c)}},d.splitWizDomWithTextNode=function(e,t){if(!e||3!==e.nodeType)return null;var n,o,i,l,s=null;for(t<e.nodeValue.length?(n=e.nodeValue.substr(t),o=e.cloneNode(!1),o.nodeValue=n,e.nodeValue=e.nodeValue.substr(0,t),e.parentNode.insertBefore(o,e.nextSibling),s=e,i=e.parentNode,l=o):(i=e.parentNode,l=e.nextSibling);i&&!a.isBody(i)&&(s=i,a.splitDom(i,l),!i||1!==i.nodeType||!i.getAttribute(r.ATTR.SPAN_DELETE)&&!i.getAttribute(r.ATTR.SPAN_INSERT));)l=i.nextSibling,i=i.parentNode;return s},d.wizAmendDelete=function(e){var t,n,o,r;for(t=0,n=e.length;t<n;t++)o=e[t],r=o.parentNode,r.removeChild(o),a.removeEmptyParent(r)},d.wizAmendSave=function(e){var t,n,o,i;for(t=0,n=e.length;t<n;t++)o=e[t],o.getAttribute(r.ATTR.SPAN_DELETE)&&o.getAttribute(r.ATTR.SPAN_INSERT)&&o.getAttribute(r.ATTR.SPAN_INSERT)!==o.getAttribute(r.ATTR.SPAN_USERID)?(i=s.getUserByGuid(o.getAttribute(r.ATTR.SPAN_INSERT)),i=i?i:{},o.removeAttribute(r.ATTR.SPAN_DELETE),o.setAttribute(r.ATTR.SPAN_USERID,i.hash),o.getAttribute(r.ATTR.IMG)?(d.setUserImgContainerStyle(o),a.css(mask,r.CSS.IMG_INSERT)):d.setUserInsertStyle(o,i)):o.getAttribute(r.ATTR.IMG)?(a.before(o.children[0],o),o.parentNode.removeChild(o)):(a.css(o,{color:"","text-decoration":""}),o.removeAttribute(r.ATTR.SPAN_USERID),o.removeAttribute(r.ATTR.SPAN_INSERT),o.removeAttribute(r.ATTR.SPAN_DELETE),o.removeAttribute(r.ATTR.SPAN_PASTE),o.removeAttribute(r.ATTR.SPAN_PASTE_TYPE),o.removeAttribute(r.ATTR.SPAN_PASTE_ID),o.removeAttribute(r.ATTR.SPAN_TIMESTAMP))},t.exports=d},{"../../common/const":15,"../../common/env":17,"../../common/utils":21,"../../domUtils/domExtend":26,"../../rangeUtils/rangeExtend":41,"./../amendUser":9,"./amendBase":10}],12:[function(e,t,n){"use strict";var o=e("../common/env"),r=(e("../common/const"),e("../common/utils"),e("../domUtils/domExtend"),e("../rangeUtils/rangeExtend"),e("../common/historyUtils"),e("./codeUtils"),{bind:function(){},unbind:function(){},handler:{}}),i={on:function(){o.readonly||r.bind()},off:function(){r.unbind()}};t.exports=i},{"../common/const":15,"../common/env":17,"../common/historyUtils":18,"../common/utils":21,"../domUtils/domExtend":26,"../rangeUtils/rangeExtend":41,"./codeUtils":13}],13:[function(e,t,n){"use strict";var o=(e("./../common/env"),e("./../common/const"),e("./../common/utils"),e("./../domUtils/domExtend"),e("../rangeUtils/rangeExtend"),{});t.exports=o},{"../rangeUtils/rangeExtend":41,"./../common/const":15,"./../common/env":17,"./../common/utils":21,"./../domUtils/domExtend":26}],14:[function(e,t,n){"use strict";var o,r={},i=r.Base64,a="2.1.8";"undefined"!=typeof t&&t.exports&&(o=e("buffer").Buffer);var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=function(e){for(var t={},n=0,o=e.length;n<o;n++)t[e.charAt(n)]=n;return t}(l),d=String.fromCharCode,c=function(e){if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?d(192|t>>>6)+d(128|63&t):d(224|t>>>12&15)+d(128|t>>>6&63)+d(128|63&t)}var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return d(240|t>>>18&7)+d(128|t>>>12&63)+d(128|t>>>6&63)+d(128|63&t)},u=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,f=function(e){return e.replace(u,c)},g=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0),o=[l.charAt(n>>>18),l.charAt(n>>>12&63),t>=2?"=":l.charAt(n>>>6&63),t>=1?"=":l.charAt(63&n)];return o.join("")},m=r.btoa?function(e){return r.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,g)},p=o?function(e){return(e.constructor===o.constructor?e:new o(e)).toString("base64")}:function(e){return m(f(e))},h=function(e,t){return t?p(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):p(String(e))},T=function(e){return h(e,!0)},E=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),v=function(e){switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),n=t-65536;return d((n>>>10)+55296)+d((1023&n)+56320);case 3:return d((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return d((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},b=function(e){return e.replace(E,v)},y=function(e){var t=e.length,n=t%4,o=(t>0?s[e.charAt(0)]<<18:0)|(t>1?s[e.charAt(1)]<<12:0)|(t>2?s[e.charAt(2)]<<6:0)|(t>3?s[e.charAt(3)]:0),r=[d(o>>>16),d(o>>>8&255),d(255&o)];return r.length-=[0,0,2,1][n],r.join("")},A=r.atob?function(e){return r.atob(e)}:function(e){return e.replace(/[\s\S]{1,4}/g,y)},C=o?function(e){return(e.constructor===o.constructor?e:new o(e,"base64")).toString()}:function(e){return b(A(e))},S=function(e){return C(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},N=function(){var e=r.Base64;return r.Base64=i,e};if(r.Base64={VERSION:a,atob:A,btoa:m,fromBase64:S,toBase64:h,utob:f,encode:h,encodeURI:T,btou:b,decode:S,noConflict:N},"function"==typeof Object.defineProperty){var _=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};r.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",_(function(){return S(this)})),Object.defineProperty(String.prototype,"toBase64",_(function(e){return h(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",_(function(){return h(this,!0)}))}}t.exports=r.Base64},{buffer:2}],15:[function(e,t,n){"use strict";var o="​",r={FILL_CHAR:o,FILL_CHAR_REG:new RegExp(o,"ig"),AMEND_TIME_SPACE:18e4,AMEND_BATCH_TIME_SPACE:3e4,COMPOSITION_START:!1,CLASS:{IMG_ATTACHMENT:"wiz-img-attachment",IMG_NOT_DRAG:"wiz-img-cannot-drag",IMG_RESIZE_ACTIVE:"wiz-img-resize-active",IMG_RESIZE_CONTAINER:"wiz-img-resize-container",IMG_RESIZE_HANDLE:"wiz-img-resize-handle",SELECTED_CELL:"wiz-selected-cell",SELECTED_CELL_MULTI:"wiz-selected-cell-multi",CODE_CONTAINER_OLD:"prettyprint",TABLE_CONTAINER:"wiz-table-container",TABLE_TOOLS:"wiz-table-tools",TABLE_BODY:"wiz-table-body",TABLE_MENU_BUTTON:"wiz-table-menu-button",TABLE_MENU_ITEM:"wiz-table-menu-item",TABLE_MENU_SUB:"wiz-table-menu-sub",TABLE_MOVING:"wiz-table-moving",TABLE_SCROLL:"wiz-table-scroll",TODO_ACCOUNT:"wiz-todo-account",TODO_AVATAR:"wiz-todo-avatar",TODO_CHECKBOX:"wiz-todo-checkbox",TODO_CHECK_IMG_OLD:"wiz-todo-img",TODO_DATE:"wiz-todo-dt",TODO_LAYER:"wiz-todo-layer",TODO_MAIN:"wiz-todo-main",TODO_LABEL_OLD:"wiz-todo-label",TODO_CHECKED:"wiz-todo-checked",TODO_UNCHECKED:"wiz-todo-unchecked",TODO_CHECKED_OLD:"wiz-todo-label-checked",TODO_UNCHECKED_OLD:"wiz-todo-label-unchecked",TODO_TAIL_OLD:"wiz-todo-tail",TODO_USER_AVATAR:"wiz-todo-avatar-",TODO_USER_INFO:"wiz-todo-completed-info"},ATTR:{IMG:"data-wiz-img",IMG_MASK:"data-wiz-img-mask",IMG_RATE:"data-wiz-img-rate",IMG_EDITING:"data-wiz-img-editing",SPAN:"data-wiz-span",SPAN_USERID:"data-wiz-user-id",SPAN_INSERT:"data-wiz-insert",SPAN_DELETE:"data-wiz-delete",SPAN_PASTE:"data-wiz-paste",SPAN_PASTE_TYPE:"data-wiz-paste-type",SPAN_PASTE_ID:"data-wiz-paste-id",SPAN_TIMESTAMP:"data-wiz-amend-time",TODO_ID:"wiz_todo_id",TODO_CHECK:"data-wiz-check"},ID:{AMEND_INFO:"wiz-amend-info",AMEND_INFO_SINGLE:"wiz-amend-info-single",AMEND_INFO_MULTI:"wiz-amend-info-multi",AMEND_INFO_NAME:"wiz-amend-info-name",AMEND_INFO_IMG:"wiz-amend-info-image",AMEND_INFO_CONTENT:"wiz-amend-info-content",AMEND_INFO_TIME:"wiz-amend-info-time",AMEND_INFO_TOOLS:"wiz-amend-info-tools",AMEND_INFO_ACCEPT:"wiz-amend-info-accept",AMEND_INFO_REFUSE:"wiz-amend-info-refuse",AMEND_USER_INFO:"wiz-amend-user",IFRAME_FOR_SAVE:"wiz-iframe-for-save",TABLE_RANGE_BORDER:"wiz-table-range-border",TABLE_ROW_LINE:"wiz-table-row-line",TABLE_COL_LINE:"wiz-table-col-line",TODO_STYLE:"wiz_todo_style",TODO_STYLE_OLD:"wiz_todo_style_id",TODO_AVATAR_STYLE:"wiz_todo_style_avatar_",WIZ_DEFAULT_STYLE:"wiz_custom_css"},NAME:{TMP_STYLE:"wiz_tmp_editor_style",UNSAVE_STYLE:"wiz_unsave_style"},NOTE_TYPE:{COMMON:"common",MARKDOWN:"markdown",MATHJAX:"mathjax"},TAG:{TMP_TAG:"wiz_tmp_tag",TMP_PLUGIN_TAG:"wiz_tmp_plugin_tag",TMP_HIGHLIGHT_TAG:"wiz_tmp_highlight_tag"},TYPE:{IMG_DELETE:"delete",IMG_INSERT:"insert",PASTE:{START:"start",END:"end",CONTENT:"content"},POS:{upLeft:"up-left",downLeft:"down-left",leftUp:"left-up",rightUp:"right-up",upRight:"up-right",downRight:"down-right",leftDown:"left-down",rightDown:"right-down"},TABLE:{COPY:"copy",PASTE:"paste",CLEAR_CELL:"clearCell",MERGE_CELL:"mergeCell",SPLIT_CELL:"splitCell",INSERT_ROW_UP:"insertRowUp",INSERT_ROW_DOWN:"insertRowDown",INSERT_COL_LEFT:"insertColLeft",INSERT_COL_RIGHT:"insertColRight",DELETE_ROW:"deleteRow",DELETE_COL:"deleteCol",SET_CELL_BG:"setCellBg",SET_CELL_ALIGN:"setCellAlign",DISTRIBUTE_COLS:"distributeCols",DELETE_TABLE:"deleteTable"},TODO:"tasklist"},COLOR:["#CB3C3C","#0C9460","#FF3399","#FF6005","#8058BD","#009999","#8AA725","#339900","#CC6600","#3BBABA","#D4CA1A","#2389B0","#006699","#FF8300","#2C6ED5","#FF0000","#B07CFF","#CC3399","#EB4847","#3917E6"],CSS:{IMG:{SPAN:{position:"relative",display:"inline-block"},MASK:{position:"absolute",width:"100% !important",height:"100% !important",top:"0",left:"0",opacity:".5",filter:"alpha(opacity=50)",border:"2px solid","box-sizing":"border-box","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box"}},IMG_DELETED:{background:"#fdc6c6 url(data:image/gif;base64,R0lGODlhDwAPAIABAIcUFP///yH5BAEKAAEALAAAAAAPAA8AAAIajI8IybadHjxyhjox1I0zH1mU6JCXCSpmUAAAOw==)","border-color":"#E47070"},IMG_INSERT:{background:"#ccffcc","border-color":"#00AA00"},TODO_LIST:{IMG_WIDTH:40},Z_INDEX:{amendInfo:150,tableBorder:105,tableColRowLine:120,tableRangeDot:110,tableTDBefore:100,tableTools:130,tableToolsArrow:10}},CLIENT_EVENT:{WizEditorPaste:"wizEditorPaste",WizEditorClickImg:"wizEditorClickImg",WizReaderClickImg:"wizReaderClickImg",WizMarkdownRender:"wizMarkdownRender",WizEditorTrackEvent:"wizEditorTrackEvent",WizGetWebViewSize:"wizGetWebViewSize"},EVENT:{BEFORE_GET_DOCHTML:"BEFORE_GET_DOCHTML",BEFORE_SAVESNAP:"BEFORE_SAVESNAP",AFTER_INSERT_DOM:"AFTER_INSERT_DOM",AFTER_RESTORE_HISTORY:"AFTER_RESTORE_HISTORY",ON_CLICK:"ON_CLICK",ON_COMPOSITION_START:"ON_COMPOSITION_START",ON_COMPOSITION_END:"ON_COMPOSITION_END",ON_COPY:"ON_COPY",ON_CUT:"ON_CUT",ON_DRAG_START:"ON_DRAG_START",ON_DRAG_ENTER:"ON_DRAG_ENTER",ON_DROP:"ON_DROP",ON_EXEC_COMMAND:"ON_EXEC_COMMAND",ON_KEY_DOWN:"ON_KEY_DOWN",ON_KEY_UP:"ON_KEY_UP",ON_MOUSE_DOWN:"ON_MOUSE_DOWN",ON_MOUSE_MOVE:"ON_MOUSE_MOVE",ON_MOUSE_OVER:"ON_MOUSE_OVER",ON_MOUSE_UP:"ON_MOUSE_UP",ON_ORIENTATION_CHANGE:"ON_ORIENTATION_CHANGE",ON_PASTE:"ON_PASTE",ON_SCROLL:"ON_SCROLL",ON_SELECT_CHANGE:"ON_SELECT_CHANGE",ON_SELECT_START:"ON_SELECT_START",ON_TOUCH_START:"ON_TOUCH_START",ON_TOUCH_END:"ON_TOUCH_END",UPDATE_RENDER:"UPDATE_RENDER"},AMEND:{INFO_SPACE:0,INFO_TIMER:300}};t.exports=r},{}],16:[function(e,t,n){"use strict";function o(e,t,n){a.load(e,t,n)}function r(e,t,n){var r=0,i=t.length,a=function a(){r<i?o(e,t[r++],a):n&&n()};return a}var i=e("./utils"),a=e("./scriptLoader"),l={loadJs:function(e,t,n){var o=r(e,t,n);o()},loadCss:function(e,t){var n,o;for(n=0,o=t.length;n<o;n++)i.loadSingleCss(e,t[n])}};t.exports=l},{"./scriptLoader":20,"./utils":21}],17:[function(e,t,n){"use strict";var o=e("./const"),r=e("./lang"),i=r.initLang,a={},l="wiznotecmd://",s={options:{document:null,autoFocus:!0,lang:"en",clientType:"",noteType:"common",userInfo:null,userData:[],dependencyUrl:"",maxRedo:100,noAmend:!1,table:{colWidth:120,colWidthMin:30,rowHeightMin:33},timeout:{markdown:3e4,mathJax:3e4},callback:{markdown:null,mathJax:null,redo:null},ios:{webViewHeight:0,toolbarHeight:0},pc:{pluginModified:!1}},init:function(e,t){function n(e,t){if(t){var o;for(o in e)e.hasOwnProperty(o)&&"undefined"!=typeof t[o]&&(/^(table|timeout|callback)$/.test(o)?n(e[o],t[o]):e[o]=t[o])}}n(s.options,t);var o=s.options.document||window.document;s.doc=o,s.win=s.doc.defaultView,i(s.options.lang),s.client.setType(s.options.clientType)},win:null,doc:null,readonly:null,dependency:{files:{css:{fonts:"{dependencyUrl}/fonts.css",github2:"{dependencyUrl}/github2.css",wizToc:"{dependencyUrl}/wizToc.css"},js:{jquery:"{dependencyUrl}/jquery-1.11.3.js",prettify:"{dependencyUrl}/prettify.js",raphael:"{dependencyUrl}/raphael.js",underscore:"{dependencyUrl}/underscore.js",flowchart:"{dependencyUrl}/flowchart.js",sequence:"{dependencyUrl}/sequence-diagram.js",mathJax:"{dependencyUrl}/mathjax/MathJax.js?config=TeX-MML-AM_SVG"},init:function(){function e(e){var n;for(n in e)e.hasOwnProperty(n)&&(e[n]=e[n].replace("{dependencyUrl}",t))}var t=s.options.dependencyUrl;e(s.dependency.files.css),e(s.dependency.files.js)}},css:{fonts:["fonts"],markdown:["github2","wizToc"]},js:{markdown:[["jquery"],["prettify","raphael","underscore"],["flowchart","sequence"]],mathJax:[["jquery"],["mathJax"]]}},client:{type:{isWeb:function(){return location&&0===location.protocol.indexOf("http")}(),isWin:!1,isMac:!1,isLinux:!1,isIOS:!1,isAndroid:!1,isPad:!1,isPhone:!1},sendCmdToWiznote:function(){},setType:function(e){if(e){if(e=e.toLowerCase(),e.indexOf("windows")>-1)s.client.type.isWin=!0;else if(e.indexOf("ios")>-1)s.client.type.isIOS=!0,s.client.sendCmdToWiznote=function(e,t){var n;e==o.CLIENT_EVENT.WizReaderClickImg&&delete t.imgList,n=l+e;var r,i=[];if(t){for(r in t)t.hasOwnProperty(r)&&i.push(r+"="+encodeURIComponent(t[r]));n+="?"+i.join("&")}var a=s.doc.createElement(o.TAG.TMP_TAG),d=s.doc.createElement("iframe");d.setAttribute("src",n),a.style.display="none",a.appendChild(d),s.doc.body.appendChild(a),a.parentNode.removeChild(a),d=null,a=null};else if(e.indexOf("android")>-1)s.client.type.isAndroid=!0,s.client.sendCmdToWiznote=function(e,t){e==o.CLIENT_EVENT.WizReaderClickImg?s.win.WizNote.onClickImg(t.src,t.imgList):e==o.CLIENT_EVENT.WizEditorClickImg&&s.win.WizNote.onEditorClickImage(t.src)};else if(e.indexOf("mac")>-1){var t=s.win.navigator.userAgent;/Mac/i.test(t)||(s.client.type.isLinux=!0),s.client.type.isMac=!0}(s.client.type.isIOS||s.client.type.isAndroid)&&(e.indexOf("pad")>-1?s.client.type.isPad=!0:s.client.type.isPhone=!0)}}},event:{add:function(e,t){function n(e,t){if(!e||!t)return!1;var n,o,r=a[e];if(!r||0===r.length)return!1;for(n=0,o=r.length;n<o;n++)if(r[n]===t)return!0;return!1}if(e&&t&&!n(e,t)){var o=a[e];o||(o=[]),o.push(t),a[e]=o}},call:function(e){var t,n,o=[],r=a[e];if(r&&0!==r.length){for(t=1,n=arguments.length;t<n;t++)o.push(arguments[t]);for(t=0,n=r.length;t<n;t++)r[t].apply(this,o)}},remove:function(e,t){if(e&&t){var n,o,r=a[e];if(r&&0!==r.length)for(n=0,o=r.length;n<o;n++)r[n]===t&&r.splice(n,1)}}}};t.exports=s},{"./const":15,"./lang":19}],18:[function(e,t,n){"use strict";var o=e("./env"),r=e("./const"),i=e("./utils"),a=e("./../domUtils/domExtend"),l=e("./../rangeUtils/rangeExtend"),s=100,d={enable:!1,callback:null,stack:[],stackIndex:0,init:function(){d.stack=[],d.stackIndex=0},start:function(e,t){e&&e>0&&(s=e),d.enable=!0,d.init(),c.bind(),t&&(d.callback=t)},stop:function(){d.enable=!1,d.init(),c.unbind()},applyCallback:function(){d.callback&&d.callback(d.getUndoState())},getUndoState:function(){return{undoCount:d.stack.length,undoIndex:d.stackIndex}},undo:function(){return!d.enable||d.stackIndex<=0||0===d.stack.length?void(d.stackIndex=0):(d.stackIndex>=d.stack.length&&d.saveSnap(!0),d.restore(d.stack[--d.stackIndex]),d.applyCallback(),void a.focus())},redo:function(){!d.enable||d.stackIndex>=d.stack.length-1||(d.restore(d.stack[++d.stackIndex]),d.applyCallback(),a.focus())},saveSnap:function(e){if(d.enable&&!r.COMPOSITION_START){var t=0===d.stack.length||d.stackIndex<d.stack.length-1;o.event.call(r.EVENT.BEFORE_SAVESNAP);var n={add:!0,replace:!1,direct:0},i=d.snapshot();!e&&d.stack.length>0&&d.stackIndex>0&&(n=d.canSave(i,d.stack[d.stackIndex-1])),(n.add||n.replace)&&(i.direct=n.direct,d.stackIndex>=0&&d.stack.splice(d.stackIndex,d.stack.length-d.stackIndex),n.add?(d.stack.push(i),e||d.stackIndex++):n.replace&&(d.stack[d.stackIndex-1]=i,e&&d.stackIndex--)),d.stack.length>s&&(d.stack.shift(),d.stackIndex--),t&&d.stack.length>0&&d.applyCallback()}},restore:function(e){if(d.enable&&e){var t,n,i=o.doc.getSelection();o.doc.body.innerHTML=e.content;try{t=a.getDomByIndexList(e.focus.start),i.collapse(t.dom,t.offset),e.focus.isCollapsed?l.setRange(t.dom,t.offset,t.dom,t.offset):(n=a.getDomByIndexList(e.focus.end),l.setRange(t.dom,t.offset,n.dom,n.offset)),l.caretFocus()}catch(e){}o.event.call(r.EVENT.AFTER_RESTORE_HISTORY)}},canSave:function(e,t){function n(e,t){if(e.isCollapsed!=t.isCollapsed)return 0;if(e.start.length!=t.start.length||e.end.length!=t.end.length)return 0;var n=o(e.start,t.start);return n<1?n:n=o(e.end,t.end)}function o(e,t){var n,o,r=1;for(n=0,o=e.length-1;n<o;n++)if(e[n]!=t[n]){r=0;break}return r&&e[o]<t[o]&&(r=-1),r}var r={add:!1,replace:!1,direct:0};return(e.content.length!=t.content.length||e.content.localeCompare(t.content))&&(r.direct=n(e.focus,t.focus),0===r.direct||r.direct!==t.direct?r.add=!0:r.replace=!0),r},snapshot:function(){var e=o.doc.getSelection(),t=o.doc.body.innerHTML,n={isCollapsed:!0,start:[],end:[]},r={content:t,focus:n};if(0===e.rangeCount)return n.start.push(0),r;var i=e.getRangeAt(0);return n.start=a.getIndexListByDom(i.startContainer),n.start.push(i.startOffset),n.isCollapsed=e.isCollapsed,e.isCollapsed||(n.end=a.getIndexListByDom(i.endContainer),n.end.push(i.endOffset)),r}},c={bind:function(){c.unbind(),o.event.add(r.EVENT.ON_KEY_DOWN,c.onKeyDown)},unbind:function(){o.event.remove(r.EVENT.ON_KEY_DOWN,c.onKeyDown)},onKeyDown:function(e){var t=e.keyCode||e.which;return e.ctrlKey&&90==t||e.metaKey&&90==t&&!e.shiftKey?(d.undo(),void i.stopEvent(e)):void((e.ctrlKey&&89==t||e.metaKey&&89==t||e.metaKey&&90==t&&e.shiftKey)&&(d.redo(),i.stopEvent(e)))}};t.exports=d},{"./../domUtils/domExtend":26,"./../rangeUtils/rangeExtend":41,"./const":15,"./env":17,"./utils":21}],19:[function(e,t,n){"use strict";function o(e){e||(e="en"),e=e.toLowerCase().replace("_","-"),r[e]?i=e:e="en";var t;for(t in r[e])r[e].hasOwnProperty(t)&&(a[t]=r[e][t])}var r={},i="en",a={};r.en={version:"en",Month:["Jan.","Feb.","Mar.","Apr.","May","June","July","Agu.","Sep.","Oct.","Nov.","Dec."],Amend:{Edit:"Inserted contents",Delete:"Deleted contents",BtnAccept:"Accept",BtnRefuse:"Reject",Accept:"Accept all changes? Or partially select the changes which need to be accepted.",Refuse:"Reject all changes? Or partially select the changes which need to be rejected.",MultiInfo:"Multiple changes are selected",UserNameDefault:"someone"},Table:{Copy:"Copy",Paste:"Paste",ClearCell:"Clear",MergeCell:"Merge Cells",SplitCell:"Unmerge Cells",InsertRowUp:"Add Row Above",InsertRowDown:"Add Row Below",InsertColLeft:"Add Column Before",InsertColRight:"Add Column After",DeleteRow:"Delete Row",DeleteCol:"Delete Column",SetCellBg:"Color Fill",CellAlign:"Arrange",DeleteTable:"Delete Table",DistributeCols:"Average Column Width"},Err:{Copy_Null:"Copy of deleted changes not allowed",Cut_Null:"Cut of deleted changes not allowed"}},r["zh-cn"]={version:"zh-cn",Date:{Year:"年",Month:"月",Day:"日"},Amend:{Edit:"插入了内容",Delete:"删除了内容",BtnAccept:"接受修订",BtnRefuse:"拒绝修订",Accept:"是否确认接受全部修订内容？ 如需接受部分内容请使用鼠标进行选择",Refuse:"是否确认拒绝全部修订内容？ 如需拒绝部分内容请使用鼠标进行选择",MultiInfo:"您选中了多处修订",UserNameDefault:"有人"},Table:{Copy:"复制",Paste:"粘贴",ClearCell:"清空单元格",MergeCell:"合并单元格",SplitCell:"拆分单元格",InsertRowUp:"上插入行",InsertRowDown:"下插入行",InsertColLeft:"左插入列",InsertColRight:"右插入列",DeleteRow:"删除当前行",DeleteCol:"删除当前列",SetCellBg:"单元格底色",CellAlign:"单元格对齐方式",DeleteTable:"删除表格",DistributeCols:"平均分配各列"},Err:{Copy_Null:"无法复制已删除的内容",Cut_Null:"无法剪切已删除的内容"}},r["zh-tw"]={version:"zh-tw",Date:{Year:"年",Month:"月",Day:"日"},Amend:{Edit:"插入了內容",Delete:"刪除了內容",BtnAccept:"接受修訂",BtnRefuse:"拒絕修訂",Accept:"是否確認接受全部修訂內容？ 如需接受部分內容請使用滑鼠進行選擇",Refuse:"是否確認拒絕全部修訂內容？ 如需拒絕部分內容請使用滑鼠進行選擇",MultiInfo:"您選中了多處修訂",UserNameDefault:"有人"},Table:{Copy:"複製",Paste:"粘貼",ClearCell:"清空儲存格",MergeCell:"合併儲存格",SplitCell:"拆分儲存格",InsertRowUp:"上插入行",InsertRowDown:"下插入行",InsertColLeft:"左插入列",InsertColRight:"右插入列",DeleteRow:"刪除當前行",DeleteCol:"刪除當前列",SetCellBg:"儲存格底色",CellAlign:"儲存格對齊方式",DeleteTable:"刪除表格",DistributeCols:"平均分配各列"},Err:{Copy_Null:"無法複製已刪除的內容",Cut_Null:"無法剪切已刪除的內容"}},t.exports.getLang=function(){return a},t.exports.initLang=function(e){o(e)}},{}],20:[function(e,t,n){"use strict";function o(e,t){return l[e]||(l[e]=0),l[e]++,function(){l[e]--,0===l[e]&&(l[e]=null,t&&t())}}function r(e){return"wiz_js_"+e}function i(e){if(e){var t={version:e.version,jsStr:e.jsStr};localStorage.setItem(e.id,JSON.stringify(t))}}var a={appendJsCode:function(e,t,n){var o=e.createElement("script");o.type=n,o.text=t,e.getElementsByTagName("head")[0].appendChild(o)},load:function(e,t,n){if(e&&t){var a,l,s,d,c=(new Date).valueOf(),u=!0;for(a=0,l=t.length;a<l;a++)if("string"==typeof t[a])s=this.loadSingleJs(e,t[a]),s!==!0&&(s.onload=o(c,n),u=!1);else{var f=t[a].link,g=r(t[a].id),m=t[a].version;if(window.localStorage){var p=JSON.parse(localStorage.getItem(g));p&&p.version==m?(s=this.inject(e,p.jsStr,g),s!==!0&&(d=o(c,n),setTimeout(function(){d()},10),u=!1)):(u=!1,d=o(c,n),$.ajax({url:f,context:{id:g,version:m},success:function(t){i({id:this.id,version:this.version,jsStr:t}),s=wizUI.scriptLoader.inject(e,t,this.id),s!==!0&&setTimeout(function(){d()},10)},error:function(){d()}}))}else s=this.loadSingleJs(e,t[a].link),s!==!0&&(s.onload=o(c,n),u=!1)}u&&n()}},loadSingleJs:function(e,t){var n="wiz_"+t;if(e.getElementById(n))return!0;var o=e.createElement("script");return o.type="text/javascript",o.setAttribute("charset","utf-8"),o.src=t.replace(/\\/g,"/"),o.id=n,e.getElementsByTagName("head")[0].insertBefore(o,null),o},inject:function(e,t,n){if(!e||e.getElementById(n))return!0;var o=e.createElement("script");return o.type="text/javascript",o.id=n,o.text=t,e.getElementsByTagName("head")[0].insertBefore(o,null),o}},l={};t.exports=a},{}],21:[function(e,t,n){"use strict";var o=e("./const");String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1});var r={checkNonTxtKey:function(e){var t=e.keyCode||e.which;return!(!e.ctrlKey&&!e.metaKey)||!(t>=48&&t<=57||t>=65&&t<=90||t>=96&&t<=107||t>=109&&t<=111||t>=186&&t<=192||t>=219&&t<=222||229==t||0===t||13==t||32==t)},isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},isEmpty:function(e){if(!e)return!0;var t=/\r?\n/gi,n=new RegExp("[\r\n"+o.FILL_CHAR+"]","ig"),r=t.test(e),i=e.replace(n,""),a=0===e.replace(n,"").trim().length;return 0===i.length||r&&a},isSameAmendTime:function(e,t){if(!e||!t)return!1;var n=r.getDateForTimeStr(e),i=r.getDateForTimeStr(t);return Math.abs(n-i)<=o.AMEND_BATCH_TIME_SPACE},checkChar:function(e,t){var n,o,r,i;for(n=0,o=t.length;n<o;n++){if(r=t[n][0],i=t[n].length>1?t[n][1]:null,null===i&&e==r)return!0;if(null!==i&&e>=r&&e<=i)return!0}return!1},isCJK:function(e){var t=[[12352,12687],[13056,13183],[13312,15661],[19968,40959],[63744,64255],[44032,55215]];return r.checkChar(e,t)},isSpace:function(e){var t=[[9,13],[32],[160]];return r.checkChar(e,t)},isAlpha:function(e){var t=[[48,57],[65,90],[97,122],[192,214],[216,246],[248,256]];return r.checkChar(e,t)},getWordCount:function(e){var t={nWords:0,nChars:0,nCharsWithSpace:0,nNonAsianWords:0,nAsianChars:0};if(!e)return t;var n,o,i,a=!1,l=!1;for(t.nCharsWithSpace=e.length,t.nChars=t.nCharsWithSpace,n=0,o=e.length;n<o;n++)i=e.charCodeAt(n),a=!1,r.isCJK(i)?t.nAsianChars++:r.isSpace(i)?t.nChars--:r.isAlpha(i)&&(a=!0),a&&!l?l=!0:a||(l&&t.nNonAsianWords++,l=!1);return a&&l&&t.nNonAsianWords++,t.nWords=t.nNonAsianWords+t.nAsianChars,t},getEventClientPos:function(e){return{x:e.changedTouches?e.changedTouches[0].clientX:e.clientX,y:e.changedTouches?e.changedTouches[0].clientY:e.clientY}},getHash:function(e){var t,n,o=1315423911;for(t=e.length-1;t>=0;t--)n=e.charCodeAt(t),o^=(o<<5)+n+(o>>2);return 2147483647&o},getTime:function(){function e(e){var t=e.toString();return 1==t.length?"0"+t:t}var t=new Date;return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())},getDateForTimeStr:function(e){return new Date(Date.parse(e.replace(/-/g,"/")))},listToMap:function(e){if(!e)return{};e=r.isArray(e)?e:e.split(",");var t,n,o,i={};for(t=0,n=e.length;t<n;t++)o=e[t],i[o.toUpperCase()]=i[o]=1;return i},rgb2Hex:function(e){function t(e,t){return e+Math.floor((255-e)*(1-t))}function n(e){var t=e.toString(16);return 1==t.length?"0"+t:t}if(!e)return"";var o=e.replace(/.*\((.*)\)/gi,"$1").split(",");if(o.length<3)return"";var r=parseInt(o[0],10),i=parseInt(o[1],10),a=parseInt(o[2],10),l=4===o.length?parseFloat(o[3]):1;return 0===l?"":"#"+n(t(r,l))+n(t(i,l))+n(t(a,l))},removeDup:function(e){var t,n,o,r=[];for(t=0,n=e.length;t<n;t++)o=e[t],r.indexOf(o)<0&&r.push(o);return r},stopEvent:function(e){e&&(e.stopPropagation(),e.preventDefault())},WizEditorTmpName:"wiz_tmp_editor_style",loadSingleCss:function(e,t){var n="wiz_"+t;if(e.getElementById(n))return!0;var o=e.createElement("link");return o.rel="stylesheet",o.setAttribute("charset","utf-8"),o.setAttribute("name",this.WizEditorTmpName),o.href=t.replace(/\\/g,"/"),e.getElementsByTagName("head")[0].insertBefore(o,null),o},appendCssCode:function(e,t,n){var o=e.createElement("style");o.type=n,o.text=t,o.setAttribute("name",this.WizEditorTmpName),e.getElementsByTagName("head")[0].appendChild(o);
},getInnerText:function(e){var t="",n=function(e){return e?e.replace(/ +/gm," ").replace(/[\t]+/gm,"").replace(/[ ]+$/gm,"").replace(/^[ ]+/gm,"").replace(/\n+/gm,"\n").replace(/\n+$/,"").replace(/^\n+/,"").replace(/NEWLINE/gm,"\n"):""},o=function(e){var t=function(e){return!/[^\t\n\r ]/.test(e.nodeValue)},n=[],o=function e(o){for(var r=0;r<o.childNodes.length;r++){var i=o.childNodes[r];3==i.nodeType&&t(i)?n.push(i):i.hasChildNodes()&&e(i)}};o(e);for(var r=0;r<n.length;r++)n[r].parentNode.removeChild(n[r])},r=function(e,t){if(e.style[t])return e.style[t];var n=e.currentStyle||e.ownerDocument.defaultView.getComputedStyle(e,null);return"SCRIPT"==e.tagName?"none":n[t]?"block"==n[t]&&"TD"==e.tagName?"feaux-inline":n[t]:"LI,P,TR".indexOf(e.tagName)>-1?"block":e.style[t]},i="table-row,block,list-item",a=function(e){var t=r(e,"display")||"feaux-inline";return i.indexOf(t)>-1},l=function e(n){if(/pre/.test(r(n,"whiteSpace")))return t+=n.innerHTML.replace(/\t/g," "),"";var o=r(n,"display");if("none"==o)return"";var i=a(n)?"\n":" ";t+=i;for(var l=0;l<n.childNodes.length;l++){var s=n.childNodes[l];3==s.nodeType&&(t+=s.nodeValue),s.childNodes.length&&e(s)}return t+=i},s=e.cloneNode(!0);return s.innerHTML=s.innerHTML.replace(/<br[\/]?>/gi,"NEWLINE"),o(s),n(l(s))},markdownPreProcess:function(e){function t(e){return String(e).replace(/\&amp;/g,"&").replace(/\&gt;/g,">").replace(/\&lt;/g,"<").replace(/\&quot;/g,'"').replace(/\&&#39;/g,"'")}var n=$(e);n.find(".wiz-table-container").each(function(e){var n=$(this),o=$("<span></span>");o.text(t(n[0].outerHTML)),o.insertAfter(n);var r=$("<br/>");r.insertAfter(n),n.remove()}),n.find("label.wiz-todo-label").each(function(e){var n=$(this),o=$(".wiz-todo-img",this);if(0!==o.length){var r=$("<span></span>");r.text(t(n[0].outerHTML)),r.insertAfter(n),n.remove()}}),n.find(".wiz-todo-layer").each(function(e){var n=$(this),o=$(".wiz-todo-checkbox",this);if(0!==o.length){var r=$("<span></span>");r.text(t(n[0].outerHTML)),r.insertAfter(n),n.remove()}}),n.find("img").each(function(e){var n=$(this),o=$("<span></span>");o.text(t(n[0].outerHTML)),o.insertAfter(n),n.remove()}),n.find("a").each(function(e,n){var o=$(n),r=o.attr("href");if(r&&/^(wiz|wiznote):/.test(r)){var i=$("<span></span>");i.text(t(o[0].outerHTML)),i.insertAfter(o),o.remove()}}),n.find("p").each(function(){var e=$(this);e.replaceWith($("<div>"+this.innerHTML+"</div>"))})}};t.exports=r},{"./const":15}],22:[function(e,t,n){"use strict";function o(e,t,n){n=!!n;var o=i.doc.getElementById(e);o||n||(o=i.doc.createElement("style"),o.id=e,i.doc.getElementsByTagName("HEAD")[0].insertBefore(o,null)),o&&(o.innerHTML=t)}function r(e){var t=new RegExp("^"+a.ID.TODO_AVATAR_STYLE+"(.*)$","i");return e.replace(t,"$1")}var i=e("./env"),a=e("./const"),l=e("../domUtils/domBase"),s={},d={todoChecked:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RjY1OTU4MUZCRjk3MTFFM0JENDdFMDk4NDNCMkZDMTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RjY1OTU4MjBCRjk3MTFFM0JENDdFMDk4NDNCMkZDMTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpGNjU5NTgxREJGOTcxMUUzQkQ0N0UwOTg0M0IyRkMxNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpGNjU5NTgxRUJGOTcxMUUzQkQ0N0UwOTg0M0IyRkMxNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqkphX0AAAJZSURBVHjaYvz//z/DQAImhgEGLNu2bYNzCj+7jpgQaAdiUNz/Z4EKqAJxRz/vbhcgzUeBwSBDE4AhuQiPh6cCcQY8CoBYHYhPALEAFXxWiMdyViCeD8TRSGLdIAe0QS3/BcSlQLwEaMg7Kgc5BxCvAmJfJLGlQFwOcoALVKAMaPEkGsQ3LxBvBGJHJLF9QJwESwOwOF9MA8uFgRiUzcyQxM4AcRA0xBlYkCSoHeySQLwbiLWRxO4AsRcQf0ROhLQAikC8B4iVkMReA7EnlCZYDtQDcT+Z5QTIx0fQLP8CTYB3MEpCHJY3QNlyQBwDxN+JtNwEiHdA4x4GQHHtD8QniS0JxZHYoMSyF4hFiLDcAZq6hdEKpiSoONFFcS6aBksgPgbEKngs94Gmdl408SpofiepLvgL9TlyfIGK6uNAbIFFfSQQrwNiTjTxLlDxjiwALOoZia2MPkJT7EckMRFoyAQhiYHK9CXQYpYBrZSrwGJuPym14R2oZX+RxEC+XA3E+aBiFIinYTEDXsqh+b4Vqo9gLkA3LBdqEbKjJ+BQfxq5lMOSHshqD0yHYkIAFGLeaNFGtQZJLr6shKuUo6YDsOUMGPiMq5SjdpMMW84AxXUArlKOFm1C5JxBsJQjqlVMhh5YzuAnVMrRygEMROYKogDj1q1bYQUGI42b4ij2eHl5YaQBIRpaLoQvEX6CsmNp6IAUpIYJhgP2INVeeUAsSEWLBaFmNkP5u7A5oBqIPwAxGxBPhDZO/1MJv4OayQa1oxqbA25A6/l10FKN2uAz1GwLqF0oACDAAGu/mbMal6iXAAAAAElFTkSuQmCC",todoUnChecked:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RDcyODY1Q0NCRjk2MTFFMzhGNTBEODZBNTIzNzhDQjQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RDcyODY1Q0RCRjk2MTFFMzhGNTBEODZBNTIzNzhDQjQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpENzI4NjVDQUJGOTYxMUUzOEY1MEQ4NkE1MjM3OENCNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpENzI4NjVDQkJGOTYxMUUzOEY1MEQ4NkE1MjM3OENCNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpXYwTEAAAD5SURBVHjaYvz//z/DQAImhgEGA+4Alm3bttHdUi8vL4wQUAXitUD8EYj/Uxl/hJqtijUEgFgdiE8AsQCNPMwHxEFA7ATEFkB8Ez0NtEEt/wXE+UAsDMSMVMJCUDN/Qe1owxYCLlB2GRBPorLv30PN5ATiDiB2w5YL+KDsxTRMd7OhNA++bPiOhg54N1oQjTpg1AGjDhh1wKgDRh0w6oAh4QAhGtojhM8Bn6DsWBo6IAVKf8HmgD1QdhcQ5wGxIBUtFoSa2Qzl78LmgGog/gDEbEA8EdqApFav6B3UTDaoHdXYHHAD2mNZB8SfaRD8n6FmW0DtQgEAAQYAS2BO8CD/bL4AAAAASUVORK5CYII="},c={phone:"body {overflow-y:scroll;-webkit-overflow-scrolling: touch;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}body[contenteditable=true], .wiz-template-editable {padding-bottom: 44px !important;}td,th {position:static;}th:before,td:before,th:after,td:after {display:none;}",pad:"body {min-width: 90%;max-width: 100%;min-height: 100%;background: #ffffff;overflow-y:scroll;-webkit-overflow-scrolling: touch;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);padding-bottom: 44px !important;}td,th {position:static;}th:before,td:before,th:after,td:after {display:none;}"},u={phone:"img {max-width: 100%;height: auto !important;margin: 0px auto;cursor: pointer;}"},f='Helvetica, "Hiragino Sans GB", "微软雅黑", "Microsoft YaHei UI", SimSun, SimHei, arial, sans-serif;',g={common:"html, body {font-size: 15px;}body {font-family: "+f+"line-height: 1.6;margin: 0;padding: 20px 15px;padding: 1.33rem 1rem;}h1, h2, h3, h4, h5, h6 {margin:20px 0 10px;margin:1.33rem 0 0.667rem;padding: 0;font-weight: bold;}h1 {font-size:21px;font-size:1.4rem;}h2 {font-size:20px;font-size:1.33rem;}h3 {font-size:18px;font-size:1.2rem;}h4 {font-size:17px;font-size:1.13rem;}h5 {font-size:15px;font-size:1rem;}h6 {font-size:15px;font-size:1rem;color: #777777;margin: 1rem 0;}div, p, ul, ol, dl, li {margin:0;}blockquote, table, pre, code {margin:8px 0;}ul, ol {padding-left:32px;padding-left:2.13rem;}blockquote {padding:0 12px;padding:0 0.8rem;}blockquote > :first-child {margin-top:0;}blockquote > :last-child {margin-bottom:0;}img {border:0;max-width:100%;height:auto !important;margin:2px 0;}table {border-collapse:collapse;border:1px solid #bbbbbb;}td, th {padding:4px 8px;border-collapse:collapse;border:1px solid #bbbbbb;height:28px;word-break:break-all;box-sizing: border-box;}@media only screen and (-webkit-max-device-width: 1024px), only screen and (-o-max-device-width: 1024px), only screen and (max-device-width: 1024px), only screen and (-webkit-min-device-pixel-ratio: 3), only screen and (-o-min-device-pixel-ratio: 3), only screen and (min-device-pixel-ratio: 3) {html,body {font-size:17px;}body {line-height:1.7;padding:0.75rem 0.9375rem;color:#353c47;}h1 {font-size:2.125rem;}h2 {font-size:1.875rem;}h3 {font-size:1.625rem;}h4 {font-size:1.375rem;}h5 {font-size:1.125rem;}h6 {color: inherit;}ul, ol {padding-left:2.5rem;}blockquote {padding:0 0.9375rem;}}",todoList:".wiz-todo-main {padding-left: 12px;position: relative;line-height:30px;}.wiz-todo-checked {color: #666;}.wiz-todo-unchecked {text-decoration: initial;}.wiz-todo-checked .wiz-todo-checkbox {background-image:url("+d.todoChecked+")}.wiz-todo-unchecked .wiz-todo-checkbox {background-image:url("+d.todoUnChecked+")}.wiz-todo-checkbox {border-radius:0;position:relative;top:-3px;border:0;background-color:transparent;outline:none;width:16px !important; height:16px !important; cursor:default; padding:5px 10px 5px 5px;-webkit-user-select: none; background-size:16px;background-repeat:no-repeat;background-position:5px;box-sizing:initial;}.wiz-todo-avatar {border:0;background-color:transparent;outline:none;width:20px !important; height: 20px !important; vertical-align: -20%; padding:0; margin:0 10px 0 0; border-radius:100%;background-size:20px;background-repeat:no-repeat;}.wiz-todo-completed-info {padding-left: 20px;}input.wiz-todo-avatar {position:relative;top:-4px;}.wiz-todo-account, .wiz-todo-dt { color: #666; }"},m="html {height:100%;} body {min-height:100%;box-sizing:border-box;word-wrap: break-word !important;}a {word-wrap: break-word;}",p=".wiz-img-resize-handle {position: absolute;z-index: 1000;border: 1px solid black;background-color: white;}.wiz-img-resize-handle {width:5px;height:5px;}.wiz-img-resize-handle.lt {cursor: nw-resize;}.wiz-img-resize-handle.tm {cursor: n-resize;}.wiz-img-resize-handle.rt {cursor: ne-resize;}.wiz-img-resize-handle.lm {cursor: w-resize;}.wiz-img-resize-handle.rm {cursor: e-resize;}.wiz-img-resize-handle.lb {cursor: sw-resize;}.wiz-img-resize-handle.bm {cursor: s-resize;}.wiz-img-resize-handle.rb {cursor: se-resize;}",h="."+a.CLASS.TABLE_CONTAINER+" {}."+a.CLASS.TABLE_BODY+" {position:relative;padding:0 0 10px;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;}."+a.CLASS.TABLE_BODY+" table {margin:0;outline:none;}td,th {height:28px;word-break:break-all;box-sizing:border-box;outline:none;}",T="body pre.prettyprint {padding:0;}body pre.prettyprint code {white-space: pre;}body pre.prettyprint.linenums {box-shadow:none; overflow: auto;-webkit-overflow-scrolling: touch;}body pre.prettyprint.linenums ol.linenums {box-shadow: 40px 0 0 #FBFBFC inset, 41px 0 0 #ECECF0 inset; padding: 10px 10px 10px 40px !important;}",E=".wiz-table-scroll::-webkit-scrollbar {width: 7px;height: 7px;}.wiz-table-scroll::-webkit-scrollbar-thumb {background-color: #7f7f7f;border-radius: 7px;}.wiz-table-scroll::-webkit-scrollbar-button {display: none;}",v="."+a.CLASS.TABLE_BODY+"."+a.CLASS.TABLE_MOVING+" *, ."+a.CLASS.TABLE_BODY+"."+a.CLASS.TABLE_MOVING+" *:before, ."+a.CLASS.TABLE_BODY+"."+a.CLASS.TABLE_MOVING+" *:after {cursor:default !important;}td,th {position:relative;}#wiz-table-range-border {display: none;width: 0;height: 0;position: absolute;top: 0;left: 0; z-index:"+a.CSS.Z_INDEX.tableBorder+"}#wiz-table-col-line, #wiz-table-row-line {display: none;background-color: #448aff;position: absolute;z-index:"+a.CSS.Z_INDEX.tableColRowLine+";}#wiz-table-col-line {width: 1px;cursor:col-resize;}#wiz-table-row-line {height: 1px;cursor:row-resize;}#wiz-table-range-border_start, #wiz-table-range-border_range {display: none;width: 0;height: 0;position: absolute;}#wiz-table-range-border_start_top, #wiz-table-range-border_range_top {height: 2px;background-color: #448aff;position: absolute;top: 0;left: 0;}#wiz-table-range-border_range_top {height: 1px;}#wiz-table-range-border_start_right, #wiz-table-range-border_range_right {width: 2px;background-color: #448aff;position: absolute;top: 0;}#wiz-table-range-border_range_right {width: 1px;}#wiz-table-range-border_start_bottom, #wiz-table-range-border_range_bottom {height: 2px;background-color: #448aff;position: absolute;top: 0;}#wiz-table-range-border_range_bottom {height: 1px;}#wiz-table-range-border_start_left, #wiz-table-range-border_range_left {width: 2px;background-color: #448aff;position: absolute;top: 0;left: 0;}#wiz-table-range-border_range_left {width: 1px;}#wiz-table-range-border_start_dot, #wiz-table-range-border_range_dot {width: 5px;height: 5px;border: 2px solid rgb(255, 255, 255);background-color: #448aff;cursor: crosshair;position: absolute;z-index:"+a.CSS.Z_INDEX.tableRangeDot+";}.wiz-table-tools {display: block;background-color:#fff;position: absolute;left: 0px;border: 1px solid #ddd;-webkit-border-radius: 5px;-moz-border-radius: 5px;border-radius: 5px;z-index:"+a.CSS.Z_INDEX.tableTools+';}.wiz-table-tools ul {list-style: none;padding: 0;}.wiz-table-tools .wiz-table-menu-item {position: relative;float: left;margin:5px 2px 5px 8px;}.wiz-table-tools .wiz-table-menu-item .wiz-table-menu-button {font-size:15px;width:20px;height:20px;line-height:20px;cursor: pointer;position:relative;}.wiz-table-tools i.editor-icon{font-size: 15px;color: #455a64;}.wiz-table-tools .wiz-table-menu-item .wiz-table-menu-button i#wiz-menu-bg-demo{position: absolute;top:1px;left:0;}.wiz-table-tools .wiz-table-menu-sub {position: absolute;display: none;width: 125px;padding: 5px 0;background: #fff;border-radius: 3px;border: 1px solid #E0E0E0;top:28px;left:-9px;box-shadow: 1px 1px 5px #d0d0d0;}.wiz-table-tools .wiz-table-menu-sub > div{font-size:15px;}.wiz-table-tools .wiz-table-menu-item.active .wiz-table-menu-sub {display: block}.wiz-table-tools .wiz-table-menu-sub:before, .wiz-table-tools .wiz-table-menu-sub:after {position: absolute;content: " ";border-style: solid;border-color: transparent;border-bottom-color: #cccccc;left: 22px;margin-left: -14px;top: -8px;border-width: 0 8px 8px 8px;z-index:'+a.CSS.Z_INDEX.tableToolsArrow+';}.wiz-table-tools .wiz-table-menu-sub:after {border-bottom-color: #ffffff;top: -7px;}.wiz-table-tools .wiz-table-menu-sub-item {padding: 4px 12px;font-size: 14px;}.wiz-table-tools .wiz-table-menu-sub-item.split {border-top: 1px solid #E0E0E0;}.wiz-table-tools .wiz-table-menu-sub-item:hover {background-color: #ececec;}.wiz-table-tools .wiz-table-menu-sub-item.disabled {color: #bbbbbb;cursor: default;}.wiz-table-tools .wiz-table-menu-sub-item.disabled:hover {background-color: transparent;}.wiz-table-tools .wiz-table-menu-item.wiz-table-cell-bg:hover .wiz-table-color-pad {display: block;}.wiz-table-tools .wiz-table-color-pad {display: none;padding: 10px;box-sizing: border-box;width: 85px;height: 88px;background-color: #fff;cursor: default;}.wiz-table-tools .wiz-table-color-pad > div{font-size:15px;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item {display: inline-block;width: 15px;height: 15px;margin-right: 9px;position: relative;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item i.pad-demo {position: absolute;top:3px;left:0;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item .icon-oblique_line{color: #cc0000;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item:last-child {margin-right: 0;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item.active i.editor-icon.icon-box {color: #448aff;}.wiz-table-tools .wiz-table-cell-align {display: none;padding: 10px;box-sizing: border-box;width: 85px;height: 65px;background-color: #fff;cursor: default;}.wiz-table-tools .wiz-table-cell-align .wiz-table-cell-align-item {display: inline-block;width: 15px;height: 15px;margin-right: 9px;position: relative;}.wiz-table-tools .wiz-table-cell-align .wiz-table-cell-align-item:last-child {margin-right:0}.wiz-table-tools .wiz-table-cell-align .wiz-table-cell-align-item i.valign{position: absolute;top:3px;left:0;color: #d2d2d2;}.wiz-table-tools .wiz-table-cell-align-item.active i.editor-icon.valign {color: #a1c4ff;}.wiz-table-tools .wiz-table-cell-align-item.active i.editor-icon.icon-box,.wiz-table-tools .wiz-table-cell-align-item.active i.editor-icon.align {color: #448aff;}.wiz-table-tools .wiz-table-color-pad .wiz-table-color-pad-item:last-child,.wiz-table-tools .wiz-table-cell-align .wiz-table-cell-align-item:last-child {margin-right: 0;}th.wiz-selected-cell-multi, td.wiz-selected-cell-multi {background: rgba(0,102,255,.05);}th:before,td:before,#wiz-table-col-line:before,#wiz-table-range-border_start_right:before,#wiz-table-range-border_range_right:before{content: " ";position: absolute;top: 0;bottom: 0;right: -5px;width: 9px;cursor: col-resize;background: transparent;z-index:'+a.CSS.Z_INDEX.tableTDBefore+';}th:after,td:after,#wiz-table-row-line:before,#wiz-table-range-border_start_bottom:before,#wiz-table-range-border_range_bottom:before{content: " ";position: absolute;left: 0;right: 0;bottom: -5px;height: 9px;cursor: row-resize;background: transparent;z-index:'+a.CSS.Z_INDEX.tableTDBefore+";}",b={insertDefaultStyle:function(e,t){if(o(a.ID.WIZ_DEFAULT_STYLE,g.common,e),t){var n,r,i=!1;if("string"==typeof t)n=t,i=!0;else{n="html, body{";for(r in t)t.hasOwnProperty(r)&&(n+="font-family"==r.toLowerCase()?r+":"+t[r]+","+f+";":r+":"+t[r]+";",i=!0);n+="}"}i&&b.insertStyle({name:a.NAME.TMP_STYLE},n)}},insertCustomStyle:function(e,t,n){if(e&&t){var o={id:e};n&&(o.name=a.NAME.TMP_STYLE),b.insertStyle(o,t)}},insertStyle:function(e,t){var n=i.doc.createElement("style");return e.name&&n.setAttribute("name",e.name),e.id&&(n.setAttribute("id",e.id),b.removeStyleById(e.id)),i.doc.getElementsByTagName("HEAD")[0].insertBefore(n,null),n.innerHTML=t,n},insertTmpEditorStyle:function(){b.insertStyle({name:a.NAME.TMP_STYLE},m+p+v+h+T),i.client.type.isIOS&&i.client.type.isPhone?b.insertStyle({name:a.NAME.TMP_STYLE},c.phone):i.client.type.isIOS&&i.client.type.isPad&&b.insertStyle({name:a.NAME.TMP_STYLE},c.pad),i.client.type.isMac&&b.insertStyle({name:a.NAME.TMP_STYLE},E)},insertTmpReaderStyle:function(){b.insertStyle({name:a.NAME.TMP_STYLE},m+h+T),i.client.type.isIOS&&b.insertStyle({name:a.NAME.TMP_STYLE},u.phone),i.client.type.isMac&&b.insertStyle({name:a.NAME.TMP_STYLE},E)},insertTodoStyle:function(e){b.removeTodoOldStyle();var t=i.doc.getElementById(a.ID.TODO_STYLE);!e&&t||o(a.ID.TODO_STYLE,g.todoList,!1),b.removeUnUsedTodoStyle()},removeFormat:function(e,t,n){function o(e){return!!e&&1==e.nodeType&&(l.isTag(e,[a.TAG.TMP_TAG,a.TAG.TMP_PLUGIN_TAG])||e.getAttribute("name")==a.NAME.TMP_STYLE||/^wiz[_-]/i.test(e.id)||/(^| )wiz[_-]/i.test(e.className))}function r(e){if(e){o(e)||(e.removeAttribute("style"),e.style.cssText&&(e.style.cssText=""));var t=e.children;if(t)for(var n=0;n<t.length;n++)1==t[n].nodeType&&r(t[n])}}function s(e){if(e){o(e)||l.attr(e,{class:null});var t=e.children;if(t)for(var n=0;n<t.length;n++)1==t[n].nodeType&&s(t[n])}}var d,c,u,f,g,m;try{if(e&&i.doc.execCommand("SelectAll"),t&&i.doc.execCommand("RemoveFormat"),e&&(c=i.doc.documentElement,c&&n&&(s(c),r(c))),n){for(u=i.doc.getElementsByTagName("link"),d=u.length-1;d>=0;d--)f=u[d],"stylesheet"!=f.getAttribute("rel")||o(f)||f.remove();for(g=i.doc.getElementsByTagName("style"),d=g.length-1;d>=0;d--)m=g[d],o(m)||m.remove()}}catch(e){return void console.error(e)}},removeStyleById:function(e){var t=i.doc.getElementById(e);t&&l.isTag(t,"style")&&t.parentNode.removeChild(t)},removeTodoOldStyle:function(){b.removeStyleById(a.ID.TODO_STYLE_OLD)},removeTodoStyle:function(){b.removeTodoOldStyle();var e=i.doc.getElementById(a.ID.TODO_STYLE);e&&e.parentNode.removeChild(e);var t,n,o=i.doc.querySelectorAll("style");for(n=o.length-1;n>=0;n--)e=o[n],e.id&&0===e.id.indexOf(a.ID.TODO_AVATAR_STYLE)&&(t=r(e.id),s[t]=e.innerHTML,e.parentNode.removeChild(e))},removeUnUsedTodoStyle:function(e){var t,n,o,l,d,c=i.doc.querySelectorAll("style");if(e)return n=a.ID.TODO_AVATAR_STYLE+e,o=a.CLASS.TODO_USER_AVATAR+e,l=i.doc.querySelector("."+o),t=i.doc.getElementById(n),void(t&&!l&&(s[e]=t.innerHTML,t.parentNode.removeChild(t)));for(d=c.length-1;d>=0;d--)t=c[d],n=t.id,n&&0===n.indexOf(a.ID.TODO_AVATAR_STYLE)&&(e=r(n),i.doc.querySelector("."+a.CLASS.TODO_USER_AVATAR+e)||(s[e]=t.innerHTML,t.parentNode.removeChild(t)))},restoreUserAvatarStyle:function(){var e,t;for(e in s)s.hasOwnProperty(e)&&(t=a.ID.TODO_AVATAR_STYLE+e,!i.doc.querySelector("#"+t)&&i.doc.querySelector("."+a.CLASS.TODO_USER_AVATAR+e)&&o(t,s[e],!1))}};t.exports=b},{"../domUtils/domBase":25,"./const":15,"./env":17}],23:[function(e,t,n){"use strict";var o=e("../common/env"),r={ClickAcceptFromAmendInfo:"ClickAcceptFromAmendInfo",ClickRefuseFromAmendInfo:"ClickRefuseFromAmendInfo"},i={save:function(e){if(o.client.type.isWin)try{external&&external.LogAction&&external.LogAction(e)}catch(e){console.error(e.toString())}}},a={ActionId:r,save:i.save};t.exports=a},{"../common/env":17}],24:[function(e,t,n){"use strict";!function e(t,n,o){function r(a,l){if(!n[a]){if(!t[a]){var s="function"==typeof _require&&_require;if(!l&&s)return s(a,!0);if(i)return i(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return r(n?n:e)},c,c.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof _require&&_require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){function o(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]}}function r(e,t,n){}function i(e,t,n){}function a(e,t,n){}function l(e,t,n){}function s(e){return e.replace(S,"&lt;").replace(N,"&gt;")}function d(e,t,n,o){if(o=o||C,n=p(n),"href"===t||"src"===t){if(n=A.trim(n),"#"===n)return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"#"!==n[0]&&"/"!==n[0])return""}else if("background"===t){if(L.lastIndex=0,L.test(n))return""}else if("style"===t){if(R.lastIndex=0,R.test(n))return"";if(I.lastIndex=0,I.test(n)&&(L.lastIndex=0,L.test(n)))return"";n=o.process(n)}return n=h(n)}function c(e){return e.replace(_,"&quot;")}function u(e){return e.replace(D,'"')}function f(e){return e.replace(w,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})}function g(e){return e.replace(x,":").replace(O," ")}function m(e){for(var t="",n=0,o=e.length;n<o;n++)t+=e.charCodeAt(n)<32?" ":e.charAt(n);return A.trim(t)}function p(e){return e=u(e),e=f(e),e=g(e),e=m(e)}function h(e){return e=c(e),e=s(e)}function T(){return""}function E(e,t){function n(t){return!!o||A.indexOf(e,t)!==-1}"function"!=typeof t&&(t=function(){});var o=!Array.isArray(e),r=[],i=!1;return{onIgnoreTag:function(e,o,a){if(n(e)){if(a.isClosing){var l="[/removed]",s=a.position+l.length;return r.push([i!==!1?i:a.position,s]),i=!1,l}return i||(i=a.position),"[removed]"}return t(e,o,a)},remove:function(e){var t="",n=0;return A.forEach(r,function(o){t+=e.slice(n,o[0]),n=o[1]}),t+=e.slice(n)}}}function v(e){return e.replace(B,"")}function b(e){var t=e.split("");return t=t.filter(function(e){var t=e.charCodeAt(0);return 127!==t&&(!(t<=31)||(10===t||13===t))}),t.join("")}var y=e("cssfilter").FilterCSS,A=e("./util"),C=new y,S=/</g,N=/>/g,_=/"/g,D=/&quot;/g,w=/&#([a-zA-Z0-9]*);?/gim,x=/&colon;?/gim,O=/&newline;?/gim,L=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,R=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,I=/u\s*r\s*l\s*\(.*/gi,B=/<!--[\s\S]*?-->/g;n.whiteList=o(),n.getDefaultWhiteList=o,n.onTag=r,n.onIgnoreTag=i,n.onTagAttr=a,n.onIgnoreTagAttr=l,n.safeAttrValue=d,n.escapeHtml=s,n.escapeQuote=c,n.unescapeQuote=u,n.escapeHtmlEntities=f,n.escapeDangerHtml5Entities=g,n.clearNonPrintableCharacter=m,n.friendlyAttrValue=p,n.escapeAttrValue=h,n.onIgnoreTagStripAll=T,n.StripTagBody=E,n.stripCommentTag=v,n.stripBlankChar=b,n.cssFilter=C},{"./util":4,cssfilter:8}],2:[function(e,t,n){function o(e,t){var n=new a(t);return n.process(e)}var r=e("./default"),i=e("./parser"),a=e("./xss");n=t.exports=o,n.FilterXSS=a;for(var l in r)n[l]=r[l];for(var l in i)n[l]=i[l];"undefined"!=typeof window&&(window.filterXSS=t.exports)},{"./default":1,"./parser":3,"./xss":5}],3:[function(e,t,n){function o(e){var t=e.indexOf(" ");if(t===-1)var n=e.slice(1,-1);else var n=e.slice(1,t+1);return n=u.trim(n).toLowerCase(),"/"===n.slice(0,1)&&(n=n.slice(1)),"/"===n.slice(-1)&&(n=n.slice(0,-1)),n}function r(e){return"</"===e.slice(0,2)}function i(e,t,n){"user strict";var i="",a=0,l=!1,s=!1,d=0,c=e.length,u="",f="";for(d=0;d<c;d++){var g=e.charAt(d);if(l===!1){if("<"===g){l=d;continue}}else if(s===!1){if("<"===g){i+=n(e.slice(a,d)),l=d,a=d;continue}if(">"===g){i+=n(e.slice(a,l)),u=e.slice(l,d+1),f=o(u),i+=t(l,i.length,f,u,r(u)),a=d+1,l=!1;continue}if(('"'===g||"'"===g)&&"="===e.charAt(d-1)){s=g;continue}}else if(g===s){s=!1;continue}}return a<e.length&&(i+=n(e.substr(a))),i}function a(e,t){"user strict";function n(e,n){if(e=u.trim(e),e=e.replace(f,"").toLowerCase(),!(e.length<1)){var o=t(e,n||"");o&&r.push(o)}}for(var o=0,r=[],i=!1,a=e.length,d=0;d<a;d++){var g,m,p=e.charAt(d);if(i!==!1||"="!==p)if(i===!1||d!==o||'"'!==p&&"'"!==p||"="!==e.charAt(d-1))if(" "!==p);else{if(i===!1){if(m=l(e,d),m===-1){g=u.trim(e.slice(o,d)),n(g),i=!1,o=d+1;continue}d=m-1;continue}if(m=s(e,d-1),m===-1){g=u.trim(e.slice(o,d)),g=c(g),n(i,g),i=!1,o=d+1;continue}}else{if(m=e.indexOf(p,d+1),m===-1)break;g=u.trim(e.slice(o+1,m)),n(i,g),i=!1,d=m,o=d+1}else i=e.slice(o,d),o=d+1}return o<e.length&&(i===!1?n(e.slice(o)):n(i,c(u.trim(e.slice(o))))),u.trim(r.join(" "))}function l(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"="===n?t:-1}}function s(e,t){for(;t>0;t--){var n=e[t];if(" "!==n)return"="===n?t:-1}}function d(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}function c(e){return d(e)?e.substr(1,e.length-2):e}var u=e("./util"),f=/[^a-zA-Z0-9_:\.\-]/gim;n.parseTag=i,n.parseAttr=a},{"./util":4}],4:[function(e,t,n){t.exports={indexOf:function(e,t){var n,o;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var o,r;if(Array.prototype.forEach)return e.forEach(t,n);for(o=0,r=e.length;o<r;o++)t.call(n,e[o],o,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")}}},{}],5:[function(e,t,n){function o(e){return void 0===e||null===e}function r(e){var t=e.indexOf(" ");if(t===-1)return{html:"",closing:"/"===e[e.length-2]};e=u.trim(e.slice(t+1,-1));var n="/"===e[e.length-1];return n&&(e=u.trim(e.slice(0,-1))),{html:e,closing:n}}function i(e){e=e||{},e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=l.onIgnoreTagStripAll),e.whiteList=e.whiteList||l.whiteList,e.onTag=e.onTag||l.onTag,e.onTagAttr=e.onTagAttr||l.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||l.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||l.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||l.safeAttrValue,e.escapeHtml=e.escapeHtml||l.escapeHtml,e.css=e.css||{},this.options=e,this.cssFilter=new a(e.css)}var a=e("cssfilter").FilterCSS,l=e("./default"),s=e("./parser"),d=s.parseTag,c=s.parseAttr,u=e("./util");i.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,n=t.options,i=n.whiteList,a=n.onTag,s=n.onIgnoreTag,f=n.onTagAttr,g=n.onIgnoreTagAttr,m=n.safeAttrValue,p=n.escapeHtml,h=t.cssFilter;n.stripBlankChar&&(e=l.stripBlankChar(e)),n.allowCommentTag||(e=l.stripCommentTag(e));var T=!1;if(n.stripIgnoreTagBody){var T=l.StripTagBody(n.stripIgnoreTagBody,s);s=T.onIgnoreTag}var E=d(e,function(e,t,n,l,d){var T={sourcePosition:e,position:t,isClosing:d,isWhite:n in i},E=a(n,l,T);if(!o(E))return E;if(T.isWhite){if(T.isClosing)return"</"+n+">";var v=r(l),b=i[n],y=c(v.html,function(e,t){var r=u.indexOf(b,e)!==-1,i=f(n,e,t,r);if(!o(i))return i;if(r)return t=m(n,e,t,h),t?e+'="'+t+'"':e;var i=g(n,e,t,r);return o(i)?void 0:i}),l="<"+n;return y&&(l+=" "+y),v.closing&&(l+=" /"),l+=">"}var E=s(n,l,T);return o(E)?p(l):E},p);return T&&(E=T.remove(E)),E},t.exports=i},{"./default":1,"./parser":3,"./util":4,cssfilter:8}],6:[function(e,t,n){function o(e){return void 0===e||null===e}function r(e){e=e||{},e.whiteList=e.whiteList||i.whiteList,e.onAttr=e.onAttr||i.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||i.onIgnoreAttr,this.options=e}var i=e("./default"),a=e("./parser");e("./util");r.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,n=t.options,r=n.whiteList,i=n.onAttr,l=n.onIgnoreAttr,s=a(e,function(e,t,n,a,s){var d=r[n],c=!1;d===!0?c=d:"function"==typeof d?c=d(a):d instanceof RegExp&&(c=d.test(a)),c!==!0&&(c=!1);var u={position:t,sourcePosition:e,source:s,isWhite:c};if(c){var f=i(n,a,u);return o(f)?n+":"+a:f}var f=l(n,a,u);if(!o(f))return f});return s},t.exports=r},{"./default":7,"./parser":9,"./util":10}],7:[function(e,t,n){function o(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,
e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function r(e,t,n){}function i(e,t,n){}n.whiteList=o(),n.getDefaultWhiteList=o,n.onAttr=r,n.onIgnoreAttr=i},{}],8:[function(e,t,n){function o(e,t){var n=new i(t);return n.process(e)}var r=e("./default"),i=e("./css");n=t.exports=o,n.FilterCSS=i;for(var a in r)n[a]=r[a];"undefined"!=typeof window&&(window.filterCSS=t.exports)},{"./css":6,"./default":7}],9:[function(e,t,n){function o(e,t){function n(){if(!i){var n=r.trim(e.slice(a,l)),o=n.indexOf(":");if(o!==-1){var d=r.trim(n.slice(0,o)),c=r.trim(n.slice(o+1));if(d){var u=t(a,s.length,d,c,n);u&&(s+=u+"; ")}}}a=l+1}e=r.trimRight(e),";"!==e[e.length-1]&&(e+=";");for(var o=e.length,i=!1,a=0,l=0,s="";l<o;l++){var d=e[l];if("/"===d&&"*"===e[l+1]){var c=e.indexOf("*/",l+2);if(c===-1)break;l=c+1,a=l+1,i=!1}else"("===d?i=!0:")"===d?i=!1:";"===d?i||n():"\n"===d&&n()}return r.trim(s)}var r=e("./util");t.exports=o},{"./util":10}],10:[function(e,t,n){t.exports={indexOf:function(e,t){var n,o;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var o,r;if(Array.prototype.forEach)return e.forEach(t,n);for(o=0,r=e.length;o<r;o++)t.call(n,e[o],o,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}}},{}]},{},[2]),t.exports=filterXSS},{}],25:[function(e,t,n){"use strict";var o=e("./../common/env"),r=e("./../common/const"),i=e("./../common/utils"),a={addClass:function(e,t){if(e){e.nodeType&&(e=[e]);var n,o;for(n=e.length-1;n>=0;n--)o=e[n],1!==o.nodeType||a.hasClass(o,t)||(o.className=(o.className+" "+t).trim())}},appendStyle:function(e,t){if(e){var n,o,r,i=e.split(";");for(n=0,o=i.length;n<o;n++)i[n].indexOf(":")>0&&(r=i[n].split(":"),t[r[0].trim()]=r[1].trim())}},attr:function(e,t){var n,o;if(e&&t&&1===e.nodeType)for(n in t)t.hasOwnProperty(n)&&"string"==typeof n&&(o=t[n],o?e.setAttribute(n,o):e.removeAttribute(n))},canEdit:function(e){var t=["script","style"];return e&&(1==e.nodeType||3==e.nodeType)&&(a.isTag(e,"br")||!a.isEmptyDom(e))&&!a.getParentByTagName(e,r.TAG.TMP_TAG,!0,null)&&!(1===e.nodeType&&a.isTag(e,t)||3===e.nodeType&&e.parentNode&&a.isTag(e.parentNode,t))},childNodesFilter:function(e){if(e&&1===e.nodeType){var t,n;for(t=e.childNodes.length-1;t>=0;t--)n=e.childNodes[t],1==n.nodeType?(/link|style|script|meta/gi.test(n.nodeName)&&e.removeChild(n),a.childNodesFilter(n)):3!=n.nodeType&&e.removeChild(n)}},clearStyle:function(e,t,n){if(e.style[t]="",!n)for(;e&&!a.isBlockDom(e);)e.style[t]="",e=e.parentNode},clearStyleFromHtml:function(e,t){var n,o,r=/(<[^<>]* style=(['"]))(((?!(\2|[<>])).)*)/gi,i={};for(t=t?t:[],n=0,o=t.length;n<o;n++)i[t[n]]=!0;return e=e.replace(r,function(e,t,n,o){var r,a,l,s,d,c,u=[t],f=o.split(";");for(d=0,c=f.length;d<c;d++)r=f[d],a=r.indexOf(":"),l="",s="",a>-1&&(l=r.substr(0,a).trim(),s=r.substr(a+1).trim()),l&&i[l]&&u.push(l,":",s,";");return u.join("")})},clone:function(e,t){var n,r,i,l,s,d,c;if(!e)return null;if(t)if(3===e.nodeType)n=o.doc.createTextNode("");else{for(n=o.doc.createElement(e.tagName),i=e.attributes,l={},s=0,d=i.length;s<d;s++)c=i[s],/^id$/i.test(c.nodeName)||(l[c.nodeName]=c.nodeValue);a.attr(n,l)}else 3===e.nodeType?n=o.doc.createTextNode(e.nodeValue):(r=o.doc.createElement("div"),r.innerHTML=e.outerHTML,n=r.childNodes[0]);return n},compareIndexList:function(e,t){var n,o,r,i=Math.min(e.length,t.length);for(n=0;n<i;n++){if(o=e[n],r=t[n],o<r)return-1;if(o>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0},contains:function(e,t){var n=9===e.nodeType?e.documentElement:e,o=t&&t.parentNode;return e===o||!(!o||1!==o.nodeType||!(n.contains?n.contains(o):e.compareDocumentPosition&&16&e.compareDocumentPosition(o)))},convertImageToBase64:function(e,t,n,r){var i=o.doc.createElement("img");i.onload=function(){var e=o.doc.createElement("canvas");e.width=t,e.height=n;var a=e.getContext("2d"),l=t/i.width,s=n/i.height,d=Math.max(l,s);a.scale(d,d),a.drawImage(i,0,0),r(e.toDataURL()),i=null,e=null},i.src=e},createSpan:function(){var e=o.doc.createElement("span");return e.setAttribute(r.ATTR.SPAN,r.ATTR.SPAN),e},css:function(e,t){function n(e){var t=o.win.getComputedStyle(o.doc.body),n=parseInt(t.fontSize,10),r=parseInt(e,10);return isNaN(n)||isNaN(r)||0==n?null:Math.round(r/n*1e3)/1e3+"rem"}if(e&&t&&!a.isTag(e,"br")){var r,i;for(r in t)t.hasOwnProperty(r)&&"string"==typeof r&&(i=t[r],i||0===i?i.toString().indexOf("!important")>0?(a.clearStyle(e,r,!0),e.style.cssText+=r+":"+i):"font-size"==r.toLowerCase()?(a.clearStyle(e,r,!0),i=n(i),i&&(e.style.cssText+=r+":"+i)):e.style[r]=i:a.clearStyle(e,r,!1))}},execCommand:function(){var e=o.doc.execCommand.apply(o.doc,arguments);return o.event.call(r.EVENT.ON_EXEC_COMMAND),e},focus:function(){o.win.WizTemplate?o.win.WizTemplate.focus():o.doc.body.focus()},getBlockParent:function(e,t){return e?a.getParentByFilter(e,function(e){return a.isBlockDom(e)},t):null},getComputedStyle:function(e,t,n){if(!e||3==e.nodeType||!t)return"";for(var r;!r;){var a=o.win.getComputedStyle(e);if(r=a[t]||"",/^rgba?\(.*\)$/i.test(r)&&(r=i.rgb2Hex(r)),e==o.doc.body||!n||r)break;e=e.parentNode}return r},getDocType:function(e){var t=e.doctype;return t=(!t||t.systemId||t.publicId)&&t?'<!DOCTYPE HTML PUBLIC "'+t.publicId+'" "'+t.systemId+'" >':"<!DOCTYPE HTML>"},getDomByIndexList:function(e){if(!e||0===e.length)return null;var t,n,r,i;r=o.doc.body;try{for(t=0,n=e.length-1;t<n;t++)r=r.childNodes[e[t]];return i=e[t],{dom:r,offset:i}}catch(e){return null}},getEndOffset:function(e){return e?3==e.nodeType?e.nodeValue.length:e.childNodes.length:0},getDomIndex:function(e){if(!e||!e.parentNode)return-1;for(var t=0,n=e;n=n.previousSibling;)++t;return t},getDomListA2B:function(e){function t(e,t){e.push(t)}var n,o=e.startDom,i=e.startOffset,l=e.endDom,s=e.endOffset,d=!!e.noSplit,c=!1,u=!1;1==o.nodeType&&i>0&&i<o.childNodes.length&&(o=o.childNodes[i],i=0),1==l.nodeType&&s>0&&s<l.childNodes.length&&(l=l.childNodes[s],s=0),o!==l&&0===s&&(l=a.getPreviousNode(l,!1,o),s=a.isSelfClosingTag(l)?1:a.getEndOffset(l)),o==l&&i!=s?(n=3==o.nodeType,n&&!o.parentNode.getAttribute(r.ATTR.SPAN_DELETE)?(o=d?o:a.splitRangeText(o,i,s),l=o,c=!0,u=!0):1==o.nodeType&&o.childNodes.length>0&&!a.isSelfClosingTag(o)&&(o=o.childNodes[i],l=l.childNodes[s-1],c=!0,u=!0)):o!==l&&(3!=o.nodeType||o.parentNode.getAttribute(r.ATTR.SPAN_DELETE)?1==o.nodeType&&o.childNodes.length>0&&i<o.childNodes.length&&(o=o.childNodes[i],c=!0):(o=d?o:a.splitRangeText(o,i,null),c=!0),3==l.nodeType&&s>0&&!l.parentNode.getAttribute(r.ATTR.SPAN_DELETE)?(l=d?l:a.splitRangeText(l,0,s),u=!0):!a.isSelfClosingTag(l)&&1==l.nodeType&&s>0&&(l=a.getLastDeepChild(l.childNodes[s-1]),u=!0)),c&&(i=0),u&&(s=a.getEndOffset(l));var f=o,g=[];for(i==o.length&&(f=a.getNextNode(f,!1,l));f&&(o!=l||i!=s);){if(f==l||f==l.parentNode){t(g,l);break}if(a.isBody(f)){t(g,f);break}t(g,f),f=a.getNextNode(f,!1,l)}var m=a.getPreviousNode(g[0],!1,null),p=a.getNextNode(g[g.length-1],!1,null);m&&1==m.nodeType&&m.firstChild&&(m=m.firstChild),p&&1==p.nodeType&&p.lastChild&&(p=p.lastChild);var h=a.getEndOffset(m),T=0;return{list:g,startDom:o,startOffset:i,endDom:l,endOffset:s,startDomBak:m,startOffsetBak:h,endDomBak:p,endOffsetBak:T}},getDomPosition:function(e){return e?{top:e.offsetTop,left:e.offsetLeft,height:e.offsetHeight,width:e.offsetWidth}:null},getFirstDeepChild:function(e){if(!e)return null;for(;e.childNodes&&e.childNodes.length>0;)e=e.childNodes[0];return e},getLastDeepChild:function(e){if(!e)return null;for(;e.childNodes&&e.childNodes.length>0;)e=e.childNodes[e.childNodes.length-1];return e},getImageData:function(e){var t=a.getImageSize(e.src),n=o.doc.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");r.drawImage(e,0,0);var i=n.toDataURL("image/png");return i.replace(/^data:image\/(png|jpg);base64,/,"")},getImageSize:function(e){var t=new Image;t.src=e;var n=t.height,o=t.width;return{width:o,height:n}},getIndexListByDom:function(e){for(var t=e,n=[];t&&!a.isBody(t);)n.splice(0,0,a.getDomIndex(t)),t=t.parentNode;return n},getNextNodeCanEdit:function(e,t,n){for(e=a.getNextNode(e,t,n);e&&!a.canEdit(e);)e=a.getNextNode(e,t,n);return e},getNextNode:function(e,t,n){function o(e){return e?t?e.nextElementSibling:e.nextSibling:null}function r(e){return e?t?e.firstElementChild:e.firstChild:null}if(!e||e==n)return null;if(t=!!t,!o(e)&&!e.parentNode)return null;if(o(e))e=o(e);else for(;e.parentNode&&(e=e.parentNode,e!=n);){if(a.isBody(e)){e=null;break}if(o(e)){e=o(e);break}}if(e==n)return e;var i;if(i=r(e),e&&i)for(;i&&(e=i,e!=n);)i=r(i);return e},getPageScroll:function(){var e={};return"undefined"!=typeof o.win.pageYOffset?(e.left=o.win.pageXOffset,e.top=o.win.pageYOffset):"undefined"!=typeof o.doc.compatMode&&"BackCompat"!=o.doc.compatMode?(e.left=o.doc.documentElement.scrollLeft,e.top=o.doc.documentElement.scrollTop):"undefined"!=typeof o.doc.body&&(e.left=o.doc.body.scrollLeft,e.top=o.doc.body.scrollTop),e},getParentByFilter:function(e,t,n){if(e&&!a.isBody(e))for(e=n?e:e.parentNode;e;){if(!t||t(e))return e;if(a.isBody(e))return null;e=e.parentNode}return null},getParentByTagName:function(e,t,n,o){return e?(t=i.listToMap(i.isArray(t)?t:[t]),a.getParentByFilter(e,function(e){return t[e.tagName]&&!(o&&o(e))},n)):null},getParentRoot:function(e){if(!e||0===e.length)return null;var t,n,r,i,l=[];for(i=1==e[0].nodeType?e[0]:e[0].parentNode;i&&!a.isBody(i);)l.push(i),i=i.parentNode;for(t=1,n=e.length;t<n;t++)for(i=e[t];i;){if(a.isBody(i))return o.doc.body;if(r=l.indexOf(i),r>-1){l.splice(0,r);break}i=i.parentNode}return 0===l.length?o.doc.body:l[0]},getPreviousNodeCanEdit:function(e,t,n){for(e=a.getPreviousNode(e,t,n);e&&!a.canEdit(e);)e=a.getPreviousNode(e,t,n);return e},getPreviousNode:function(e,t,n){function o(e){return t?e.previousElementSibling:e.previousSibling}function r(e){return t?e.lastElementChild:e.lastChild}if(!e||e==n)return null;if(t=!!t,o(e))e=o(e);else for(;e.parentNode&&(e=e.parentNode,e!=n);){if(a.isBody(e)){e=null;break}if(o(e)){e=o(e);break}}if(!e)return null;if(e==n&&(3===e.nodeType||1===e.nodeType&&0===e.childNodes.length))return e;var i;if(i=r(e),e&&i)for(;i&&(e=i,e!=n||3!==e.nodeType&&(1!==e.nodeType||0!==e.childNodes.length));)i=r(i);return e},getTab:function(){var e=o.doc.createElement("span");return e.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;",e.childNodes[0]},getTdIndex:function(e){return{x:e.cellIndex,y:e.parentNode.rowIndex,maxX:e.parentNode.cells.length,maxY:e.parentNode.parentNode.rows.length}},getOffset:function(e){var t={top:0,left:0};if(e.offsetParent)for(;e.offsetParent;)t.top+=e.offsetTop,t.left+=e.offsetLeft,e=e.offsetParent;else t.left+=e.offsetLeft,t.top+=e.offsetTop;return t},getWindowSize:function(){return{width:o.doc.documentElement.clientWidth,height:o.doc.documentElement.clientHeight}},getWizAmendParent:function(e){return a.getParentByFilter(e,function(e){return e&&1===e.nodeType&&(e.getAttribute(r.ATTR.SPAN_INSERT)||e.getAttribute(r.ATTR.SPAN_DELETE))},!0)},hasClass:function(e,t){return!(!e||1!==e.nodeType)&&(" "+e.className+" ").indexOf(" "+t+" ")>-1},after:function(e,t){a.before(e,t,!0)},before:function(e,t,n){if(n=!!n,t&&e){var r,a,l,s=t===o.doc.body,d=s?t:t.parentNode,c=s?n?null:o.doc.body.childNodes[0]:n?t.nextSibling:t;if(i.isArray(e))for(l=c,r=e.length-1;r>=0;r--)a=e[r],d.insertBefore(a,l),l=a;else d.insertBefore(e,c)}},isBlockDom:function(e){if(!e)return!1;var t=a.getComputedStyle(e,"display",!1);return!!t&&!/^(inline|inline\-block|inline\-table|none)$/i.test(t)},isBody:function(e){return e&&e==o.doc.body},isEmptyDom:function(e){var t,n,o;if(3===e.nodeType)return o=e.nodeValue,i.isEmpty(o);if(1!==e.nodeType)return!0;if(0===e.childNodes.length)return a.isTag(e,"br")||!a.isSelfClosingTag(e);for(t=0,n=e.childNodes.length;t<n;t++)if(!a.isEmptyDom(e.childNodes[t]))return!1;return!0},isFillChar:function(e,t){return 3==e.nodeType&&!e.nodeValue.replace(new RegExp((t?"^":"")+r.FILL_CHAR),"").length},isInlineDom:function(e){return!a.isBlockDom(e)},isSelfClosingTag:function(e){var t=/^(area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;return 1===e.nodeType&&t.test(e.tagName)},isSameSpan:function(e,t){return!!e&&!!t&&1==e.nodeType&&1==t.nodeType&&a.isTag(e,"span")&&e.tagName==t.tagName&&e.getAttribute(r.ATTR.SPAN)==r.ATTR.SPAN&&a.isSameStyle(e,t)&&a.isSameAttr(e,t)},isSameAttr:function(e,t){var n=e.attributes,o=t.attributes;if(n.length!=o.length)return!1;var a,l,s;for(a=0,l=n.length;a<l;a++)if(s=n[a],"style"!=s.name)if(s.name!==r.ATTR.SPAN_TIMESTAMP){if(!o[s.name]||o[s.name].value!=s.value)return!1}else if(!i.isSameAmendTime(s.value,o[s.name].value))return!1;return!0},isSameStyle:function(e,t){var n={},o={};a.appendStyle(e.getAttribute("style"),n),a.appendStyle(t.getAttribute("style"),o);var r;for(r in n)if(n.hasOwnProperty(r)){if(o[r]!==n[r])return!1;delete n[r],delete o[r]}for(r in o)if(o.hasOwnProperty(r))return!1;return!0},isTag:function(e,t){if(i.isArray(t)||(t=[t]),!e||1!==e.nodeType)return!1;var n,o,r=e.tagName.toLowerCase();for(n=0,o=t.length;n<o;n++)if(r===t[n].toLowerCase())return!0;return!1},isUsableTextNode:function(e){return 3==e.nodeType&&!i.isEmpty(e.nodeValue)},isWizSpan:function(e){return!!e&&!!e.getAttribute(r.ATTR.SPAN)},mergeAtoB:function(e,t,n){a.mergeStyleAToB(e,t,n),a.mergeAttrAtoB(e,t,n)},mergeAttrAtoB:function(e,t,n){if(1==e.nodeType&&1==t.nodeType){var o,r,i,a=e.attributes,l=t.attributes;for(o=0,r=a.length;o<r;o++)i=a[o],"style"!=i.name&&(l[i.name]&&!n||t.setAttribute(i.name,i.value))}},mergeStyleAToB:function(e,t,n){if(1==e.nodeType&&1==t.nodeType){var o=e.getAttribute("style"),r=t.getAttribute("style")||"";if(o){var i={};n?(a.appendStyle(r,i),a.appendStyle(o,i)):(a.appendStyle(o,i),a.appendStyle(r,i));var l=[];for(var s in i)i.hasOwnProperty(s)&&l.push(s+":"+i[s]);t.setAttribute("style",l.join(";"))}}},packageByDiv:function(e){var t,n;for(t=e;t;){if(a.isBlockDom(t)){n=t,t=null;break}if(a.isTag(t.parentNode,["body","td","th"]))break;t=t.parentNode}if(n)return n;for(var r,i=t,l=t;i&&(r=i.previousSibling,r&&!a.isBlockDom(r));)i=r;for(;l&&(r=l.nextSibling,r&&!a.isBlockDom(r));)l=r;n=o.doc.createElement("div"),a.before(n,i);var s,d,r=i;do s=r.nextSibling,n.appendChild(r),d=r===l,r=s;while(!d);return n},removeClass:function(e,t){if(e){e.nodeType&&(e=[e]),i.isArray(t)||(t=[t]);var n,o,r,a;for(n=e.length-1;n>=0;n--)if(r=e[n],1===r.nodeType){for(r.className=" "+r.className+" ",o=t.length;o>=0;o--)a=t[o],r.className=r.className.replace(" "+a+" "," ");r.className=r.className.trim()}}},removeDomByName:function(e){var t,n,r=o.doc.getElementsByName(e);for(t=r.length-1;t>=0;t--)n=r[t],n.parentNode.removeChild(n)},removeDomByTag:function(e){var t,n,r=o.doc.getElementsByTagName(e);for(t=r.length-1;t>=0;t--)n=r[t],n.parentNode.removeChild(n)},removeStyleByNameFromHtml:function(e,t){var n="("+t.join("|")+")",o=new RegExp("<style( ([^<>])+[ ]+|[ ]+)name *= *['\"]"+n+"['\"][^<>]*>[^<]*</style>","ig"),r=new RegExp("<link( ([^<>])+[ ]+|[ ]+)name *= *['\"]"+n+"['\"][^<>]*>","ig");return e.replace(o,"").replace(r,"")},removeDomByTagFromHtml:function(e,t){var n=new RegExp("<"+t+"( [^>]*)?>((?!</"+t+">).|\r|\n)*?</"+t+">","ig");return e.replace(n,"")},peelTag:function(e){var t,n,r=o.doc.querySelectorAll(e);for(t=r.length-1;t>=0;t--){for(n=r[t];n.firstChild;)a.before(n.firstChild,n);n.parentNode.removeChild(n)}},peelTagFromHtml:function(e,t){var n=new RegExp("<"+t+"( [^>]*)?>|</"+t+">","ig");return e.replace(n,"")},removeListFilter:function(e,t){var n,o,r=[];if(!e||!t)return r;for(n=e.length-1;n>=0;n--)o=e[n],t(o)&&r.unshift(e.splice(n,1)[0]);return r},search:function(e,t,n){var o,r,i,a=e.querySelectorAll(t);for(n=n?n:[],o=0,r=a.length;o<r;o++)i=a[o],n.push(i)},setContenteditable:function(e,t){!e&&o.win.WizTemplate?o.win.WizTemplate.setContenteditable(t):(e||(e=o.doc.body),e.setAttribute("contenteditable",t?"true":"false"))},setLayout:function(e){var t,n,i,l,s=e.layerObj,d=e.target,c=e.layout,u=!!e.fixed,f=!!e.noSpace,g=!!e.reverse,m=a.getDomPosition(s),p=d.nodeType?a.getDomPosition(d):d,h=a.getPageScroll(),T=o.doc.documentElement.clientWidth,E=o.doc.documentElement.clientHeight,v=window.getComputedStyle?o.win.getComputedStyle(o.doc.body,null)["margin-top"]:0,b="50%",y="30%",A=0,C=-m.width/2;v&&(v=parseInt(v),isNaN(v)&&(v=0)),u?(t=0,n=T-5,i=0+v,l=E):(t=0+h.left,n=T+h.left-5,i=0+(h.top<=v?0:Math.abs(h.top-v))+v,l=E+h.top),p&&c&&(A=0,C=0,c==r.TYPE.POS.upLeft||c==r.TYPE.POS.upRight?y=p.top-m.height-(f?0:r.AMEND.INFO_SPACE):c==r.TYPE.POS.downLeft||c==r.TYPE.POS.downRight?y=p.top+p.height+(f?0:r.AMEND.INFO_SPACE):c==r.TYPE.POS.leftUp||c==r.TYPE.POS.leftDown?b=p.left-m.width-(f?0:r.AMEND.INFO_SPACE):c!=r.TYPE.POS.rightUp&&c!=r.TYPE.POS.rightDown||(b=p.left+p.width+(f?0:r.AMEND.INFO_SPACE)),c==r.TYPE.POS.upLeft||c==r.TYPE.POS.downLeft?(b=p.left,u&&(b-=h.left)):c==r.TYPE.POS.upRight||c==r.TYPE.POS.downRight?(b=p.left+p.width-m.width,u&&(b-=h.left)):c==r.TYPE.POS.leftUp||c==r.TYPE.POS.rightUp?(y=p.top,u&&(y-=h.top)):c!=r.TYPE.POS.leftDown&&c!=r.TYPE.POS.rightDown||(y=p.top+p.height-m.height,u&&(y-=h.top)),b+m.width>n&&(b=n-m.width),b<t&&(b=t),y+m.height>l&&(y=l-m.height),g&&y<i&&(y=p.top+p.height),(y<i||y+m.height>l)&&(y=i)),a.css(s,{left:b+"px",top:y+"px","margin-top":A+"px","margin-left":C+"px"})},splitRangeText:function(e,t,n){if(!a.isUsableTextNode(e))return e;var r,i,l,s=e.nodeValue;return r=e.parentNode,i=a.createSpan(),!t&&!n||0===t&&n===e.nodeValue.length?r.childNodes.length>1||a.isTag(r,["td","th"])?(r.insertBefore(i,e),i.appendChild(e)):i=r:0===t?(r.insertBefore(i,e),i.innerText=s.substring(t,n),e.nodeValue=s.substring(n)):n&&n!==e.nodeValue.length?(l=o.doc.createTextNode(s.substring(n)),r.insertBefore(i,e.nextSibling),i.innerText=s.substring(t,n),r.insertBefore(l,i.nextSibling),e.nodeValue=s.substring(0,t)):(r.insertBefore(i,e.nextSibling),i.innerText=s.substring(t),e.nodeValue=s.substring(0,t)),i},stripDom:function(e,t){if(e&&3!==e.nodeType){var n,o,r,i={start:null,end:null};for(n=e.childNodes,r=n.length-1;r>=0;r--)o=n[r],t&&!t(o)||(a.after(o,e),i.start?i.end=o:(i.start=o,i.end=o));return e.parentNode.removeChild(e),i}}};t.exports=a},{"./../common/const":15,"./../common/env":17,"./../common/utils":21}],26:[function(e,t,n){"use strict";var o=e("./../common/env"),r=e("./../common/const"),i=e("./domBase");i.clearChild=function(e,t){if(e){var n=t.indexOf(e)>=0;if(!(n||3!=e.nodeType||i.isUsableTextNode(e)||i.getParentByTagName(e,"pre",!1)))return void e.parentNode.removeChild(e);if(!n&&3==e.nodeType)return void(e.nodeValue=e.nodeValue.replace(r.FILL_CHAR_REG,""));if(!n&&1==e.nodeType){var o,a,l=e.childNodes;for(o=l.length-1;o>=0;o--)a=l[o],i.clearChild(a,t);i.mergeChildSpan(e,t),t.indexOf(e)<0&&0===e.childNodes.length&&1==e.nodeType&&!i.isSelfClosingTag(e)&&e.getAttribute(r.ATTR.SPAN)&&e.parentNode.removeChild(e)}}},i.getBodyText=function(){var e=o.doc.body;return e?e.innerText?e.innerText:"":" "},i.getContentHtml=function(e){var t=e&&e.isSaveTemp;o.event.call(r.EVENT.BEFORE_GET_DOCHTML,null);var n,a,l,s,d=i.getDocType(o.doc),c=o.doc.getElementsByTagName("input");for(n=0,a=c.length;n<a;n++)l=c[n],/^test$/i.test(l.getAttribute("type"))&&l.value!==l.getAttribute("value")&&l.setAttribute("value",l.value);for(c=o.doc.getElementsByTagName("textarea"),n=0,a=c.length;n<a;n++)l=c[n],s=void 0===l.innerText?"textContent":"innerText",l.value!==l[s]&&(l[s]=l.value);for(c=o.doc.querySelectorAll("."+r.CLASS.TABLE_CONTAINER),n=0,a=c.length;n<a;n++)i.moveOutFromTableContainer(c[n]);var u=[r.NAME.TMP_STYLE];t||u.push(r.NAME.UNSAVE_STYLE);var f=i.removeStyleByNameFromHtml(o.doc.documentElement.outerHTML,u);f=i.removeDomByTagFromHtml(f,r.TAG.TMP_TAG),f=i.peelTagFromHtml(f,r.TAG.TMP_PLUGIN_TAG),f=f.replace(/<script[^<>]*\/>/gi,"").replace(/<script[^<>]*>(((?!<\/script>).)|(\r?\n))*<\/script>/gi,"");var g=/(<[\w]*[^<>]*[ ]+)contenteditable([ ]*=[ ]*['"][^'"<>]*['"])?/gi;f=f.replace(g,"$1"),f=i.hideTableFromHtml(f),o.win.WizTemplate&&(f=o.win.WizTemplate.hideTemplateFormHtml(f)),f=f.replace(String.fromCharCode(65279),"");var m;return t||(m=new RegExp("(<img[^<>]*)( "+r.ATTR.IMG_EDITING+"=('|\")1\\3)","ig"),f=f.replace(m,"$1")),d+f},i.getPrevBlock=function(e){var t,n=!1;if(i.isBlockDom(e)||i.isTag(e,"br"))return e;for(;e&&(n&&e.childNodes&&e.childNodes.length>0?(e=e.childNodes[e.childNodes.length-1],n=!1):(t=e.previousSibling,t?(e=t,n=!0):(e=e.parentNode,n=!1)),!i.isBlockDom(e)&&!i.isTag(e,"br")););return e},i.getNextBlock=function(e){for(var t,n=!1;e&&(n&&e.childNodes&&e.childNodes.length>0?(e=e.childNodes[0],n=!1):(t=e.nextSibling,t?(e=t,n=!0):(e=e.parentNode,n=!1)),!i.isBlockDom(e)&&!i.isTag(e,"br")););return e},i.hideTableFromHtml=function(e){var t=/(<[^<> ]*[^<>]* class[ ]*=[ ]*['"])([^'"]*)(['"])/i,n=/(<[^<> ]*[^<>]* class[ ]*=[ ]*['"])([^'"]*)(['"])/gi;if(!t.test(e))return e;for(var o,i,a,l=[],s=0;o=n.exec(e);)i=o[2],(" "+i+" ").indexOf(" "+r.CLASS.SELECTED_CELL+" ")>-1&&(a=new RegExp(" "+r.CLASS.SELECTED_CELL+" ","ig"),i=(" "+i+" ").replace(a,"").trim()),l.push(e.substr(s,o.index-s),o[1],i,o[3]),s=o.index+o[0].length;return l.push(e.substr(s)),l.join("")},i.mergeChildSpan=function(e,t){if(e&&1===e.nodeType){var n,o;for(n=0,o=e.children.length;n<o;n++)i.mergeChildSpan(e.children[n],t);i.mergeSiblingSpan(e,t);var a,l=e.children[0];if(l&&t.indexOf(l)<0&&1==e.childNodes.length&&e.getAttribute(r.ATTR.SPAN)==r.ATTR.SPAN&&l.getAttribute(r.ATTR.SPAN)==r.ATTR.SPAN)i.mergeChildToParent(e,l);else for(;l;)t.indexOf(l)<0&&t.indexOf(e)<0&&i.isSameSpan(e,l)?(a=l.previousElementSibling,i.mergeChildToParent(e,l),l=a?a.nextElementSibling:e.children[0]):l=l.nextElementSibling}},i.mergeChildToParent=function(e,t){if(e&&t&&t.parentNode===e){for(;t.childNodes.length>0;)i.before(t.childNodes[0],t);i.mergeAtoB(e,t,!1),i.mergeAtoB(t,e,!0),e.removeChild(t)}},i.mergeSiblingSpan=function(e,t){var n,o,a=e.childNodes[0];if(a)for(;a;)if(n=a.nextSibling,n&&t.indexOf(n)<0&&t.indexOf(a)<0&&i.isSameSpan(a,n)){for(;n.childNodes.length;)o=n.childNodes[0],o&&(o.innerHTML||o.nodeValue&&o.nodeValue!=r.FILL_CHAR)?a.appendChild(o):n.removeChild(o);n.parentNode.removeChild(n)}else a=n},i.modifyChildNodesStyle=function(e,t,n){if(e){var o,r,a=e.childNodes,l=!1;for(o=0;o<a.length;o++)r=a[o],!l&&i.isUsableTextNode(r)?(l=!0,i.modifyStyle(e,t,n)):1==r.nodeType&&i.modifyChildNodesStyle(r,t,n)}},i.modifyNodeStyle=function(e,t,n){return 1==e.nodeType?i.isSelfClosingTag(e)?i.modifyStyle(e,t,n):i.modifyChildNodesStyle(e,t,n):i.isUsableTextNode(e)&&(e=i.splitRangeText(e,null,null),i.modifyStyle(e,t,n)),e},i.modifyNodesStyle=function(e,t,n){if(0!==e.length){var o,r,a;for(o=0,r=e.length;o<r;o++)a=e[o],e[o]=i.modifyNodeStyle(a,t,n)}},i.modifyStyle=function(e,t,n){function o(e){if(e){var t=i.createSpan();for(t.setAttribute("style",e.getAttribute("style")||""),e.removeAttribute("style");e.firstChild;)t.insertBefore(e.firstChild,null);e.insertBefore(t,null)}}var a=i.isSelfClosingTag(e);if(!(n&&n[r.ATTR.SPAN_INSERT]&&a)){var l=e;if(n&&(n[r.ATTR.SPAN_INSERT]||n[r.ATTR.SPAN_DELETE])&&(l=i.getWizAmendParent(e),l?e=null:l=e),e&&!a&&(!i.isTag(e,"span")||e.getAttribute(r.ATTR.SPAN)!==r.ATTR.SPAN))for(l=i.createSpan(),e.insertBefore(l,null);e.childNodes.length>1;)l.insertBefore(e.childNodes[0],null);var s,d,c=[];for(s in t)t.hasOwnProperty(s)&&(d=t[s],d||c.push(s));var u,f=l,g=l;if(c.length>0){for(;f&&!i.isBlockDom(f);)i.isTag(f,"a")&&(u=f),g=f,f=g.parentNode;u?u==g?(o(u),i.splitDomSingle(u.firstChild,l)):(i.splitDomSingle(g,u),o(u),i.splitDomSingle(u.firstChild,l)):i.splitDomSingle(g,l)}i.css(l,t),i.attr(l,n)}},i.moveOutFromTableContainer=function(e){function t(e,t){if(e&&t){var n,o,a,l=!1;for(n=t.childNodes,a=n.length-1;a>=0;a--)o=n[a],1!==o.nodeType||!i.hasClass(o,r.CLASS.TABLE_BODY)&&!i.isTag(o,["table",r.TAG.TMP_TAG])?i.before(o,e,!l):(i.hasClass(o,r.CLASS.TABLE_BODY)||i.isTag(o,"table"))&&(l=!0);0==e.childNodes.length&&(i.removeClass(e,r.CLASS.TABLE_CONTAINER),i.attr(e,{style:""}))}}e&&(t(e,e),t(e,e.querySelector("."+r.CLASS.TABLE_BODY)))},i.removeEmptyParent=function(e){if(e){var t;i.isEmptyDom(e)&&(e===o.doc.body||i.isTag(e,["td","th"])?e.innerHTML="<br/>":(t=e.parentNode,t&&(t.removeChild(e),i.removeEmptyParent(t))))}},i.splitDom=function(e,t){function n(e,t){for(var n,o=e.parentNode,r=e.cloneNode(!1);t;)n=t.nextSibling,r.appendChild(t),t=n;return o.insertBefore(r,e.nextSibling),r}if(!e||!t||!t.previousSibling)return e;for(var o=[t],r=t.parentNode;r&&(o.push(r),r!==e);)r=r.parentNode;if(o[o.length-1]!==e)return e;for(;o.length>1;)o[1]=n(o[1],o[0]),o.splice(0,1);return o[0]},i.splitDomSingle=function(e,t){var n,o,r=i.splitDom(e,t);if(t.nextSibling)o=t.nextSibling;else for(n=t.parentNode;n&&n!=r&&!i.isBlockDom(n)&&(o=n.nextSibling);)n=o.parentNode;o&&i.splitDom(r,o)},t.exports=i},{"./../common/const":15,"./../common/env":17,"./domBase":25}],27:[function(e,t,n){"use strict";function o(){return l.doc.getSelection().toString()}function r(){var e,t,n,o,r=l.doc.getSelection(),i=g.getRange(),a={parent:null,target:null};i||g.restoreCaret()||f.focus(),C.isAmendEditing()&&(i.collapsed||(y.removeSelection(A.getCurUser()),y.removeUserDel(null,A.getCurUser()),r.collapseToEnd())),i=g.getRange(),i.collapsed&&(e=i.startContainer,t=i.startOffset,o=f.getParentByFilter(e,function(e){if(1!==e.nodeType)return!1;var t=e.getAttribute("href");return!(!t||!/^wiz:\/*open_attachment\?/i.test(t))},!0),o&&(n=f.createSpan(),n.innerHTML=s.FILL_CHAR,0===t?(f.before(n,o),g.setRange(n,0)):(f.after(n,o),g.setRange(n,1))));var d=y.fixedAmendRange(),c=C.splitAmendDomByRange(d);return i=g.getRange(),e=i.startContainer,t=i.startOffset,c?(a.target=c,a.parent=c.parentNode):3==e.nodeType&&t>0&&t<e.nodeValue.length?(a.target=f.splitRangeText(e,t,null),a.parent=a.target.parentNode):1==e.nodeType&&t>0&&t<e.childNodes.length?(a.target=e.childNodes[t],a.parent=e):e==l.doc.body||e==l.doc.body.parentNode?(a.target=0===t?l.doc.body.childNodes[0]:null,a.parent=l.doc.body):0===t?(a.target=e,a.parent=e.parentNode):3===e.nodeType?(a.target=e.nextSibling,a.parent=e.parentNode):(a.target=null,a.parent=e),a.target&&1===a.target.nodeType&&!f.isSelfClosingTag(a.target)&&f.isEmptyDom(a.target)&&(a.parent=a.target,f.isTag(a.parent.childNodes[0],"br")?(a.parent.removeChild(a.parent.childNodes[0]),a.target=a.parent.childNodes.length>0?a.parent.childNodes[0]:null):a.target=a.parent.childNodes[0]),a}function i(e){if(e){a&&clearTimeout(a);var t=30,n=30;a=setTimeout(function(){var t,o=e;f.isSelfClosingTag(e)?(o=o.parentNode,t=f.getDomIndex(e)+1):t=f.getEndOffset(e),f.isEmptyDom(o)&&(t=0),g.setRange(o,t,null,null),1===e.nodeType&&(a=setTimeout(function(){e.scrollIntoViewIfNeeded()},n))},t)}}var a,l=e("../common/env"),s=e("../common/const"),d=e("../common/utils"),c=e("../common/dependLoader"),u=e("../common/historyUtils"),f=e("../domUtils/domExtend"),g=e("../rangeUtils/rangeExtend"),m=e("../wizBlockUtils/wizBlockCore"),p=e("../todoUtils/todoCore"),h=e("../codeUtils/codeCore"),T=e("../tableUtils/tableCore"),E=e("../tableUtils/tableUtils"),v=e("../tableUtils/tableZone"),b=e("../imgUtils/imgCore"),y=e("../amend/amendUtils/amendExtend"),A=e("../amend/amendUser"),C=e("../amend/amend"),S=e("../common/wizStyle"),N=e("./editorEvent"),_=e("./tabKey"),D="",w={
init:function(){},on:function(){c.loadCss(l.doc,[l.dependency.files.css.fonts]),f.setContenteditable(null,!0),l.readonly=!1,S.insertTmpEditorStyle(),N.bind(),m.on(),b.on(),h.on(),T.on(),_.on(),p.on(),C.startReverse(),u.start(l.options.maxRedo,l.options.callback.redo),l.client.type.isPhone||l.client.type.isPad?setTimeout(function(){w.setOriginalHtml()},500):w.setOriginalHtml()},off:function(){u.stop(),C.stopReverse(),C.stop(),p.off(),_.off(),T.off(),h.off(),b.off(),m.off(),N.unbind(),l.readonly=!0,f.setContenteditable(null,!1),f.removeDomByName(s.NAME.TMP_STYLE),f.removeDomByTag(s.TAG.TMP_TAG)},find:function(e,t,n,o){if(!e)return!1;var r=l.win.find(e,t,n);return!r&&o&&(g.setRange(l.doc.body,n?l.doc.body.childNodes.length:0),r=l.win.find(e,t,n)),r},getOriginalHtml:function(){return D},insertDom:function(e,t){function n(e){if(1!==e.nodeType)return null;var t;return f.isTag(e,"img")?e:(t=e.querySelectorAll("img"),t.length>0?t[t.length-1]:null)}if(e){var o,a,l,s,c,u,g=r();if(t&&f.isEmptyDom(g.parent)&&!g.target&&(l=g.parent,g.parent=l.parentNode,g.target=l.nextSibling,g.parent.removeChild(l)),d.isArray(e))for(o=0,a=e.length;o<a;o++)g.parent.insertBefore(e[o],g.target),u=n(e[o]),u&&(c=u),s=e[o];else g.parent.insertBefore(e,g.target),c=n(e),s=e;i(s),c&&c.addEventListener("load",function(){i(s)})}},insertHtml:function(e,t){if(e){var n,o,r=l.doc.createElement("div"),i=[];for(r.innerHTML=e,n=0,o=r.childNodes.length;n<o;n++)i.push(r.childNodes[n]);w.insertDom(i,t),r=null,l.event.call(s.EVENT.AFTER_INSERT_DOM)}},modifySelectionDom:function(e,t){var n,o,r=g.getRange(),i=v.getZone();return r&&!r.collapsed||!i.range?void g.modifySelectionDom(e,t):(n=e["text-align"]||null,o=e["text-valign"]||null,delete e["text-align"],delete e["text-valign"],E.eachRange(i.grid,i.range,function(n){n.fake||g.modifyDomsStyle(n.cell.childNodes,e,t,[])}),void((n||o)&&E.setCellAlign(i.grid,i.range,{align:n,valign:o})))},replace:function(e,t,n){if(!e)return!1;var r,i,a=o();return a==e&&(t?(i=l.doc.createTextNode(t),r=l.doc.createElement("span"),r.appendChild(i),t=r.innerHTML,r=null,i=null):t="",f.execCommand("insertHTML",!1,t)),w.find(e,n)},replaceAll:function(e,t,n){if(!e)return!1;for(g.setRange(l.doc.body,0);w.replace(e,t,n););},setOriginalHtml:function(){D=f.getContentHtml()}};t.exports=w},{"../amend/amend":7,"../amend/amendUser":9,"../amend/amendUtils/amendExtend":11,"../codeUtils/codeCore":12,"../common/const":15,"../common/dependLoader":16,"../common/env":17,"../common/historyUtils":18,"../common/utils":21,"../common/wizStyle":22,"../domUtils/domExtend":26,"../imgUtils/imgCore":32,"../rangeUtils/rangeExtend":41,"../tableUtils/tableCore":44,"../tableUtils/tableUtils":47,"../tableUtils/tableZone":48,"../todoUtils/todoCore":49,"../wizBlockUtils/wizBlockCore":52,"./editorEvent":28,"./tabKey":29}],28:[function(e,t,n){"use strict";function o(){w&&clearTimeout(w);var e=E.getRange(),t=b.getZone();!e&&!t.range||t.active||(w=setTimeout(r,300))}function r(){function e(e){return u.doc.queryCommandState(e)?"1":"0"}var t,n,o,r={blockFormat:"",canCreateTable:"1",fontSize:"",fontName:"",foreColor:"",backColor:"",bold:"0",italic:"0",underline:"0",strikeThrough:"0",subscript:"0",superscript:"0",justifyleft:"0",justifycenter:"0",justifyright:"0",justifyfull:"0",InsertOrderedList:"0",InsertUnorderedList:"0"},i=E.getRange(),a=b.getZone(),l=[];if(i||a.range&&!a.active){a.grid&&a.range&&(r.canCreateTable="0"),!i||a.range&&!b.isSingleCell()?(o=y.getAlign(a.grid,a.range),n=b.getSelectedCells(),l=y.getDomsByCellList(n),r.justifyleft="left"==o.align?"1":"0",r.justifycenter="center"==o.align?"1":"0",r.justifyright="right"==o.align?"1":"0",t={"font-size":"","font-family":"","font-weight":"","font-style":"","text-decoration":"",color:"","background-color":""}):(r.blockFormat=u.doc.queryCommandValue("formatBlock"),r.fontName=u.doc.queryCommandValue("fontName"),r.foreColor=p.rgb2Hex(u.doc.queryCommandValue("foreColor")),r.backColor=p.rgb2Hex(u.doc.queryCommandValue("backColor")),r.bold=e("bold"),r.italic=e("italic"),r.underline=e("underline"),r.strikeThrough=e("strikeThrough"),r.subscript=e("subscript"),r.superscript=e("superscript"),r.justifyleft=e("justifyleft"),r.justifycenter=e("justifycenter"),r.justifyright=e("justifyright"),r.justifyfull=e("justifyfull"),r.InsertOrderedList=e("InsertOrderedList"),r.InsertUnorderedList=e("InsertUnorderedList"),t={"font-size":""},l=E.getRangeDomList({noSplit:!0}),l&&(l=l.list.length>0?l.list:[l.startDom]));var s,d,c,f,g;for(s=0,d=l.length;s<d;s++)if(g=l[s],3===g.nodeType||1===g.nodeType){g=3==g.nodeType?g.parentNode:l[s];for(c in t)if(t.hasOwnProperty(c)){if(f=T.getComputedStyle(g,c,!0),!f)continue;0===s?t[c]=f:t[c]!==f&&(t[c]="")}}var m=t["font-size"];m&&(r.fontSize=m),m=t["font-family"],m&&(r.fontName=m),m=t["font-weight"],m&&/bold|bolder/.test(m)&&(r.bold="1"),m=t["font-style"],m&&/italic|oblique/.test(m)&&(r.italic="1"),m=t["text-decoration"],m&&/underline/.test(m)?r.underline="1":m&&/line\-through/.test(m)&&(r.strikeThrough="1"),"#f3f7ff"==r.backColor&&(r.backColor=""),x.triggerListener(N.SelectionChange,[r])}}function i(e,t){var n,o,r,i,a,l=b.getZone(),s=E.getRange(),d=!0,c=[];t=!!t,!(l.range||s&&!s.collapsed&&A.isAmendEditing())||l.range&&s&&!s.collapsed||(!l.range||s&&!s.collapsed?s&&!s.collapsed&&(n=A.getFragmentForCopy(t)):n=b.getFragmentForCopy(t),n&&(A.isAmendEditing()&&(o=n.innerHTML.length,A.fragmentFilter(n),r=n.innerHTML.length,0===r&&o>0&&(alert(m.Err.Copy_Null),d=!1)),d&&(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",n.innerText),e.clipboardData.setData("text/html",n.innerHTML),t&&h.saveSnap(!1),t&&A.isAmendEditing()?(i=C.getCurUser(),a=S.getDeletedStyle(i),!l.range||s&&!s.collapsed?(S.removeSelection(i),S.removeUserDel(null,i),u.doc.getSelection().collapseToEnd(),E.caretFocus()):(c=y.getDomsByCellList(b.getSelectedCells()),E.modifyDomsStyle(c,a.style,a.attr,[]),S.removeUserDel(l.table,i))):t&&l.range&&(!s||s.collapsed)&&v.clearCellValue()),n.innerHTML="",n=null),p.stopEvent(e))}function a(e){var t,n,o,r,i=["<!--StartFragment-->","<body>","<html>"],a=["<!--EndFragment-->","</body>","</html>"];for(o=0,r=i.length;o<r;o++)if(t=i[o],n=e.indexOf(t),n>-1){e=e.substr(n+t.length);break}for(o=0,r=a.length;o<r;o++)t=a[o],n=e.indexOf(t),n>-1&&(e=e.substr(0,n));return e=T.clearStyleFromHtml(e,["color","font-weight","font-style","text-decoration"])}function l(e){var t,n,o,r,i,l,s,d,c,f,g,m,N,_,D,w,x=e.clipboardData.getData("text/html"),O=e.clipboardData.getData("text/plain"),L=E.getRange(),R=b.getZone(),I=null;if((L||R.table||R.range)&&(x||O))if(h.saveSnap(!1),R.table&&R.range){if(x?n=y.getTemplateByHtmlForPaste(a(x)):O&&!b.isSingleCell()?n=y.getTemplateByTxtForPaste(O):(n={isTable:!1,pasteDom:u.doc.createElement("div")},n.pasteDom.appendChild(u.doc.createTextNode(O))),n.isTable){for(i=y.getTableGrid(n.pasteDom),d=i.length,s=i[0]?i[0].length:0,f=R.grid.length-R.range.minY-d,c=R.grid[0].length-R.range.minX-s,_=f;_<0;_++)v.insertRow(!1);for(N=c;N<0;N++)v.insertCol(!1);R=b.getZone(),x?(m=Math.max(R.range.minY+d-1,R.range.maxY),g=Math.max(R.range.minX+s-1,R.range.maxX)):(m=R.range.minY+d-1,g=R.range.minX+s-1),y.eachRange(R.grid,{minY:R.range.minY,maxY:m,minX:R.range.minX,maxX:g},function(e){if(!e.fake)if(D=e.cell,l=i[(e.y-R.range.minY)%d][(e.x-R.range.minX)%s],A.isAmendEditing()){if(E.setRange(D,0,D.lastChild,T.getEndOffset(D.lastChild)),S.removeSelection(C.getCurUser()),S.removeUserDel(D,C.getCurUser()),l.fake)return;if(T.isEmptyDom(D))D.innerHTML=l.cell.innerHTML;else for(;l.cell.firstChild;)D.appendChild(l.cell.firstChild);A.fixPaste(D.firstChild,D.lastChild,C.getCurUser())}else D.innerHTML=l.fake?"":l.cell.innerHTML}),b.setStart(R.grid[R.range.minY][R.range.minX].cell).setEnd(R.grid[m][g].cell)}else if(!L&&R.range&&(o=R.grid[R.range.minY][R.range.minX].cell,b.setStart(o).setEnd(o),E.setRange(o,0,o.lastChild,T.getEndOffset(o.lastChild))),A.isAmendEditing()?A.readyForPaste():(t=S.fixedAmendRange(),A.splitAmendDomByRange(t)),L=E.getRange()){if(3===L.startContainer.nodeType&&L.startOffset>0&&L.startOffset<L.startContainer.nodeValue.length?(o=T.splitRangeText(L.startContainer,L.startOffset,L.startOffset),I=o,r=!1):(o=L.startContainer,3===o.nodeType?r=0===L.startOffset:L.startOffset>0&&!T.isEmptyDom(o)?(o=o.childNodes[L.startOffset-1],r=!1):r=!0,T.isTag(o,["td","th"])&&T.isEmptyDom(o)&&(o.innerHTML="",o.appendChild(T.createSpan()),o=o.childNodes[0],r=!1)),w=n.pasteDom.lastChild,r)for(;n.pasteDom.firstChild&&o;)T.before(n.pasteDom.firstChild,o,!1);else for(;n.pasteDom.lastChild&&o;)T.before(n.pasteDom.lastChild,o,!0);I&&I.parentNode.removeChild(I),E.setRange(w,T.getEndOffset(w))}p.stopEvent(e)}else A.isAmendEditing()?A.readyForPaste():(t=S.fixedAmendRange(),A.splitAmendDomByRange(t))}function s(e){p.stopEvent(e);var t=u.doc.getSelection();E.backupCaret(),t.removeAllRanges(),setTimeout(function(){E.restoreCaret(),u.client.sendCmdToWiznote(f.CLIENT_EVENT.WizEditorPaste)},0)}function d(e){var t,n,o,r=[];for(t in e)n=e[t],o=("undefined"==typeof n?"undefined":c(n)).toLowerCase(),"string"!=o&&"number"!=o||("string"==o&&(n='"'+n.replace(/"/g,'\\"')+'"'),r.push('"'+t+'":'+n));return"{"+r.join(",")+"}"}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=e("../common/env"),f=e("../common/const"),g=e("../common/lang"),m=g.getLang(),p=e("../common/utils"),h=e("../common/historyUtils"),T=e("../domUtils/domBase"),E=e("../rangeUtils/rangeExtend"),v=e("../tableUtils/tableCore"),b=e("../tableUtils/tableZone"),y=e("../tableUtils/tableUtils"),A=e("../amend/amend"),C=e("../amend/amendUser"),S=e("../amend/amendUtils/amendExtend"),N={SelectionChange:"selectionchange"},_={selectionchange:[]},D={},w=null,x={TYPE:N,bind:function(){x.unbind(),u.doc.addEventListener("click",O.onClick),u.doc.addEventListener("compositionstart",O.onCompositionstart),u.doc.addEventListener("compositionend",O.onCompositionend),u.doc.addEventListener("copy",O.onCopy),u.doc.addEventListener("cut",O.onCut),u.doc.addEventListener("dragstart",O.onDragStart),u.doc.addEventListener("dragenter",O.onDragEnter),u.doc.addEventListener("drop",O.onDrop),u.doc.addEventListener("keydown",O.onKeydown),u.doc.addEventListener("keyup",O.onKeyup),u.doc.addEventListener("mousedown",O.onMousedown),u.doc.addEventListener("mousemove",O.onMousemove),u.doc.addEventListener("mouseover",O.onMouseover),u.doc.addEventListener("mouseup",O.onMouseup),u.doc.addEventListener("orientationchange",O.onOrientationchange),u.doc.addEventListener("paste",O.onPaste),u.doc.addEventListener("scroll",O.onScroll),u.doc.addEventListener("selectstart",O.onSelectionStart),u.doc.addEventListener("selectionchange",O.onSelectionChange),(u.client.type.isIOS||u.client.type.isAndroid)&&(u.doc.addEventListener("touchend",O.onTouchEnd),u.doc.addEventListener("touchstart",O.onTouchStart))},unbind:function(){u.doc.removeEventListener("click",O.onClick),u.doc.removeEventListener("compositionstart",O.onCompositionstart),u.doc.removeEventListener("compositionend",O.onCompositionend),u.doc.removeEventListener("copy",O.onCopy),u.doc.removeEventListener("cut",O.onCut),u.doc.removeEventListener("dragstart",O.onDragStart),u.doc.removeEventListener("dragenter",O.onDragEnter),u.doc.removeEventListener("drop",O.onDrop),u.doc.removeEventListener("keydown",O.onKeydown),u.doc.removeEventListener("keyup",O.onKeyup),u.doc.removeEventListener("mousedown",O.onMousedown),u.doc.removeEventListener("mousemove",O.onMousemove),u.doc.removeEventListener("mouseover",O.onMouseover),u.doc.removeEventListener("mouseup",O.onMouseup),u.doc.removeEventListener("orientationchange",O.onOrientationchange),u.doc.removeEventListener("paste",O.onPaste),u.doc.removeEventListener("scroll",O.onScroll),u.doc.removeEventListener("selectstart",O.onSelectionStart),u.doc.removeEventListener("selectionchange",O.onSelectionChange),u.doc.removeEventListener("touchend",O.onTouchEnd),u.doc.removeEventListener("touchstart",O.onTouchStart)},startTrackEvent:function(e,t){D[t]||(D[t]=function(e){u.client.sendCmdToWiznote(f.CLIENT_EVENT.WizEditorTrackEvent,{id:t,e:d(e)})},u.doc.addEventListener(e,D[t]))},stopTrackEvent:function(e,t){D[t]&&(u.doc.removeEventListener(e,D[t]),delete D[t])},addListener:function(e,t){if(t&&"function"==typeof t){var n=_[e];if(n){var r,i;for(r=0,i=n.length;r<i;r++)if(n[r]===t)return;n.push(t),e==N.SelectionChange&&u.event.add(f.EVENT.ON_SELECT_CHANGE,o)}}},removeListener:function(e,t){if(!t||"function"==typeof t){var n=_[e];if(n){var r;for(r=n.length-1;r>=0;r--)n[r]!==t&&t||n.splice(r,1);0===n.length&&u.event.remove(f.EVENT.ON_SELECT_CHANGE,o)}}},triggerListener:function(e,t){var n=_[e];if(n){var o,r,i;for(o=0,r=n.length;o<r;o++)i=n[o],i.apply(this,t)}}},O={onClick:function(e){u.event.call(f.EVENT.ON_CLICK,e)},onCompositionstart:function(e){u.event.call(f.EVENT.ON_COMPOSITION_START,e)},onCompositionend:function(e){u.event.call(f.EVENT.ON_COMPOSITION_END,e)},onCopy:function(e){i(e,!1)},onCut:function(e){h.saveSnap(!1),i(e,!0)},onDragStart:function(e){u.event.call(f.EVENT.ON_DRAG_START,e)},onDragEnter:function(e){u.event.call(f.EVENT.ON_DRAG_ENTER,e)},onDrop:function(e){u.event.call(f.EVENT.ON_DROP,e)},onKeydown:function(e){var t=e.keyCode||e.which;u.win.WizQtEditor&&u.client.type.isMac&&83===t&&(u.client.type.isLinux&&e.ctrlKey||!u.client.type.isLinux&&e.metaKey)&&u.win.WizQtEditor.saveCurrentNote();var n,o,r,i,a=b.getZone();return u.win.WizQtEditor&&u.client.type.isMac&&!a.range&&(n=u.doc.getSelection(),o=e.shiftKey?"extend":"move",e.metaKey&&37==t||e.ctrlKey&&65==t?(r="backward",i="lineboundary"):e.metaKey&&39==t||e.ctrlKey&&69==t?(r="forward",i="lineboundary"):e.metaKey&&38==t?(r="backward",i="documentboundary"):e.metaKey&&40==t?(r="forward",i="documentboundary"):e.ctrlKey&&80==t?(r="backward",i="line"):e.ctrlKey&&78==t?(r="forward",i="line"):e.ctrlKey&&70==t?(r="forward",i="character"):e.ctrlKey&&66==t&&(r="backward",i="character")),r?(n.modify(o,r,i),void E.fixScroll()):void u.event.call(f.EVENT.ON_KEY_DOWN,e)},onKeyup:function(e){u.event.call(f.EVENT.ON_KEY_UP,e),u.client.type.isIOS&&E.fixScroll()},onMousedown:function(e){u.event.call(f.EVENT.ON_MOUSE_DOWN,e)},onMousemove:function(e){u.event.call(f.EVENT.ON_MOUSE_MOVE,e)},onMouseover:function(e){u.event.call(f.EVENT.ON_MOUSE_OVER,e)},onMouseup:function(e){u.event.call(f.EVENT.ON_MOUSE_UP,e)},onOrientationchange:function(e){u.event.call(f.EVENT.ON_ORIENTATION_CHANGE,e),u.client.type.isIOS&&E.fixScroll()},onPaste:function(e){return u.client.type.isIOS?void s(e):(l(e),void u.event.call(f.EVENT.ON_PASTE,e))},onScroll:function(e){u.event.call(f.EVENT.ON_SCROLL,e)},onSelectionStart:function(e){u.event.call(f.EVENT.ON_SELECT_START,e)},onSelectionChange:function(e){u.event.call(f.EVENT.ON_SELECT_CHANGE,e),u.client.type.isIOS&&E.fixScroll()},onTouchEnd:function(e){u.event.call(f.EVENT.ON_TOUCH_END,e)},onTouchStart:function(e){u.event.call(f.EVENT.ON_TOUCH_START,e)}};t.exports=x},{"../amend/amend":7,"../amend/amendUser":9,"../amend/amendUtils/amendExtend":11,"../common/const":15,"../common/env":17,"../common/historyUtils":18,"../common/lang":19,"../common/utils":21,"../domUtils/domBase":25,"../rangeUtils/rangeExtend":41,"../tableUtils/tableCore":44,"../tableUtils/tableUtils":47,"../tableUtils/tableZone":48}],29:[function(e,t,n){"use strict";function o(e){var t=s.getRange();if(t){if(e)return d.saveSnap(!1),l.execCommand("outdent"),!0;var n=t.startContainer,o=t.startOffset,r=l.isTag(n,["ul","ol","li"]),i=l.getParentByTagName(n,["ul","ol","li"],!1),a=0===o&&l.getFirstDeepChild(i)===n,u=n.tagName;return"TD"!=u&&(!t.collapsed||a||r?(d.saveSnap(!1),l.execCommand("indent"),!0):!(3!==n.nodeType&&!l.getParentByTagName(n,["a","b","body","div","font","html","i","p","span","strong","u"]))&&(d.saveSnap(!1),l.execCommand("insertHTML",!1,c),!0))}}var r=e("../common/env"),i=e("../common/const"),a=e("../common/utils"),l=e("../domUtils/domExtend"),s=e("../rangeUtils/rangeExtend"),d=e("../common/historyUtils"),c="&nbsp; &nbsp;&nbsp;",u={bind:function(){u.unbind(),r.event.add(i.EVENT.ON_KEY_DOWN,u.handler.onKeyDown)},unbind:function(){r.event.remove(i.EVENT.ON_KEY_DOWN,u.handler.onKeyDown)},handler:{onKeyDown:function(e){var t=e.keyCode||e.which;9===t&&o(e.shiftKey)&&a.stopEvent(e)}}},f={init:function(e){c=e},on:function(){u.bind()},off:function(){u.unbind()}};t.exports=f},{"../common/const":15,"../common/env":17,"../common/historyUtils":18,"../common/utils":21,"../domUtils/domExtend":26,"../rangeUtils/rangeExtend":41}],30:[function(e,t,n){"use strict";function o(e,t){var n;if(n=d.win.getSelection(),t&&(s=-1,l=null,p=[]),m=!1,t&&d.win.find(e,!1,!1,!0)){for(l=r(),n.collapse(d.doc.body,d.doc.body.childNodes.length);d.win.find(e,!1,!0);)r();m=!!d.doc.querySelector(c.TAG.TMP_HIGHLIGHT_TAG),m&&!t&&(n.collapse(document.body,0),n.extend(document.body,0))}}function r(){var e,t,n,o=d.win.getSelection();if(e=o.getRangeAt(0),u.getParentByTagName(e.startContainer,c.TAG.TMP_HIGHLIGHT_TAG))return null;for(t=document.createElement(c.TAG.TMP_HIGHLIGHT_TAG),t.style.backgroundColor=f,n=e.extractContents();n.firstChild;)t.appendChild(n.firstChild);return u.isEmptyDom(t)||e.insertNode(t),t}function i(){if(p=d.doc.querySelectorAll(c.TAG.TMP_HIGHLIGHT_TAG),0!==p.length){var e,t;for(t=p.length-1;t>=0;t--)if(e=p[t],e===l)return void(s=t);s=0,l=p[0]}}function a(e){var t=s;if(0!==p.length){if(e>=p.length?e=0:e<0&&(e=p.length-1),e===t)return void(l.style.backgroundColor=g);p[t].style.backgroundColor=f,s=e,l=p[s],l.style.backgroundColor=g,l.scrollIntoViewIfNeeded&&l.scrollIntoViewIfNeeded()}}var l,s,d=e("./../common/env"),c=e("./../common/const"),u=e("./../domUtils/domExtend"),f=(e("./../rangeUtils/rangeExtend"),"yellow"),g="#FF9632",m=!1,p=[],h={on:function(e,t){if(h.off(),!e)return!1;e.length>1&&(t=!1);var n,r;for(n=0,r=e.length;n<r;n++)o(e[n],t);return t&&(i(),a(s)),m},off:function(){u.peelTag(c.TAG.TMP_HIGHLIGHT_TAG)},next:function(){a(s+1)},previous:function(){a(s-1)}};t.exports=h},{"./../common/const":15,"./../common/env":17,"./../domUtils/domExtend":26,"./../rangeUtils/rangeExtend":41}],31:[function(e,t,n){"use strict";function o(e){var t=new RegExp("("+s.CLASS.IMG_NOT_DRAG+")|("+s.CLASS.IMG_ATTACHMENT+")","i"),n=!(!e||!c.isTag(e,"img")||t.test(e.className)||!e.src);if(!n)return n;var o;return l.readonly?(o=c.getParentByFilter(e,function(e){return e&&c.isTag(e,"a")&&/^(http|https|wiz|wiznote|wiznotecmd):/.test(e.getAttribute("href"))},!0),!o):(o=c.getParentByFilter(e,function(e){return e&&c.isTag(e,"a")&&/^(wiz|wiznote|wiznotecmd):open_attachment/.test(e.getAttribute("href"))},!0),!o)}function r(e){var t=e.target;if(o(t))return l.client.sendCmdToWiznote(s.CLIENT_EVENT.WizReaderClickImg,{src:t.src,imgList:l.client.type.isAndroid?u.getAll(!0).join(","):null}),d.stopEvent(e),!1}function i(e){var t=e.target;if(o(t)){var n,r=l.doc.querySelectorAll("img["+s.ATTR.IMG_EDITING+"]"),i={};for(i[s.ATTR.IMG_EDITING]="",n=r.length-1;n>=0;n--)c.attr(r[n],i);i[s.ATTR.IMG_EDITING]=1,c.attr(t,i),l.client.sendCmdToWiznote(s.CLIENT_EVENT.WizEditorClickImg,{src:t.src})}}function a(){}var l=e("./../common/env"),s=e("./../common/const"),d=e("./../common/utils"),c=e("./../domUtils/domExtend"),u=e("./imgUtils"),f={bind:function(){f.unbind(),l.event.add(s.EVENT.ON_CLICK,f.handler.onClick)},unbind:function(){l.event.remove(s.EVENT.ON_CLICK,f.handler.onClick)},handler:{onClick:function(e){l.readonly&&(l.client.type.isIOS||l.client.type.isAndroid)?r(e):!l.readonly&&l.client.type.isAndroid&&i(e)}}},g={init:a,bind:f.bind,unbind:f.unbind};t.exports=g},{"./../common/const":15,"./../common/env":17,"./../common/utils":21,"./../domUtils/domExtend":26,"./imgUtils":34}],32:[function(e,t,n){"use strict";var o=e("./../common/env"),r=e("./imgResize"),i=e("./imgClick"),a={on:function(){o.client.type.isPhone||o.client.type.isPad||(r.init(),r.bind()),i.init(),i.bind()},off:function(){o.client.type.isPhone||o.client.type.isPad||r.unbind(),i.unbind()}};t.exports=a},{"./../common/env":17,"./imgClick":31,"./imgResize":33}],33:[function(e,t,n){"use strict";function o(){C=N.doc.body.style.cursor||"",N.win.WizImgResizeOnGetHTML=function(){}}function r(e){if(e&&e.tagName&&"img"==e.tagName.toLowerCase()&&g(e)){var t=a();t&&(d(e),f(e),I.bindContainer(t))}}function i(){c(),u(),A=null,N.doc.body.style.cursor=C}function a(){var e=l();if(e)return e;e=N.doc.createElement(_.TAG.TMP_TAG),w.addClass(e,_.CLASS.IMG_RESIZE_CONTAINER),e.setAttribute("contenteditable","false"),e.setAttribute(R,"unsave");for(var t=0;t<O.length;t++){var n=N.doc.createElement("div");w.addClass(n,_.CLASS.IMG_RESIZE_HANDLE),w.addClass(n,O[t]),w.attr(n,{"data-type":O[t]}),e.appendChild(n)}return N.doc.body.appendChild(e),e}function l(){var e=N.doc.body.querySelector("."+_.CLASS.IMG_RESIZE_CONTAINER);return!e||e.length<1?null:e}function s(e,t){if(e&&t){var n=e.offset,o=n.left,r=n.top,i=e.width,a=e.height,l=t.getAttribute("data-type"),s=0,d=0;switch(l){case"lt":s=o-7,d=r-7;break;case"tm":s=o+(i-7)/2,d=r-7;break;case"rt":s=o+i,d=r-7;break;case"rm":s=o+i,d=r+(a-7)/2;break;case"rb":s=o+i,d=r+a;break;case"bm":s=o+(i-7)/2,d=r+a;break;case"lb":s=o-7,d=r+a;break;case"lm":s=o-7,d=r+(a-7)/2}w.css(t,{left:s+"px",top:d+"px"})}}function d(e){if(e){var t=l();if(t)for(var n=t.querySelectorAll("."+_.CLASS.IMG_RESIZE_HANDLE),o={offset:w.getOffset(e),width:e.width,height:e.height},r=0;r<n.length;r++){var i=n[r];s(o,i),i.style.visibility="inherit"}}}function c(){var e=N.doc.querySelectorAll("."+_.CLASS.IMG_RESIZE_ACTIVE);if(e&&0!==e.length){var t;for(t=e.length-1;t>=0;t--)w.removeClass(e[t],_.CLASS.IMG_RESIZE_ACTIVE)}}function u(){var e=l();e&&(I.unbindContainer(e),e.parentNode.removeChild(e))}function f(e){e&&(c(),w.addClass(e,_.CLASS.IMG_RESIZE_ACTIVE),e.attributes[_.ATTR.IMG_RATE]=e.width/e.height,A=e,x.setRange(e.parentNode,w.getDomIndex(e)+1))}function g(e){if(!e)return!1;var t=e.getAttribute("class");return!t||-1==t.indexOf(_.CLASS.IMG_NOT_DRAG)}function m(e){var t=l();t&&(t.style.display=e?"block":"none",e||i())}function p(e,t,n,o){if(o){var r=n*e,i=t/e;r<t?r=t:i=n,o.width=r,o.height=i}}var h,T,E,v,b,y,A,C,S,N=e("./../common/env"),_=e("./../common/const"),D=e("./../common/utils"),w=e("./../domUtils/domExtend"),x=e("../rangeUtils/rangeExtend"),O=["lt","tm","rt","rm","rb","bm","lb","lm"],L="",R="wiz_style",I={bind:function(){I.unbind(),N.event.add(_.EVENT.BEFORE_GET_DOCHTML,I.handler.beforeGetDocHtml),N.event.add(_.EVENT.ON_KEY_DOWN,I.handler.onKeyDown),N.event.add(_.EVENT.ON_MOUSE_DOWN,I.handler.onMouseDown),N.event.add(_.EVENT.ON_MOUSE_MOVE,I.handler.onMouseMove),N.event.add(_.EVENT.ON_MOUSE_UP,I.handler.onMouseUp)},bindContainer:function(e){I.unbindContainer(e),e.addEventListener("mousedown",I.handler.onContainerMouseDown)},unbind:function(){N.event.remove(_.EVENT.ON_KEY_DOWN,I.handler.onKeyDown),N.event.remove(_.EVENT.ON_MOUSE_DOWN,I.handler.onMouseDown),N.event.remove(_.EVENT.ON_MOUSE_MOVE,I.handler.onMouseMove),N.event.remove(_.EVENT.ON_MOUSE_UP,I.handler.onMouseUp)},unbindContainer:function(e){e.removeEventListener("mousedown",I.handler.onContainerMouseDown)},handler:{beforeGetDocHtml:function(){i()},onKeyDown:function(e){var t,n,o=e.keyCode||e.which;!A||8!==o&&46!==o||(t=A.parentNode,t&&(n=w.getDomIndex(A),x.setRange(t,n,t,n+1))),m(!1)},onContainerMouseDown:function(e){var t=e.target||e.srcElement;L=t.getAttribute("data-type");var n,o,r,i=N.doc.querySelector("."+_.CLASS.IMG_RESIZE_ACTIVE);if(i){switch(n=e.pageX,o=e.pageY,r=w.getOffset(i),L){case"lt":h=r.left-n,T=r.top-o,b=r.left+i.width,y=r.top+i.height,S="nw-resize";break;case"tm":h=void 0,T=r.top-o,S="n-resize";break;case"rt":h=n-i.width-r.left,T=r.top-o,b=r.left,y=r.top+i.height,S="ne-resize";break;case"rm":h=n-i.width-r.left,T=void 0,S="e-resize";break;case"rb":h=n-i.width-r.left,T=o-i.height-r.top,S="se-resize";break;case"bm":h=void 0,T=o-i.height-r.top,b=r.left/2,y=r.top,S="s-resize";break;case"lb":h=r.left-n,T=o-i.height-r.top,b=r.left+i.width,y=r.top,S="sw-resize";break;case"lm":h=r.left-n,T=void 0,S="w-resize"}D.stopEvent(e)}},onMouseDown:function(e){e.target!==A&&(m(!1),c())},onMouseMove:function(e){var t,n,o,r=N.doc.querySelector("."+_.CLASS.IMG_RESIZE_ACTIVE);if(r&&(t=w.getOffset(r),L)){n=e.pageX,o=e.pageY,N.doc.body.style.cursor=S;var i,a,l,s,c;switch(E&&v||(E=n,v=o),L){case"tm":r.width=r.width,o<t.top?r.height+=v-o:(c=r.height-(o-v)-T,r.height=c<0?0:c);break;case"rm":s=n-t.left-h,r.width=s<0?0:s,r.height=r.height,r.attributes[_.ATTR.IMG_RATE]=r.width/r.height;break;case"bm":r.width=r.width,c=o-y-T,r.height=c<0?0:c,r.attributes[_.ATTR.IMG_RATE]=r.width/r.height;break;case"lm":r.height=r.height,n<t.left?r.width+=E-n:(s=r.width-(n-E)-h,r.width=s<0?0:s);break;case"lt":i=Number(r.attributes[_.ATTR.IMG_RATE]),a=b-n,l=y-o,a-=h,l-=T,a=a<0?0:a,l=l<0?0:l,p(i,a,l,r);break;case"rt":i=Number(r.attributes[_.ATTR.IMG_RATE]),a=n-b,l=y-o,a-=h,l-=T,a=a<0?0:a,l=l<0?0:l,p(i,a,l,r);break;case"lb":i=Number(r.attributes[_.ATTR.IMG_RATE]),a=b-n,l=o-y,a-=h,l-=T,a=a<0?0:a,l=l<0?0:l,p(i,a,l,r);break;case"rb":i=Number(r.attributes[_.ATTR.IMG_RATE]),a=n-t.left,l=o-t.top,a-=h,l-=T,a=a<0?0:a,l=l<0?0:l,p(i,a,l,r)}if(r.style.cssText){var u=r.style.cssText;u=u.replace(/width:\s*\d+.?\d+px;?/gi,"width: "+r.width+"px").replace(/height:\s*\d+.?\d+px;?/gi,"height: "+r.height+"px"),r.style.cssText=u}E=n,v=o,d(r),N.event.call(_.EVENT.UPDATE_RENDER,null)}},onMouseUp:function(e){var t=e.target||e.srcElement;t&&t.tagName&&"img"==t.tagName.toLowerCase()&&r(t),L="",E=void 0,v=void 0,b=void 0,y=void 0,h=void 0,T=void 0,N.doc.body.style.cursor=C}}},B={init:o,bind:I.bind,unbind:I.unbind};t.exports=B},{"../rangeUtils/rangeExtend":41,"./../common/const":15,"./../common/env":17,"./../common/utils":21,"./../domUtils/domExtend":26}],34:[function(e,t,n){"use strict";function o(e,t){if(!e||e.className&&e.className.indexOf("wiz-todo")>-1)return!1;var n=e.src;if(!n)return!1;var o,r=/^(http|https|ftp):/,i=/^(data):/;return o=!i.test(n),o&&t?!r.test(n):o}var r=e("./../common/env"),i=e("./../common/const"),a=e("./../domUtils/domBase"),l={getAll:function(e){var t,n,i=r.doc.images,a=[],l={};for(t in i)i.hasOwnProperty(t)&&(n=decodeURIComponent(i[t].src),o(i[t],e)&&!l[n]&&(a.push(n),l[n]=!0));return a},getImageSize:function(e){var t=new Image;t.src=e;var n=t.height,o=t.width;return{width:o,height:n}},getImageData:function(e){var t=l.getImageSize(e.src),n=r.doc.createElement("canvas");n.width=t.width,n.height=t.height;var o=n.getContext("2d");o.drawImage(e,0,0);var i=n.toDataURL("image/png");return i.replace(/^data:image\/(png|jpg);base64,/,"")},makeAttachmentDom:function(e,t){var n,o,l,s,d=[];for(n=r.doc.createElement("div"),n.style.margin="15px auto",o=r.doc.createElement("a"),o.href="wiz://open_attachment?guid="+e,l=r.doc.createElement("img"),l.style.width="280px",l.style.height="auto",l.src=t,a.addClass(l,i.CLASS.IMG_ATTACHMENT),o.appendChild(l),n.appendChild(o),d.push(n),s=0;s<2;s++)n=r.doc.createElement("div"),n.appendChild(r.doc.createElement("br")),d.push(n);return d},makeDomByPath:function(e){var t,n,o,i,a=[],l=[];for(e.indexOf("*")?l=e.split("*"):l.push(e),o=0,i=l.length;o<i;o++)t=r.doc.createElement("div"),a.push(t),n=r.doc.createElement("img"),n.src=l[o],n.style.maxWidth="100%",t.insertBefore(n,null),t=r.doc.createElement("div"),t.insertBefore(r.doc.createElement("br"),null),a.push(t);return t=r.doc.createElement("div"),t.insertBefore(r.doc.createElement("br"),null),a.push(t),a},remove:function(e){var t,n,o=r.doc.querySelectorAll(e);for(n=o.length-1;n>=0;n--)t=o[n],t.parentElement.removeChild(t)},replaceSrc:function(e,t){var n,o,l=r.doc.querySelectorAll(e),s={};for(s[i.ATTR.IMG_EDITING]="",o=l.length-1;o>=0;o--)n=l[o],n.src=t,a.attr(n,s)}};t.exports=l},{"./../common/const":15,"./../common/env":17,"./../domUtils/domBase":25}],35:[function(e,t,n){"use strict";function o(){var e,t,n,o,i=d.getRange();i&&(e=r(i.startContainer,i.startOffset),e?t=0:(e=i.startContainer,t=i.startOffset),i.collapsed?(n=e,o=s.getEndOffset(e)):(n=r(i.endContainer,i.endOffset),n?o=s.getEndOffset(n):(n=i.endContainer,o=i.endOffset)),d.setRange(e,t,n,o))}function r(e,t){return 1===e.nodeType&&e.childNodes.length>t&&(e=e.childNodes[t]),s.getParentByTagName(e,"a",!0)}var i=e("../common/env"),a=e("../common/const"),l=e("../common/historyUtils"),s=e("../domUtils/domExtend"),d=e("../rangeUtils/rangeExtend"),c={bind:function(){c.unbind(),i.event.add(a.EVENT.ON_KEY_DOWN,c.handler.onKeyDown)},unbind:function(){i.event.remove(a.EVENT.ON_KEY_DOWN,c.handler.onKeyDown)},handler:{onKeyDown:function(e){var t,n,o,r,l,d,c=e.keyCode||e.which;if(32==c||13==c){for(o=i.doc.getSelection(),r=o.getRangeAt(0).cloneRange(),t=r.startContainer;1==t.nodeType&&r.startOffset>0&&(t=r.startContainer.childNodes[r.startOffset-1]);)r.setStart(t,s.getEndOffset(t)),r.collapse(!0),t=r.startContainer;do{if(0===r.startOffset){for(t=r.startContainer.previousSibling;t&&1==t.nodeType;)t=t.lastChild;if(!t||s.isFillChar(t,!1))break;l=t.nodeValue.length}else t=r.startContainer,l=r.startOffset;r.setStart(t,l-1),d=r.toString().charCodeAt(0)}while(160!=d&&32!=d);if(r.toString().replace(a.FILL_CHAR_REG,"").match(/(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i)){for(;r.toString().length&&!/^(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i.test(r.toString());)try{r.setStart(r.startContainer,r.startOffset+1)}catch(e){for(t=r.startContainer;!(n=t.nextSibling);){if(s.isBody(t))return;t=t.parentNode}r.setStart(n,0)}if(s.getParentByTagName(r.startContainer,"a",!0,null))return;var u,f=i.doc.createElement("a"),g=i.doc.createTextNode(" "),m=r.extractContents();f.href=m.textContent,f.appendChild(i.doc.createTextNode(m.textContent)),u=f.getAttribute("href").replace(a.FILL_CHAR_REG,""),u=/^(?:https?:\/\/)/gi.test(u)?u:"http://"+u,f.href=u,r.insertNode(f),f.parentNode.insertBefore(g,f.nextSibling),r.setStart(g,0),r.collapse(!0),o.removeAllRanges(),o.addRange(r)}}}}},u={on:function(){c.bind()},off:function(){c.unbind()},getCurrentLink:function(){var e=d.getRange();if(!e)return"";var t=s.getParentByTagName(e.startContainer,"a",!0);return t?t.href:""},removeSelectedLink:function(){o(),l.saveSnap(!1),s.execCommand("unlink",!1,!1)},setCurrentLink:function(e){e&&(o(),l.saveSnap(!1),s.execCommand("createLink",!1,e))}};t.exports=u},{"../common/const":15,"../common/env":17,"../common/historyUtils":18,"../domUtils/domExtend":26,"../rangeUtils/rangeExtend":41}],36:[function(e,t,n){"use strict";var o,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};o="object"===("undefined"==typeof n?"undefined":r(n))&&"function"==typeof e?n:{},function(){function e(e){return e}function t(e){return!1}function n(){}function r(){}n.prototype={chain:function(t,n){var o=this[t];if(!o)throw new Error("unknown hook "+t);o===e?this[t]=n:this[t]=function(e){var t=Array.prototype.slice.call(arguments,0);return t[0]=o.apply(null,t),n.apply(null,t)}},set:function(e,t){if(!this[e])throw new Error("unknown hook "+e);this[e]=t},addNoop:function(t){this[t]=e},addFalse:function(e){this[e]=t}},o.HookCollection=n,r.prototype={set:function(e,t){this["s_"+e]=t},get:function(e){return this["s_"+e]}},o.Converter=function(t){function o(e){return e=e.replace(/^[ ]{0,3}\[([^\[\]]+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(\n+)/gm,function(e,t,n,o,r,i,a){return t=t.toLowerCase(),U.set(t,D(n)),r?o+a:(i&&z.set(t,i.replace(/"/g,"&quot;")),"")})}function i(e){return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,l),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,l),e=e.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,l),e=e.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,l),
e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,l)}function a(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(F.push(e)-1)+"K\n\n"}function l(e,t){return a(t)}function s(e,t,n){e=P.preBlockGamut(e,W),e=h(e);var o="<hr />\n";return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,o),e=e.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,o),e=e.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,o),e=T(e),e=b(e),e=N(e),e=P.postBlockGamut(e,W),e=i(e),e=_(e,t,n)}function d(e){return e=P.preSpanGamut(e),e=y(e),e=c(e),e=w(e),e=g(e),e=u(e),e=O(e),e=e.replace(/~P/g,"://"),e=D(e),e=V(e),e=e.replace(/  +\n/g," <br>\n"),e=P.postSpanGamut(e)}function c(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=k(t,"!"==e.charAt(1)?"\\`*_/":"\\`*_")})}function u(e){return e.indexOf("[")===-1?e:(e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,f),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,f),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,f))}function f(e,t,n,o,r,i,a,l){void 0==l&&(l="");var s=t,d=n.replace(/:\/\//g,"~P"),c=o.toLowerCase(),u=r,f=l;if(""==u)if(""==c&&(c=d.toLowerCase().replace(/ ?\n/g," ")),u="#"+c,void 0!=U.get(c))u=U.get(c),void 0!=z.get(c)&&(f=z.get(c));else{if(!(s.search(/\(\s*\)$/m)>-1))return s;u=""}u=B(u);var g='<a href="'+u+'"';return""!=f&&(f=m(f),f=k(f,"*_"),g+=' title="'+f+'"'),g+=">"+d+"</a>"}function g(e){return e.indexOf("![")===-1?e:(e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,p),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,p))}function m(e){return e.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function p(e,t,n,o,r,i,a,l){var s=t,d=n,c=o.toLowerCase(),u=r,f=l;if(f||(f=""),""==u){if(""==c&&(c=d.toLowerCase().replace(/ ?\n/g," ")),u="#"+c,void 0==U.get(c))return s;u=U.get(c),void 0!=z.get(c)&&(f=z.get(c))}d=k(m(d),"*_[]()"),u=k(u,"*_");var g='<img src="'+u+'" alt="'+d+'"';return f=m(f),f=k(f,"*_"),g+=' title="'+f+'"',g+=" />"}function h(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return"<h1>"+d(t)+"</h1>\n\n"}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return"<h2>"+d(t)+"</h2>\n\n"}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,n){var o=t.length;return"<h"+o+">"+d(n)+"</h"+o+">\n\n"})}function T(e,t){e+="~0";var n,o=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return H?e=e.replace(o,function(e,o,r){var i=o;n=E(r);var a=v(i,n,t),l=a.list_str.replace(/\s+$/,""),s="<"+n;return l=s+">"+l+"</"+a.list_type+">\n",n=a.list_type,l}):(o=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,e=e.replace(o,function(e,t,o,r){var i=t,a=o;n=E(r);var l=v(a,n),s="<"+n,d=i+s+">\n"+l.list_str+"</"+l.list_type+">\n";return n=l.list_type,d})),e=e.replace(/~0/,"")}function E(e){return e.search(/[*+-]/g)>-1?"ul":"ol"}function v(e,t,n){H++,e=e.replace(/\n{2,}$/,"\n"),e+="~0";var o=new RegExp("(^[ \\t]*)([*+-]|\\d+[.])[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1([*+-]|\\d+[.])[ \\t]+))","gm"),r=!1;return e=e.replace(o,function(e,n,o,i){var a=i,l=E(o),d=/\n\n$/.test(a),c=d||a.search(/\n{2,}/)>-1,u=c||r;a=s(R(a),!0,!u);var f="";return l!=t&&(f="</"+t+">\n<"+l+">\n",t=l),f+="<li>"+a+"</li>\n",r=d,f}),e=e.replace(/~0/g,""),H--,{list_str:e,list_type:t}}function b(e){return e+="~0",e=e.replace(/(?:\n\n|^\n?)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){var o=t,r=n;return o=A(R(o)),o=I(o),o=o.replace(/^\n+/g,""),o=o.replace(/\n+$/g,""),o="<pre><code>"+o+"\n</code></pre>","\n\n"+o+"\n\n"+r}),e=e.replace(/~0/,"")}function y(e){return e=e.replace(/(^|[^\\`])(`+)(?!`)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,o,r){var i=o;return i=i.replace(/^([ \t]*)/g,""),i=i.replace(/[ \t]*$/g,""),i=A(i),i=i.replace(/:\/\//g,"~P"),t+"<code>"+i+"</code>"})}function A(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=k(e,"*_{}[]\\",!1)}function C(e){return e.indexOf("*")===-1&&e.indexOf("_")===-1?e:(e=G(e),e=e.replace(/(^|[\W_])(?:(?!\1)|(?=^))(\*|_)\2(?=\S)([^\r]*?\S)\2\2(?!\2)(?=[\W_]|$)/g,"$1<strong>$3</strong>"),e=e.replace(/(^|[\W_])(?:(?!\1)|(?=^))(\*|_)(?=\S)((?:(?!\2)[^\r])*?\S)\2(?!\2)(?=[\W_]|$)/g,"$1<em>$3</em>"),Y(e))}function S(e){return e.indexOf("*")===-1&&e.indexOf("_")===-1?e:(e=G(e),e=e.replace(/(?=[^\r][*_]|[*_])(^|(?=\W__|(?!\*)[\w\W_]\*\*|\w\*\*\w)[^\r])(\*\*|__)(?!\2)(?=\S)((?:|[^\r]*?(?!\2)[^\r])(?=\S_|\w|.\*\*(?:[\w\W_]|$)).)(?=__(?:\W|$)|\*\*(?:[^*]|$))\2/g,"$1<strong>$3</strong>"),e=e.replace(/(?=[^\r][*_]|[*_])(^|(?=\W_|(?!\*)(?:[\w\W_]\*|\D\*(?=\w)\D))[^\r])(\*|_)(?!\2\2\2)(?=\S)((?:(?!\2)[^\r])*?(?=[^\s_]_|(?=[\w\W])\D\*\D|[^\s*]\*(?:[\w\W_]|$)).)(?=_(?:\W|$)|\*(?:[^*]|$))\2/g,"$1<em>$3</em>"),Y(e))}function N(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var n=t;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=s(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^  /gm,"~0"),n=n.replace(/~0/g,"")}),a("<blockquote>\n"+n+"\n</blockquote>")})}function _(e,t,n){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var o=e.split(/\n{2,}/g),r=[],i=/~K(\d+)K/,a=o.length,l=0;l<a;l++){var s=o[l];i.test(s)?r.push(s):/\S/.test(s)&&(s=d(s),s=s.replace(/^([ \t]*)/g,n?"":"<p>"),n||(s+="</p>"),r.push(s))}if(!t){a=r.length;for(var l=0;l<a;l++)for(var c=!0;c;)c=!1,r[l]=r[l].replace(/~K(\d+)K/g,function(e,t){return c=!0,F[t]})}return r.join("\n\n")}function D(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?!([a-z\/?!][^<>]*>)|~D)/gi,"&lt;")}function w(e){return e=e.replace(/\\(\\)/g,M),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,M)}function x(e,t,n,o,r,i){if(/^<[^<>]*(https?|ftp)/.test(i))return e;if(t)return e;if(")"!==o.charAt(o.length-1))return"<"+n+o+">";for(var a=o.match(/[()]/g),l=0,s=0;s<a.length;s++)"("===a[s]?l<=0?l=1:l++:l--;var d="";if(l<0){var c=new RegExp("\\){1,"+-l+"}$");o=o.replace(c,function(e){return d=e,""})}if(d){var u=o.charAt(o.length-1);X.test(u)||(d=u+d,o=o.substr(0,o.length-1))}return"<"+n+o+">"+d}function O(e){e=e.replace(Z,x);var t=function(e,t){var n=B(t);return'<a href="'+n+'">'+P.plainLinkText(t)+"</a>"};return e=e.replace(/<((https?|ftp):[^'">\s]+)>/gi,t)}function L(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)})}function R(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")}function I(e){if(!/\t/.test(e))return e;var t,n=["    ","   ","  "," "],o=0;return e.replace(/[\n\t]/g,function(e,r){return"\n"===e?(o=r+1,e):(t=(r-o)%4,o=r+1,n[t])})}function B(e){return e=m(e),e=k(e,"*_:()[]")}function k(e,t,n){var o="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(o="\\\\"+o);var r=new RegExp(o,"g");return e=e.replace(r,M)}function M(e,t){var n=t.charCodeAt(0);return"~E"+n+"E"}var P=this.hooks=new n;P.addNoop("plainLinkText"),P.addNoop("preConversion"),P.addNoop("postNormalization"),P.addNoop("preBlockGamut"),P.addNoop("postBlockGamut"),P.addNoop("preSpanGamut"),P.addNoop("postSpanGamut"),P.addNoop("postConversion");var U,z,F,H;t=t||{};var G=e,Y=e;t.nonAsciiLetters&&!function(){var e=/[Q\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u203f-\u2040\u2054\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua67f-\ua697\ua717-\ua71f\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe33-\ufe34\ufe4d-\ufe4f\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff3f\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/g,t="Q".charCodeAt(0),n="A".charCodeAt(0),o="Z".charCodeAt(0),r="a".charCodeAt(0)-o-1;G=function(i){return i.replace(e,function(e){for(var i,a=e.charCodeAt(0),l="";a>0;)i=a%51+n,i>=t&&i++,i>o&&(i+=r),l=String.fromCharCode(i)+l,a=a/51|0;return"Q"+l+"Q"})},Y=function(e){return e.replace(/Q([A-PR-Za-z]{1,3})Q/g,function(e,i){for(var a,l=0,s=0;s<i.length;s++)a=i.charCodeAt(s),a>o&&(a-=r),a>t&&a--,a-=n,l=51*l+a;return String.fromCharCode(l)})}}();var V=t.asteriskIntraWordEmphasis?S:C;this.makeHtml=function(e){if(U)throw new Error("Recursive call to converter.makeHtml");return U=new r,z=new r,F=[],H=0,e=P.preConversion(e),e=e.replace(/~/g,"~T"),e=e.replace(/\$/g,"~D"),e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n"),e="\n\n"+e+"\n\n",e=I(e),e=e.replace(/^[ \t]+$/gm,""),e=P.postNormalization(e),e=i(e),e=o(e),e=s(e),e=L(e),e=e.replace(/~D/g,"$$"),e=e.replace(/~T/g,"~"),e=P.postConversion(e),F=z=U=null,e};var W=function(e){return s(e)},K="[-A-Z0-9+&@#/%?=~_|[\\]()!:,.;]",j="[-A-Z0-9+&@#/%=~_|[\\])]",Z=new RegExp('(="|<)?\\b(https?|ftp)(://'+K+"*"+j+")(?=$|\\W)","gi"),X=new RegExp(j,"i")}}(),t.exports=o},{}],37:[function(e,t,n){"use strict";var o={};!function(){function e(e){return e.replace(/^\s+|\s+$/g,"")}function t(e){return e.replace(/\s+$/g,"")}function n(e){return e.replace(new RegExp("^(\\t|[ ]{1,4})","gm"),"")}function r(e,t){return e.indexOf(t)!=-1}function i(e,t){return e.replace(/<[^>]*>?/gi,function(e){return e.match(t)?e:""})}function a(e,t){for(var n={},o=0;o<e.length;o++)n[e[o]]=e[o];for(o=0;o<t.length;o++)n[t[o]]=t[o];var r=[];for(var i in n)n.hasOwnProperty(i)&&r.push(n[i]);return r}function l(e){return""!=e.charAt(0)&&(e=""+e),""!=e.charAt(e.length-1)&&(e+=""),e}function s(e){return""==e.charAt(0)&&(e=e.substr(1)),""==e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),e}function d(e,t){return i(c(e,t),h)}function c(e,t){var n=t.blockGamutHookCallback(e);return n=g(n),n=n.replace(/~D/g,"$$").replace(/~T/g,"~"),n=t.previousPostConversion(n)}function u(e){return e.replace(/\\\|/g,"~I").replace(/\\:/g,"~i")}function f(e){return e.replace(/~I/g,"|").replace(/~i/g,":")}function g(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)})}function m(e){return e.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function p(e,t){var n=t;return n=n.replace(/&\#8220;/g,'"'),n=n.replace(/&\#8221;/g,'"'),n=n.replace(/&\#8216;/g,"'"),n=n.replace(/&\#8217;/g,"'"),n=n.replace(/&\#8212;/g,"---"),n=n.replace(/&\#8211;/g,"--"),n=n.replace(/&\#8230;/g,"...")}var h=new RegExp(["^(<\\/?(a|abbr|acronym|applet|area|b|basefont|","bdo|big|button|cite|code|del|dfn|em|figcaption|","font|i|iframe|img|input|ins|kbd|label|map|","mark|meter|object|param|progress|q|ruby|rp|rt|s|","samp|script|select|small|span|strike|strong|","sub|sup|textarea|time|tt|u|var|wbr)[^>]*>|","<(br)\\s?\\/?>)$"].join(""),"i");Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),o.Extra=function(){this.converter=null,this.hashBlocks=[],this.footnotes={},this.usedFootnotes=[],this.attributeBlocks=!1,this.googleCodePrettify=!1,this.highlightJs=!1,this.tableClass="",this.tabWidth=4},o.Extra.init=function(e,t){var n=new o.Extra,i=[],a=[],l=[],s=["unHashExtraBlocks"];return t=t||{},t.extensions=t.extensions||["all"],r(t.extensions,"all")&&(t.extensions=["tables","fenced_code_gfm","def_list","attr_list","footnotes","smartypants","strikethrough","newlines"]),a.push("wrapHeaders"),r(t.extensions,"attr_list")&&(i.push("hashFcbAttributeBlocks"),a.push("hashHeaderAttributeBlocks"),s.push("applyAttributeBlocks"),n.attributeBlocks=!0),r(t.extensions,"fenced_code_gfm")&&(a.push("fencedCodeBlocks"),i.push("fencedCodeBlocks")),r(t.extensions,"tables")&&a.push("tables"),r(t.extensions,"def_list")&&a.push("definitionLists"),r(t.extensions,"footnotes")&&(i.push("stripFootnoteDefinitions"),a.push("doFootnotes"),s.push("printFootnotes")),r(t.extensions,"smartypants")&&s.push("runSmartyPants"),r(t.extensions,"strikethrough")&&l.push("strikethrough"),r(t.extensions,"newlines")&&l.push("newlines"),e.hooks.chain("postNormalization",function(e){return n.doTransform(i,e)+"\n"}),e.hooks.chain("preBlockGamut",function(e,t){return n.blockGamutHookCallback=t,e=u(e),e=n.doTransform(a,e)+"\n",e=f(e)}),e.hooks.chain("postSpanGamut",function(e){return n.doTransform(l,e)}),n.previousPostConversion=e.hooks.postConversion,e.hooks.chain("postConversion",function(e){return e=n.doTransform(s,e),n.hashBlocks=[],n.footnotes={},n.usedFootnotes=[],e}),"highlighter"in t&&(n.googleCodePrettify="prettify"===t.highlighter,n.highlightJs="highlight"===t.highlighter),"table_class"in t&&(n.tableClass=t.table_class),n.converter=e,n},o.Extra.prototype.doTransform=function(e,t){for(var n=0;n<e.length;n++)t=this[e[n]](t);return t},o.Extra.prototype.hashExtraBlock=function(e){return"\n<p>~X"+(this.hashBlocks.push(e)-1)+"X</p>\n"},o.Extra.prototype.hashExtraInline=function(e){return"~X"+(this.hashBlocks.push(e)-1)+"X"},o.Extra.prototype.unHashExtraBlocks=function(e){function t(){var o=!1;e=e.replace(/(?:<p>)?~X(\d+)X(?:<\/p>)?/g,function(e,t){o=!0;var r=parseInt(t,10);return n.hashBlocks[r]}),o===!0&&t()}var n=this;return t(),e},o.Extra.prototype.wrapHeaders=function(e){function t(e){return"\n"+e+"\n"}return e=e.replace(/^.+[ \t]*\n=+[ \t]*\n+/gm,t),e=e.replace(/^.+[ \t]*\n-+[ \t]*\n+/gm,t),e=e.replace(/^\#{1,6}[ \t]*.+?[ \t]*\#*\n+/gm,t)};var T="\\{[ \\t]*((?:[#.][-_:a-zA-Z0-9]+[ \\t]*)+)\\}",E=new RegExp("^(#{1,6}.*#{0,6})[ \\t]+"+T+"[ \\t]*(?:\\n|0x03)","gm"),v=new RegExp("^(.*)[ \\t]+"+T+"[ \\t]*\\n(?=[\\-|=]+\\s*(?:\\n|0x03))","gm"),b=new RegExp("^(```[ \\t]*[^{\\s]*)[ \\t]+"+T+"[ \\t]*\\n(?=([\\s\\S]*?)\\n```[ \\t]*(\\n|0x03))","gm");o.Extra.prototype.hashHeaderAttributeBlocks=function(e){function t(e,t,o){return"<p>~XX"+(n.hashBlocks.push(o)-1)+"XX</p>\n"+t+"\n"}var n=this;return e=e.replace(E,t),e=e.replace(v,t)},o.Extra.prototype.hashFcbAttributeBlocks=function(e){function t(e,t,o){return"<p>~XX"+(n.hashBlocks.push(o)-1)+"XX</p>\n"+t+"\n"}var n=this;return e.replace(b,t)},o.Extra.prototype.applyAttributeBlocks=function(e){var t=this,n=new RegExp('<p>~XX(\\d+)XX</p>[\\s]*(?:<(h[1-6]|pre)(?: +class="(\\S+)")?(>[\\s\\S]*?</\\2>))',"gm");return e=e.replace(n,function(e,n,o,r,i){if(!o)return"";for(var l=parseInt(n,10),s=t.hashBlocks[l],d=s.match(/#[^\s#.]+/g)||[],c=d[0]?' id="'+d[0].substr(1,d[0].length-1)+'"':"",u=s.match(/\.[^\s#.]+/g)||[],f=0;f<u.length;f++)u[f]=u[f].substr(1,u[f].length-1);var g="";return r&&(u=a(u,[r])),u.length>0&&(g=' class="'+u.join(" ")+'"'),"<"+o+c+g+i})},o.Extra.prototype.tables=function(t){function n(t,n,r,i,a,l){n=n.replace(/^ *[|]/m,""),r=r.replace(/^ *[|]/m,""),i=i.replace(/^ *[|]/gm,""),n=n.replace(/[|] *$/m,""),r=r.replace(/[|] *$/m,""),i=i.replace(/[|] *$/gm,"");for(var s=r.split(/ *[|] */),c=[],u=0;u<s.length;u++){var f=s[u];f.match(/^ *-+: *$/m)?c[u]=' align="right"':f.match(/^ *:-+: *$/m)?c[u]=' align="center"':f.match(/^ *:-+ *$/m)?c[u]=' align="left"':c[u]=""}var g=n.split(/ *[|] */),m=g.length,p=o.tableClass?' class="'+o.tableClass+'"':"",h=["<table",p,">\n","<thead>\n","<tr>\n"].join("");for(u=0;u<m;u++){var T=d(e(g[u]),o);h+=["  <th",c[u],">",T,"</th>\n"].join("")}h+="</tr>\n</thead>\n";var E=i.split("\n");for(u=0;u<E.length;u++)if(!E[u].match(/^\s*$/)){for(var v=E[u].split(/ *[|] */),b=m-v.length,y=0;y<b;y++)v.push("");for(h+="<tr>\n",y=0;y<m;y++){var A=d(e(v[y]),o);h+=["  <td",c[y],">",A,"</td>\n"].join("")}h+="</tr>\n"}return h+="</table>\n",o.hashExtraBlock(h)}var o=this,r=new RegExp(["^","[ ]{0,3}","[|]","(.+)\\n","[ ]{0,3}","[|]([ ]*[-:]+[-| :]*)\\n","(","(?:[ ]*[|].*\\n?)*",")","(?:\\n|$)"].join(""),"gm"),i=new RegExp(["^","[ ]{0,3}","(\\S.*[|].*)\\n","[ ]{0,3}","([-:]+[ ]*[|][-| :]*)\\n","(","(?:.*[|].*\\n?)*",")","(?:\\n|$)"].join(""),"gm");return t=t.replace(r,n),t=t.replace(i,n)},o.Extra.prototype.stripFootnoteDefinitions=function(e){var t=this;return e=e.replace(/\n[ ]{0,3}\[\^(.+?)\]\:[ \t]*\n?([\s\S]*?)\n{1,2}((?=\n[ ]{0,3}\S)|$)/g,function(e,n,o){return n=m(n),o+="\n",o=o.replace(/^[ ]{0,3}/g,""),t.footnotes[n]=o,"\n"})},o.Extra.prototype.doFootnotes=function(e){var t=this;if(t.isConvertingFootnote===!0)return e;var n=0;return e=e.replace(/\[\^(.+?)\]/g,function(e,o){var r=m(o),i=t.footnotes[r];if(void 0===i)return e;n++,t.usedFootnotes.push(r);var a='<a href="#fn_'+r+'" id="fnref_'+r+'" title="See footnote" class="footnote">'+n+"</a>";return t.hashExtraInline(a)})},o.Extra.prototype.printFootnotes=function(e){var t=this;if(0===t.usedFootnotes.length)return e;e+='\n\n<div class="footnotes">\n<hr>\n<ol>\n\n';for(var n=0;n<t.usedFootnotes.length;n++){var o=t.usedFootnotes[n],r=t.footnotes[o];t.isConvertingFootnote=!0;var i=d(r,t);delete t.isConvertingFootnote,e+='<li id="fn_'+o+'">'+i+' <a href="#fnref_'+o+'" title="Return to article" class="reversefootnote">&#8617;</a></li>\n\n'}return e+="</ol>\n</div>"},o.Extra.prototype.fencedCodeBlocks=function(e){function t(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/~D/g,"$$"),e=e.replace(/~T/g,"~")}var n=this;return e=e.replace(/(?:^|\n)```[ \t]*(\S*)[ \t]*\n([\s\S]*?)\n```[ \t]*(?=\n)/g,function(e,o,r){var i=o,a=r,l=n.googleCodePrettify?' class="prettyprint linenums"':"",s="";i&&(s=n.googleCodePrettify||n.highlightJs?' class="language-'+i+'"':' class="'+i+'"');var d=["<pre",l,"><code",s,">",t(a),"</code></pre>"].join("");return n.hashExtraBlock(d)})},o.Extra.prototype.educatePants=function(e){var t=this,n="",o=0;e.replace(/(?:<!--[\s\S]*?-->)|(<)([a-zA-Z1-6]+)([^\n]*?>)([\s\S]*?)(<\/\2>)/g,function(r,i,a,l,s,d,c){var u=e.substring(o,c);return n+=t.applyPants(u),t.smartyPantsLastChar=n.substring(n.length-1),o=c+r.length,i?(/code|kbd|pre|script|noscript|iframe|math|ins|del|pre/i.test(a)?t.smartyPantsLastChar=s.substring(s.length-1):s=t.educatePants(s),void(n+=i+a+l+s+d)):void(n+=r)});var r=e.substring(o);return n+=t.applyPants(r),t.smartyPantsLastChar=n.substring(n.length-1),n},o.Extra.prototype.applyPants=function(e){return e=e.replace(/---/g,"&#8212;").replace(/--/g,"&#8211;"),e=e.replace(/\.\.\./g,"&#8230;").replace(/\.\s\.\s\./g,"&#8230;")},o.Extra.prototype.runSmartyPants=function(e){return this.smartyPantsLastChar="",e=this.educatePants(e),e=e.replace(/(<([a-zA-Z1-6]+)\b([^\n>]*?)(\/)?>)/g,p)},o.Extra.prototype.definitionLists=function(t){var n=new RegExp(["(\\x02\\n?|\\n\\n)","(?:","(","(","[ ]{0,3}","((?:[ \\t]*\\S.*\\n)+)","\\n?","[ ]{0,3}:[ ]+",")","([\\s\\S]+?)","(","(?=\\0x03)","|","(?=","\\n{2,}","(?=\\S)","(?!","[ ]{0,3}","(?:\\S.*\\n)+?","\\n?","[ ]{0,3}:[ ]+",")","(?!","[ ]{0,3}:[ ]+",")",")",")",")",")"].join(""),"gm"),o=this;return t=l(t),t=t.replace(n,function(t,n,r){var i=e(o.processDefListItems(r));return i="<dl>\n"+i+"\n</dl>",n+o.hashExtraBlock(i)+"\n\n"}),s(t)},o.Extra.prototype.processDefListItems=function(o){var r=this,i=new RegExp(["(\\x02\\n?|\\n\\n+)","(","[ ]{0,3}","(?![:][ ]|[ ])","(?:\\S.*\\n)+?",")","(?=\\n?[ ]{0,3}:[ ])"].join(""),"gm"),a=new RegExp(["\\n(\\n+)?","(","[ ]{0,3}","[:][ ]+",")","([\\s\\S]+?)","(?=\\n*","(?:","\\n[ ]{0,3}[:][ ]|","<dt>|\\x03",")",")"].join(""),"gm");return o=l(o),o=o.replace(/\n{2,}(?=\\x03)/,"\n"),o=o.replace(i,function(t,n,o){for(var i=e(o).split("\n"),a="",l=0;l<i.length;l++){var s=i[l];s=d(e(s),r),a+="\n<dt>"+s+"</dt>"}return a+"\n"}),o=o.replace(a,function(e,o,i,a){return o||a.match(/\n{2,}/)?(a=Array(i.length+1).join(" ")+a,a=n(a)+"\n\n",a="\n"+c(a,r)+"\n"):(a=t(a),a=d(n(a),r)),"\n<dd>"+a+"</dd>\n"}),s(o)},o.Extra.prototype.strikethrough=function(e){return e.replace(/([\W_]|^)~T~T(?=\S)([^\r]*?\S[\*_]*)~T~T([\W_]|$)/g,"$1<del>$2</del>$3")},o.Extra.prototype.newlines=function(e){return e.replace(/(<(?:br|\/li)>)?\n/g,function(e,t){return t?e:" <br>\n"})}}(),t.exports=o.Extra},{}],38:[function(e,t,n){"use strict";function o(){var e=p.Document.createElement("span");e.innerHTML="<math>a</math>",e.style.opacity=0,p.Document.body.appendChild(e);var t=e.innerText;if(e.parentNode.removeChild(e),!t)for(var n,o,r,i=p.Document.getElementsByTagName("math");i.length>0;)n=i[0],o=n.parentNode,r=p.Document.createElement("span"),r.innerText=n.textContent,o.insertBefore(r,n),o.removeChild(n)}var r=e("./../common/env"),i=e("./../common/utils"),a=e("./../common/xss"),l=e("./../common/dependLoader"),s=e("./../common/scriptLoader"),d=e("./Markdown.Converter"),c=e("./Markdown.Extra"),u=!1,f="#wizToc",g={markdown:function(){p.Win.prettyPrint(),p.tocRender(),p.flowRender(),p.sequenceRender()},mathJax:function(){}},m={init:function(){return p.Win=r.win,p.Document=r.doc,p.Dependency=r.dependency,m},markdown:function(e){e&&(p.callback.markdown=p.addCb(g.markdown,e.markdown),p.callback.mathJax=p.addCb(g.mathJax,e.mathJax)),l.loadCss(p.Document,p.getDependencyFiles("css","markdown")),l.loadJs(p.Document,p.getDependencyFiles("js","markdown"),function(){p.markdownConvert({}),u&&p.mathJaxRender()})},mathJax:function(e){e&&(p.callback.mathJax=p.addCb(g.mathJax,e)),p.mathJaxRender()}},p={Utils:i,Win:null,Document:null,Dependency:null,callback:{markdown:null,mathJax:null},getDependencyFiles:function(e,t){var n,o,r,i,a,l,s,d=[];for(n=0,o=p.Dependency[e][t].length;n<o;n++)if(r=p.Dependency[e][t][n],"css"==e)d.push(p.Dependency.files[e][r]);else{for(s=[],i=0,a=r.length;i<a;i++)l=r[i],s.push(p.Dependency.files[e][l]);d.push(s)}return d},addCb:function(e,t){return t?function(){e.apply(this,arguments),t.apply(this,arguments)}:e},cb:function(e,t){e&&e.apply(this,t?t:[])},getBodyTxt:function(e){o();var t=e.innerText;return t||(t=p.Utils.getInnerText(e)),t=t.replace(String.fromCharCode(65279),""),t.replace(/\u00a0/g," ")},markdownConvert:function(e){function t(e){return e=e.replace(/@@(\d+)@@/g,function(e,t){return s[t]}),s=null,e}function n(e,t){var n=l.slice(e,t+1).join("");if(!n.match(/`/i)){for(n=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");t>e;)l[t]="",t--;l[e]="@@"+s.length+"@@",s.push(n)}r=i=a=null}function o(e){r=i=a=null,s=[],l=e.replace(/\r\n?/g,"\n").split(m);for(var t,o=1,d=l.length;o<d;o+=2)t=l[o],g&&t.match(/\n|`/)?r=i=a=null:"@"===t.charAt(0)?(l[o]="@@"+s.length+"@@",s.push(t)):r?t===i?f?a=o:n(r,o):t.match(/\n.*\n/)?(a&&(o=a,n(r,o)),r=i=a=null,f=0):"{"===t?f++:"}"===t&&f&&f--:/^\$\$?$/.test(t)?(g=t.length<2,r=o,i=t,f=0):"begin"===t.substr(1,5)&&(r=o,i="\\end"+t.substr(6),f=0);return a&&n(r,a),l.join("")}var r,i,a,l,s,f,g=!1,m=/(\$\$?|\\(?:begin|end)\{[a-z]*\*?\}|\\[\\{}$]|[{}]|(?:\n\s*)+|@@\d+@@)/i,h=$(p.Document),T=e.container?e.container:h.find("body");T.addClass("markdown-body");var E=new d.Converter({nonAsciiLetters:!0,asteriskIntraWordEmphasis:!0});c.init(E,{extensions:"all",highlighter:"prettify"});var v;try{p.Utils.markdownPreProcess(T[0]),v=p.tocReady(p.getBodyTxt(T[0]));var b=v.replace(/\n/g,"\\n").replace(/\r\n?/g,"\n").replace(/```(.*\n)+?```/gm,"");u=/(\$\$?)[^$\n]+\1/.test(b),u&&(v=o(v)),v=E.makeHtml(v),u&&(v=t(v)),v=p.xssFilter(v),T[0].innerHTML=v}catch(e){console.error(e)}try{p.cb(p.callback.markdown,[u])}catch(e){console.error(e)}},tocReady:function(e){return e.replace(/(^[ ]*)\[toc\]([ ]*(\n|$))/gim,"$1[]("+f+")$2")},tocRender:function(){var e=[],t=6;$("h1,h2,h3,h4,h5,h6",p.Document.body).each(function(e,n){var o=parseInt(n.tagName.charAt(1));o<t&&(t=o)}),$("h1,h2,h3,h4,h5,h6",p.Document.body).each(function(n,o){var r="wiz_toc_"+n,i=parseInt(o.tagName.charAt(1)),a=$(o);a.attr("id",r),e.push('<a class="wiz_toc h'+(i-t+1)+'" href="#'+r+'">'+a.text()+"</a>")}),e='<div class="wiz_toc_layer">'+e.join("<br/>")+"</div>",$("a",p.Document.body).each(function(t,n){n=$(n),n.attr("href")==f&&n.before(e)})},flowRender:function(){var e=$(".language-flow",p.Document.body).parents("pre");e.each(function(e,t){var n="wiz-flow-"+e,o=$("li",t),i="";if(o.each(function(e,t){var n=$(t).text();n.length>0&&(i+=n+"\n")}),i.length>0)try{t.style.display="none";var a=p.Win.flowchart.parse(i),l=p.Document.createElement("div");if(l.id=n,t.parentNode.insertBefore(l,t),a.drawSVG(n),r.client.isPhone){var s=$("svg",l);s.attr("width")&&s.css({"max-width":s.attr("width")}).attr({height:null,width:"95%"})}}catch(e){console.error(e)}})},sequenceRender:function(){var e=$(".language-sequence",p.Document.body).parents("pre");e.each(function(e,t){var n="wiz-sequence-"+e,o=$("li",t),i="";if(o.each(function(e,t){var n=$(t).text();n.length>0&&(i+=n+"\n")}),i.length>0)try{t.style.display="none";var a=p.Win.Diagram.parse(i),l=p.Document.createElement("div");if(l.id=n,t.parentNode.insertBefore(l,t),a.drawSVG(n,{theme:"simple"}),r.client.isPhone){var s=$("svg",l);s.attr("width")&&(s.get(0).setAttribute("viewBox","0 0 "+s.attr("width")+" "+s.attr("height")),s.css({"max-width":s.attr("width")}).attr({preserveAspectRatio:"xMidYMid meet",height:null,width:"95%"}))}}catch(e){console.error(e)}})},mathJaxRender:function(){function e(){p.Win._wizMathJaxCallback=function(){p.cb(p.callback.mathJax)};var e='MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.body, _wizMathJaxCallback]);';s.appendJsCode(p.Document,e,"text/javascript")}var t='MathJax.Hub.Config({                            skipStartupTypeset: true,                            "HTML-CSS": {                                preferredFont: "TeX",                                availableFonts: [                                    "STIX",                                    "TeX"                                ],                                linebreaks: {                                    automatic: true                                },                                EqnChunk: 10,                                imageFont: null                            },                            tex2jax: {                                inlineMath: [["$","$"],["\\\\\\\\(","\\\\\\\\)"]],                                displayMath: [["$$","$$"],["\\\\[","\\\\]"]],                                processEscapes: true },                            TeX: {                                equationNumbers: {                                    autoNumber: "AMS"                                },                                noUndefined: {                                    attributes: {                                        mathcolor: "red",                                        mathbackground: "#FFEEEE",                                        mathsize: "90%"                                    }                                },                                Safe: {                                    allow: {                                        URLs: "safe",                                        classes: "safe",                                        cssIDs: "safe",                                        styles: "safe",                                        fontsize: "all"                                    }                                }                            },                            messageStyle: "none"                        });';s.appendJsCode(p.Document,"MathJax = null","text/javascript"),s.appendJsCode(p.Document,t,"text/x-mathjax-config"),l.loadJs(p.Document,p.getDependencyFiles("js","mathJax"),e)},xssFilter:function(){if("undefined"==typeof a)return null;var e=decodeURIComponent(location.pathname),t=e.lastIndexOf("/")+1,n=e.lastIndexOf(".");e=n>0?"|"+e.substring(t,n)+"_files":"";var o="file://|data:image/",r=new RegExp("^("+o+e+")","i"),i=/^((file|wiz(note)?):)/,l="#",s=new RegExp("^("+l+e+")","i"),d=/^(id|class|style|data|width|height)/i,c=new a.FilterXSS({onIgnoreTag:function(e,t,n){if(/script/gi.test(e))return a.escapeAttrValue(t);if(n.isClosing)return"</"+e+">";var o=a.parseAttr(t,function(t,n){return n=a.safeAttrValue(e,t,n,c),/^on/i.test(t)?"":n?t+'="'+n+'"':t});return o=/^<!/i.test(t)?"<!"+o:"<"+o,"/"===t[t.length-2]&&(o+="/"),o+=">"},onIgnoreTagAttr:function(e,t,n,o){return n&&d.test(t)?t+'="'+n+'"':""},safeAttrValue:function(e,t,n){if("a"===e&&"href"===t){if(i.test(n)||s.test(n))return a.escapeAttrValue(n)}else if("src"===t&&r.test(n))return a.escapeAttrValue(n);return a.safeAttrValue(e,t,n)}});return function(e){return c.process(e)}}()};t.exports=m},{"./../common/dependLoader":16,"./../common/env":17,"./../common/scriptLoader":20,"./../common/utils":21,"./../common/xss":24,"./Markdown.Converter":36,"./Markdown.Extra":37}],39:[function(e,t,n){"use strict";function o(e,t,n){r(e,t,n);for(var i=t.children,a=0;a<i.length;a++){var l=i[a];o(t.id?t.id:e,l,n);
}}function r(e,t,n){if(t){var o=t.tagName;if(!/^(style|script|link|meta|img)$/gi.test(o)&&!d.hasClass(t,l.CLASS.TODO_CHECKBOX)&&!d.hasClass(t,l.CLASS.TODO_AVATAR)){var r=t.className;if(r&&r.length>0)for(var a=r.split(" "),s=0;s<a.length;s++){var c=a[s];0!=c.length&&i("."+c,n)}var u=t.id;u&&u.length>0&&i("#"+u,n),e?i("#"+e+" "+o,n):i(o,n)}}}function i(e,t){t[e]||/^(\.|#)?[\d]+/i.test(e)||!/^(\.|#)?[\. \w-]+$/i.test(e)||(t[e]="")}var a=e("../common/env"),l=e("../common/const"),s=e("../common/wizStyle"),d=e("../domUtils/domBase"),c="#7990b6",u="#1f2126",f="50%",g="wiz_night_mode_style",m={on:function(e,t,n){e&&(c=e),t&&(u=t),n&&(f=n),m.off();var r={},i=[];o("",a.doc.body,r);var d="{color:"+c+" !important; background-color:"+u+" !important; background-image: none !important; box-shadow: none !important; border-color:"+c+" !important; }";for(var p in r)r.hasOwnProperty(p)&&i.push(p);var h=i.join(", ");h+=d,h+="img{filter: brightness("+f+");-webkit-filter: brightness("+f+");}",h+=l.TAG.TMP_HIGHLIGHT_TAG+"{background-color: #50a9fb !important;  color: black !important;}",s.insertStyle({id:g,name:l.NAME.TMP_STYLE},h)},off:function(){var e=a.doc.getElementById(g);e&&e.remove()}};t.exports=m},{"../common/const":15,"../common/env":17,"../common/wizStyle":22,"../domUtils/domBase":25}],40:[function(e,t,n){"use strict";var o,r=e("./../common/env"),i=e("./../common/const"),a=e("./../common/base64"),l=e("./../domUtils/domBase"),s=-1,d={caretFocus:function(){var e=d.getRange(),t=e?e.getClientRects():null,n=t&&t.length>0?t[0]:null,o=r.doc.documentElement.clientHeight,i=r.doc.documentElement.clientWidth;n&&n.top<0?r.doc.body.scrollTop+=n.top:n&&n.top+n.height>o&&(r.doc.body.scrollTop+=n.top+n.height-o),n&&n.left<0?r.doc.body.scrollLeft+=n.left:n&&n.left+n.width>i&&(r.doc.body.scrollLeft+=n.left+n.width-i)},clearFillCharByCollapsed:function(){var e,t,n,o=d.getRange();o&&o.collapsed&&3===o.startContainer.nodeType&&(e=o.startContainer,t=e.nodeValue.substr(0,o.startOffset),n=e.nodeValue.substr(o.startOffset),t=t.replace(i.FILL_CHAR_REG,""),n=n.replace(i.FILL_CHAR_REG,""),e.nodeValue=t+n,d.setRange(e,t.length))},fixScroll:function(){function e(){var e,t,n,o,c=d.getRange();if(c&&(c.collapsed||!r.client.type.isPhone&&!r.client.type.isPad)){var u;if(r.client.type.isIOS&&(!r.options.ios.webViewHeight||s!=window.orientation))return u="_"+i.CLIENT_EVENT.WizGetWebViewSize+(new Date).valueOf(),r.win[u]=function(e){e=JSON.parse(a.decode(e)),r.options.ios.webViewHeight=e.height,r.options.ios.toolbarHeight=e.toolbarHeight,s=window.orientation,delete r.win[u],d.fixScroll()},void r.client.sendCmdToWiznote(i.CLIENT_EVENT.WizGetWebViewSize,{callback:u});var f=r.options.ios.webViewHeight,g=r.options.ios.toolbarHeight;e=d.getRangeClientRect(),e&&(t=l.getWindowSize(),r.client.type.isIOS&&(t.height=f-g),n=r.doc.body.scrollTop,o=r.doc.body.scrollLeft,r.client.type.isIOS&&e.top+g<0?r.doc.body.scrollTop=n+e.top+g:r.client.type.isIOS&&e.top+e.height>f-g?r.doc.body.scrollTop=n+e.top+e.height+g-f:!r.client.type.isIOS&&e.top<0?r.doc.body.scrollTop=n+e.top:!r.client.type.isIOS&&e.top+e.height>t.height&&(r.doc.body.scrollTop=n+e.top+e.height-t.height),e.left<o?r.doc.body.scrollLeft=o+e.left:e.left+e.width>t.width&&(r.doc.body.scrollLeft=o+e.left+e.width-t.width))}}o&&clearTimeout(o),o=setTimeout(e,30)},getRange:function(){var e=r.doc.getSelection();return e.rangeCount>0?e.getRangeAt(0):null},getRangeAnchor:function(e){var t=d.getRange();if(!t)return null;var n=e?t.startContainer:t.endContainer,o=e?t.startOffset:t.endOffset;return t.collapsed||e?3===n.nodeType&&o<n.nodeValue.length?n:3===n.nodeType?l.getNextNode(n,!1,null):0===n.childNodes.length?n:o==n.childNodes.length?l.getNextNode(n.childNodes[o-1],!1,null):l.getFirstDeepChild(n.childNodes[o]):3===n.nodeType&&o>0?n:3===n.nodeType?l.getPreviousNode(n,!1,null):o>0?l.getLastDeepChild(n.childNodes[o-1]):l.getPreviousNode(n,!1,null)},getRangeClientRect:function(){var e=d.getRange();if(!e)return null;var t,n,o=e.getBoundingClientRect();return 0===o.width&&0===o.height&&(t=d.getRange().getClientRects(),t.length>0&&(o=t[0])),0===o.width&&0===o.height&&(n=e.startContainer,1===n.nodeType&&(n=n.childNodes[e.startOffset===n.childNodes.length?e.startOffset-1:e.startOffset],n.getBoundingClientRect&&(o=n.getBoundingClientRect(),o={bottom:o.bottom,height:o.height,left:o.left+o.width,right:o.right,top:o.top,width:0}))),o},getRangeDomList:function(e){var t=d.getRange();if(!t)return null;var n=t.startContainer,o=t.startOffset,r=t.endContainer,i=t.endOffset,a=l.getDomListA2B({startDom:n,startOffset:o,endDom:r,endOffset:i,noSplit:!!e.noSplit});return a},getRangeParentRoot:function(){var e,t,n=d.getRange();return n?(e=n.startContainer,t=n.endContainer,l.getParentRoot([e,t])):null},isRangeEdge:function(e){var t={isStart:!1,isEnd:!1},n=d.getRange();if(n){t.isCollapsed=n.collapsed,t.startDom=n.startContainer,t.startOffset=n.startOffset,t.endDom=n.endContainer,t.endOffset=n.endOffset;var o,r;return 1==t.startDom.nodeType&&t.startOffset<t.startDom.childNodes.length?o=l.getFirstDeepChild(t.startDom.childNodes[t.startOffset]):1==t.startDom.nodeType&&(o=l.getNextNode(t.startDom.childNodes[t.startOffset-1],!1,null)),1==t.endDom.nodeType&&t.endOffset>0?r=l.getLastDeepChild(t.endDom.childNodes[t.endOffset-1]):1==t.endDom.nodeType&&(r=l.getPreviousNode(t.endDom,!1,null)),t.isStart=t.startDom==e||t.startDom==o,t.isEnd=t.endDom==e||t.endDom==r,t}},selectElementContents:function(e){var t=r.doc.createRange();t.selectNodeContents(e);var n=r.doc.getSelection();n.removeAllRanges(),n.addRange(t)},selectCharIncludeFillChar:function(e){var t,n,o,a,s=r.doc.getSelection(),c=s.getRangeAt(0),u=e?"backward":"forward";if(1===c.startContainer.nodeType){if(t=d.getRangeAnchor(!1),c.startContainer==t&&l.isTag(t,"br")&&l.isEmptyDom(t.parentNode))return void(t.parentNode.nextSibling?d.setRange(t.parentNode,0,t.parentNode.nextSibling,0):(s.modify("move","forward","character"),s.modify("extend","backward","character"),t.nextSibling&&s.modify("extend","backward","character")));l.isTag(t,"br")&&s.modify("extend",u,"character")}s.modify("extend",u,"character"),c=s.getRangeAt(0),a=c.toString(),t=d.getRangeAnchor(e),t&&(n=e&&t==c.startContainer?c.startOffset:e||t!=c.endContainer?-1:c.endOffset,o=3===t.nodeType&&n>0&&n<t.nodeValue.length?t:e?l.getPreviousNode(t,!1,null):l.getNextNode(t,!1,null),0===a.length?t&&!l.isSelfClosingTag(t)&&o&&(1!==o.nodeType||1===o.nodeType&&l.isSelfClosingTag(o))&&s.modify("extend",u,"character"):a.indexOf(i.FILL_CHAR)>-1&&""===a.replace(i.FILL_CHAR_REG,"")&&s.modify("extend",u,"character"))},setRange:function(e,t,n,o){if(e||n){var i=l.getEndOffset(e),a=l.getEndOffset(n);t<0?t=0:t>i&&(t=i),o<0?o=l.getEndOffset(n):o>a&&(o=a);var s=r.doc.getSelection();e||(e=r.doc.body,t=0);var d;0===s.rangeCount&&(d=r.doc.createRange(),d.selectNode(e),s.addRange(d)),s.collapse(e,t),n&&s.extend(n,o)}}};t.exports=d},{"./../common/base64":14,"./../common/const":15,"./../common/env":17,"./../domUtils/domBase":25}],41:[function(e,t,n){"use strict";var o,r=e("./../common/env"),i=e("./../common/const"),a=e("./../common/utils"),l=e("./../domUtils/domExtend"),s=e("./rangeBase");s.backupCaret=function(){var e=s.getRange();if(!e){if(o)return!0;if(l.focus(),e=s.getRange(),!e)return!1}return o=s.getRange(),!0},s.restoreCaret=function(){if(!o)return!1;var e=r.doc.getSelection();return 0==e.rangeCount&&l.focus(),e.removeAllRanges(),e.addRange(o),o=null,!0},s.modifyCaretStyle=function(e,t){var n,o,d,c,u=r.doc.getSelection(),f=u.focusNode,g=!0;3==f.nodeType&&(f=f.parentNode);for(o in e)e.hasOwnProperty(o)&&"string"==typeof o&&(d=e[o],f.style[o]!==d&&(g=!1));if(!g){l.isTag(f,"span")&&a.isEmpty(f.innerHTML)?(l.modifyStyle(f,e,t),c=f):(n=u.getRangeAt(0),n.deleteContents(),c=l.createSpan(),c.innerHTML=i.FILL_CHAR,n.insertNode(c),l.modifyStyle(c,e,t));var m=f.parentNode?f.parentNode:f;l.clearChild(m,[c]),s.setRange(c.childNodes[0],1,c.childNodes[0],1)}},s.modifyDomsStyle=function(e,t,n,o){l.modifyNodesStyle(e,t,n);var r,i,a,s,d=[];for(r=0,i=e.length;r<i;r++)a=e[r].parentNode,a&&d.indexOf(a)<0&&d.push(a);a=l.getParentRoot(d),s=l.getWizAmendParent(a),a=s?s.parentNode:a,l.clearChild(a,o)},s.modifyRangeStyle=function(e,t){var n,o,r;if(n=s.getRangeDomList({noSplit:!1}),n&&(o=n.list,r=o.length,0!==r)){s.modifyDomsStyle(o,e,t,[n.startDomBak,n.endDomBak]);var i=!n.startDom.parentNode,a=!n.endDom.parentNode,d=l.isSelfClosingTag(n.endDom);i&&l.isSelfClosingTag(n.startDomBak)&&(n.startDomBak=l.getNextNode(n.startDomBak,!1,n.endDomBak),n.startOffsetBak=0),s.setRange(i?n.startDomBak:n.startDom,i?n.startOffsetBak:n.startOffset,a||d?n.endDomBak:n.endDom,a||d?n.endOffsetBak:n.endOffset)}},s.modifySelectionDom=function(e,t){var n=s.getRange();n&&(n.collapsed?s.modifyCaretStyle(e,t):s.modifyRangeStyle(e,t))},t.exports=s},{"./../common/const":15,"./../common/env":17,"./../common/utils":21,"./../domUtils/domExtend":26,"./rangeBase":40}],42:[function(e,t,n){"use strict";function o(e,t){var n,o,i=r.doc.getElementsByTagName(e);for(n=0;n<i.length;n++)o=i[n],o.readOnly=t}var r=e("../common/env"),i=e("../common/const"),a=e("../domUtils/domExtend"),l=e("../todoUtils/todoCore"),s=e("../tableUtils/tableCore"),d=e("../imgUtils/imgCore"),c=e("../common/wizStyle"),u=e("./readerEvent"),f="",g={init:function(){},insertDefaultStyle:function(e,t){c.insertDefaultStyle(e,t)},on:function(){r.readonly=!0,f=a.getContentHtml({isSaveTemp:!0}),c.insertTmpReaderStyle(),u.on(),d.on(),s.on(),l.on(),o("input",!0),o("textarea",!0)},off:function(){u.off(),l.off(),s.off(),d.off(),f&&(r.options.noteType==i.NOTE_TYPE.COMMON?(a.removeDomByName(i.NAME.TMP_STYLE),a.removeDomByTag(i.TAG.TMP_TAG),o("input",!1),o("textarea",!1)):(r.doc.open("text/html","replace"),r.doc.write(f),r.doc.close()))}};t.exports=g},{"../common/const":15,"../common/env":17,"../common/wizStyle":22,"../domUtils/domExtend":26,"../imgUtils/imgCore":32,"../tableUtils/tableCore":44,"../todoUtils/todoCore":49,"./readerEvent":43}],43:[function(e,t,n){"use strict";var o=e("../common/env"),r=e("../common/const"),i=(e("../common/utils"),e("../domUtils/domExtend"),e("../imgUtils/imgUtils"),{on:function(){i.bind()},off:function(){i.unbind()},bind:function(){i.unbind(),o.doc.addEventListener("click",a.onClick),o.doc.addEventListener("scroll",a.onScroll),(o.client.type.isIOS||o.client.type.isAndroid)&&(o.doc.addEventListener("touchend",a.onTouchEnd),o.doc.addEventListener("touchstart",a.onTouchStart))},unbind:function(){o.doc.removeEventListener("click",a.onClick),o.doc.removeEventListener("scroll",a.onScroll),o.doc.removeEventListener("touchend",a.onTouchEnd),o.doc.removeEventListener("touchstart",a.onTouchStart)}}),a={onClick:function(e){o.event.call(r.EVENT.ON_CLICK,e)},onScroll:function(e){o.event.call(r.EVENT.ON_SCROLL,e)},onTouchEnd:function(e){o.event.call(r.EVENT.ON_TOUCH_END,e)},onTouchStart:function(e){o.event.call(r.EVENT.ON_TOUCH_START,e)}};t.exports=i},{"../common/const":15,"../common/env":17,"../common/utils":21,"../domUtils/domExtend":26,"../imgUtils/imgUtils":34}],44:[function(e,t,n){"use strict";var o=e("../common/env"),r=e("../common/const"),i=e("../common/utils"),a=e("../common/historyUtils"),l=e("./tableUtils"),s=e("./tableScroll"),d=e("./tableMenu"),c=e("./tableZone"),u=e("../domUtils/domExtend"),f=e("../rangeUtils/rangeExtend"),g={bind:function(){g.unbind(),o.event.add(r.EVENT.ON_DRAG_START,g.handler.onDragStart),o.event.add(r.EVENT.ON_KEY_UP,g.handler.onKeyUp),o.client.type.isPhone||o.client.type.isPad?(o.event.add(r.EVENT.ON_TOUCH_START,g.handler.onMouseDown),o.event.add(r.EVENT.ON_TOUCH_END,g.handler.onMouseUp)):(o.event.add(r.EVENT.ON_MOUSE_DOWN,g.handler.onMouseDown),o.event.add(r.EVENT.ON_MOUSE_OVER,g.handler.onMouseOver),o.event.add(r.EVENT.ON_MOUSE_UP,g.handler.onMouseUp)),o.event.add(r.EVENT.ON_SELECT_CHANGE,g.handler.onSelectionChange),o.event.add(r.EVENT.AFTER_RESTORE_HISTORY,g.handler.afterRestoreHistory)},unbind:function(){o.event.remove(r.EVENT.ON_DRAG_START,g.handler.onDragStart),o.event.remove(r.EVENT.ON_KEY_UP,g.handler.onKeyUp),o.event.remove(r.EVENT.ON_MOUSE_DOWN,g.handler.onMouseDown),o.event.remove(r.EVENT.ON_MOUSE_OVER,g.handler.onMouseOver),o.event.remove(r.EVENT.ON_MOUSE_UP,g.handler.onMouseUp),o.event.remove(r.EVENT.ON_TOUCH_START,g.handler.onMouseDown),o.event.remove(r.EVENT.ON_TOUCH_END,g.handler.onMouseUp),o.event.remove(r.EVENT.ON_SELECT_CHANGE,g.handler.onSelectionChange),o.event.remove(r.EVENT.AFTER_RESTORE_HISTORY,g.handler.afterRestoreHistory)},handler:{afterRestoreHistory:function(){var e,t,n,i,a=[];if(e=o.doc.getElementsByClassName(r.CLASS.SELECTED_CELL),0===e.length)return void c.clear();for(n=0,i=e.length;n<i;n++)a.push(e[n]);var s=u.getParentByTagName(a[0],"table",!0,null);if(!s)return void c.clear();c.setStart(a[0]);var f,g=c.getZone(),m=a[a.length-1],p=l.getRangeByCellData(l.getCellData(g.grid,m));for(n=1;n<a.length-1;n++)t=a[n],1!=t.rowSpan&&(f=l.getRangeByCellData(l.getCellData(g.grid,t)),(f.maxY>p.maxY||(f.maxY=p.maxY&&f.maxX>p.maxX))&&(m=t,p=f));c.setEnd(m),d.show()},onDragStart:function(e){var t=u.getParentByTagName(e.target,"table",!0,null);t&&i.stopEvent(e)},onKeyDown:function(e){var t=o.doc.getSelection(),n=c.getZone();if(!n.range)return!0;var r,a,s,g=e.shiftKey?"extend":"move",m=e.keyCode||e.which,p=!1,h=t.focusNode;switch(m){case 37:e.ctrlKey||e.metaKey||!h||(p=!0,t.modify(g,"backward","character")),r={x:-1,y:0};break;case 38:e.ctrlKey||e.metaKey||!h||(p=!0,t.modify("move","backward","line")),r={x:0,y:-1};break;case 9:e.shiftKey||(r={x:1,y:0,canChangeRow:!0});break;case 39:e.ctrlKey||e.metaKey||!h||(p=!0,t.modify(g,"forward","character")),r={x:1,y:0};break;case 13:if(!e.ctrlKey&&!e.metaKey)break;case 40:e.ctrlKey||e.metaKey||!h||(p=!0,t.modify("move","forward","line")),r={x:0,y:1}}var T,E,v;if(p){if(a=t.focusNode,h=u.getParentByTagName(h,["td","th"],!0,null),a=u.getParentByTagName(a,["td","th"],!0,null),a&&a!=h&&(38==m||40==m||13==m?p=!1:c.setStart(a).setEnd(a)),p)return v=l.checkCaretInTableContainer(e),a||v.tableContainer?v.before&&(f.setRange(n.start.cell,0),c.setStart(n.start.cell).setEnd(n.start.cell)):(c.clear(),d.show()),i.stopEvent(e),!1;if(38==m&&n.start.cell==n.end.cell&&0==n.start.y_src){for(s=n.start.x,a=u.getPreviousNode(l.getContainer(h));a&&!u.isTag(a,"br")&&u.isEmptyDom(a);)a=u.getPreviousNode(a);return a?(c.clear(),d.show(),f.setRange(a,u.getEndOffset(a)),0!==s||u.getParentByTagName(a,["table"],!0,null)||t.modify("move","backward","lineboundary"),f.fixScroll()):(f.setRange(n.start.cell,0),c.setStart(n.start.cell).setEnd(n.start.cell)),i.stopEvent(e),!1}if(40==m&&n.start.cell==n.end.cell&&n.start.y_src+n.start.cell.rowSpan>=n.grid.length){for(s=n.start.x,a=u.getNextNode(l.getContainer(h));a&&!u.isTag(a,"br")&&u.isEmptyDom(a);)a=u.getNextNode(a);return a?(c.clear(),d.show(),f.setRange(a,u.getEndOffset(a)),0!==s||u.getParentByTagName(a,["table"],!0,null)||t.modify("move","backward","lineboundary"),f.fixScroll()):c.setStart(n.start.cell).setEnd(n.start.cell),i.stopEvent(e),!1}}if(r){if(T=e.shiftKey?n.end||n.start:n.start,E=c.switchCell(T,r),E==T)return i.stopEvent(e),!1;if(E)return e.shiftKey?c.setEnd(E.cell,!0):c.setStart(E.cell,E.x,E.y).setEnd(E.cell),f.fixScroll(),i.stopEvent(e),!1}return!0},onKeyUp:function(e){var t,n=c.getZone(),o=f.getRange();!n.range&&o&&o.collapsed&&(t=u.getParentByTagName(o.startContainer,["td","th"],!0,null),t&&(c.setStart(t).setEnd(t),d.show())),l.fixSelection(e)},onMouseDown:function(e){var t="mousedown"!==e.type||0===e.button||1===e.button;if(!t)return void d.hide();var n=l.isMenu(e.target);if(!n){var r=u.getParentByTagName(e.target,["th","td"],!0,null),a=r?u.getParentByTagName(r,"table",!1,null):null,s=l.getMousePosition(e,a),f=c.isZoneBorder(e);if(f.isBodyBorder||f.isContainer)return void(o.client.type.isPhone||o.client.type.isPad||i.stopEvent(e));if(!o.client.type.isPhone&&!o.client.type.isPad){if(f.isRight)return void c.startDragColLine(e.target,s.x);if(f.isBottom)return void c.startDragRowLine(e.target,s.y);if(f.isDot)return}f.isBorder||f.isScroll||(c.setStart(r),d.show())}},onMouseOver:function(e){var t=u.getParentByTagName(e.target,["td","th"],!0,null);c.modify(t)},onMouseUp:function(e){l.fixSelection(e);var t="mouseup"!==e.type||0===e.button||1===e.button;if(t){var n,o,r=c.getZone();if(!r.active){if(n=l.isMenu(e.target))return;if(o=c.isZoneBorder(e),o.isRight&&!c.isRangeActiving())return;if(o.isBottom&&!c.isRangeActiving())return;if(o.isDot)return;if(o.isBorder||o.isScroll)return}var i=u.getParentByTagName(e.target,["td","th"],!0,null);c.setEnd(i),d.show()}},onSelectionChange:function(e){var t,n=l.checkCaretInTableContainer(e);n.tableContainer&&(t=n.tableContainer.querySelectorAll("td"),t=n.after?t[t.length-1]:n.before?t[0]:null,t&&(c.setStart(t).setEnd(t),d.show()))}}},m={on:function(){o.readonly||(g.bind(),d.init(m)),s.init(),l.initTableContainer(null),c.clear()},off:function(){c.clear()},canCreateTable:function(){return l.canCreateTable(c.getZone())},clearCellValue:function(){var e=c.getZone();e.range&&(a.saveSnap(!1),l.clearCellValue(e.grid,e.range))},deleteCols:function(){var e=c.getZone();if(e.range){if(0===e.range.minX&&e.range.maxX===e.grid[0].length-1)return void m.deleteTable();a.saveSnap(!1);var t;for(t=e.range.maxX;t>=e.range.minX;t--)l.deleteCols(e.grid,t);c.clear()}},deleteRows:function(){var e=c.getZone();if(e.range){if(0===e.range.minY&&e.range.maxY===e.grid.length-1)return void m.deleteTable();a.saveSnap(!1);var t;for(t=e.range.maxY;t>=e.range.minY;t--)l.deleteRows(e.grid,t);c.clear()}},deleteTable:function(){var e=c.getZone();if(e.table){a.saveSnap(!1);var t=e.table.parentNode;t&&t.removeChild(e.table),d.remove(),c.remove(),t=u.getParentByFilter(t,function(e){return u.hasClass(e,r.CLASS.TABLE_CONTAINER)},!0);var n;t&&(n=o.doc.createElement("br"),t.parentNode.insertBefore(n,t),t.parentNode.removeChild(t),f.setRange(n,0))}},distributeCols:function(){var e=c.getZone();e.range&&(a.saveSnap(!1),l.distributeCols(e.table,e.grid),c.updateGrid())},insertCol:function(e){var t=c.getZone();t.range&&(a.saveSnap(!1),l.insertCol(t.grid,e?t.range.minX:t.range.maxX+1),c.updateGrid())},insertRow:function(e){var t=c.getZone();t.range&&(a.saveSnap(!1),l.insertRow(t.grid,e?t.range.minY:t.range.maxY+1),c.updateGrid())},insertTable:function(e,t){a.saveSnap(!1);var n,i=f.getRange();if(m.canCreateTable()){i&&(i.deleteContents(),i=f.getRange());var s=l.createTable(e,t),d=o.doc.createElement("div");d.appendChild(o.doc.createElement("br")),i?(u.execCommand("insertparagraph"),i=f.getRange(),i.insertNode(s),i.insertNode(d)):(o.doc.body.appendChild(s),o.doc.body.appendChild(d)),l.initTableContainer(null),i=f.getRange(),i&&(n=u.getParentByTagName(i.startContainer,["tbody"],!0,null),n&&f.setRange(u.getFirstDeepChild(n),0),o.event.call(r.EVENT.UPDATE_RENDER))}},merge:function(){var e=c.getZone();if(e.range){a.saveSnap(!1);var t=l.mergeCell(e.grid,e.range);t&&(c.updateGrid(),c.setStart(t).setEnd(t))}},onKeyDown:g.handler.onKeyDown,setCellAlign:function(e,t){var n=c.getZone();n.range&&(a.saveSnap(!1),l.setCellAlign(n.grid,n.range,{align:e,valign:t}),c.setStartRange())},setCellBg:function(e){var t=c.getZone();t.range&&(a.saveSnap(!1),l.setCellBg(t.grid,t.range,e),c.setStartRange())},split:function(){var e=c.getZone(),t=l.splitCell(e.table,e.grid,e.range);t&&(a.saveSnap(!1),c.updateGrid(),e=c.getZone(),c.setStart(e.grid[t.minY][t.minX].cell).setEnd(e.grid[t.maxY][t.maxX].cell))}};t.exports=m},{"../common/const":15,"../common/env":17,"../common/historyUtils":18,"../common/utils":21,"../domUtils/domExtend":26,"../rangeUtils/rangeExtend":41,"./tableMenu":45,"./tableScroll":46,"./tableUtils":47,"./tableZone":48}],45:[function(e,t,n){"use strict";function o(){var e=c.doc.querySelector("."+u.CLASS.TABLE_TOOLS);if(e)return e;var t,n,o=[{id:T.col,exClass:"icon-insert editor-icon",subMenu:{type:v.list,data:[{type:u.TYPE.TABLE.INSERT_ROW_UP,name:g.Table.InsertRowUp,isSplit:!1},{type:u.TYPE.TABLE.INSERT_ROW_DOWN,name:g.Table.InsertRowDown,isSplit:!1},{type:u.TYPE.TABLE.INSERT_COL_LEFT,name:g.Table.InsertColLeft,isSplit:!1},{type:u.TYPE.TABLE.INSERT_COL_RIGHT,name:g.Table.InsertColRight,isSplit:!1},{type:u.TYPE.TABLE.DELETE_ROW,name:g.Table.DeleteRow,isSplit:!0},{type:u.TYPE.TABLE.DELETE_COL,name:g.Table.DeleteCol,isSplit:!1}]}},{id:T.align,exClass:"icon-align editor-icon",subMenu:{type:v.custom,make:function(){var e,t,n,o=[["top","middle","bottom"],["left","center","right"]],r='<div class="wiz-table-menu-sub wiz-table-cell-align">';for(e=0;e<o.length;e++){for(r+="<div>",t=0;t<o[e].length;t++)n=0===e?"valign":"align",r+='<div class="'+E.alignItem+" "+E.clickItem+'" data-type="'+u.TYPE.TABLE.SET_CELL_ALIGN+'" data-align-type="'+n+'" data-align-value="'+o[e][t]+'">',0===e?(r+='<i class="editor-icon icon-box"></i>',r+='<i class="editor-icon valign icon-valign_'+o[e][t]+'"></i>'):r+='<i class="editor-icon align icon-align_'+o[e][t]+'"></i>',r+="</div>";r+="</div>"}return r+="</div>"}}},{id:T.bg,exClass:"icon-box editor-icon",subMenu:{type:v.custom,make:function(){var e,t,n=[["","#f7b6ff","#fecf9c"],["#acf3fe","#b2ffa1","#b6caff"],["#ffc7c8","#eeeeee","#fef49c"]],o='<div class="wiz-table-menu-sub wiz-table-color-pad">';for(e=0;e<n.length;e++){for(o+="<div>",t=0;t<n[e].length;t++)o+='<div class="'+E.colorPadItem+" "+E.clickItem+'" data-color="'+n[e][t]+'" data-type="'+u.TYPE.TABLE.SET_CELL_BG+'">',o+='<i class="editor-icon icon-box"></i>',o+=0===e&&0===t?'<i class="pad-demo editor-icon icon-oblique_line"></i>':'<i class="pad-demo editor-icon icon-inner_box" style="color:'+n[e][t]+';"></i>',o+="</div>";o+="</div>"}return o+="</div>"}}},{id:T.cells,exClass:"icon-merge editor-icon",subMenu:{type:v.list,data:[{type:u.TYPE.TABLE.MERGE_CELL,name:g.Table.MergeCell,isSplit:!1},{type:u.TYPE.TABLE.SPLIT_CELL,name:g.Table.SplitCell,isSplit:!1},{type:u.TYPE.TABLE.CLEAR_CELL,name:g.Table.ClearCell,isSplit:!1}]}},{id:T.more,exClass:"icon-more editor-icon",subMenu:{type:v.list,data:[{type:u.TYPE.TABLE.DISTRIBUTE_COLS,name:g.Table.DistributeCols,exClass:"",isSplit:!1},{type:u.TYPE.TABLE.DELETE_TABLE,name:g.Table.DeleteTable,exClass:"",isSplit:!0}]}}];e=c.doc.createElement(u.TAG.TMP_TAG),h.addClass(e,u.CLASS.TABLE_TOOLS);var i="<ul>";for(t=0;t<o.length;t++)n=o[t],i+='<li id="'+n.id+'" class="'+u.CLASS.TABLE_MENU_ITEM+'"><div class="'+u.CLASS.TABLE_MENU_BUTTON+'"><i class="'+n.exClass+'"></i>',n.id===T.bg&&(i+='<i id="'+T.bgDemo+'" class="editor-icon icon-inner_box"></i>'),i+="</div>",i+=n.subMenu.type===v.list?r(n.subMenu.data):n.subMenu.make(),i+="</li>";return i+="</ul>",e.innerHTML=i,l=e.querySelector("#"+T.bgDemo),l&&(l.style.color="#fff"),e}function r(e){var t,n,o='<ul class="wiz-table-menu-sub">';for(t=0;t<e.length;t++)n=e[t],o+='<li class="wiz-table-menu-sub-item '+E.clickItem,n.isSplit&&(o+=" split"),o+='" data-type="'+n.type+'">'+n.name,o+="</li>";return o+="</ul>"}function i(){var e,t=d.parentNode.querySelector("."+u.CLASS.TABLE_BODY),n=t?t.offsetTop:0;return e=n-d.offsetHeight-5,e+"px"}function a(){var e=d.parentNode,t=h.getOffset(e),n=c.doc.body.scrollTop;n>t.top-30&&n<e.offsetHeight+t.top-2.5*d.offsetHeight?h.css(d,{position:"fixed",top:"0",left:t.left+"px"}):h.css(d,{position:"",top:i(),left:""})}var l,s,d,c=e("../common/env"),u=e("../common/const"),f=e("../common/lang"),g=f.getLang(),m=e("./tableUtils"),p=e("./tableZone"),h=e("../domUtils/domExtend"),T={col:"wiz-menu-col",align:"wiz-menu-align",bg:"wiz-menu-bg",bgDemo:"wiz-menu-bg-demo",cells:"wiz-menu-cells",more:"wiz-menu-more"},E={active:"active",disabled:"disabled",clickItem:"click-item",colorPadItem:"wiz-table-color-pad-item",alignItem:"wiz-table-cell-align-item"},v={list:1,custom:2},b={bind:function(){b.unbind(),d&&(d.addEventListener("click",b.handler.onClick),d.addEventListener("mouseover",b.handler.onMouseOver)),c.event.add(u.EVENT.BEFORE_SAVESNAP,b.handler.onBeforeSaveSnap),c.event.add(u.EVENT.ON_SCROLL,b.handler.onScroll)},unbind:function(){d&&(d.removeEventListener("click",b.handler.onClick),d.removeEventListener("mouseover",b.handler.onMouseOver)),c.event.remove(u.EVENT.BEFORE_SAVESNAP,b.handler.onBeforeSaveSnap),c.event.remove(u.EVENT.ON_SCROLL,b.handler.onScroll)},handler:{onBeforeSaveSnap:function(){},onClick:function(e){var t=h.getParentByFilter(e.target,function(e){return h.hasClass(e,u.CLASS.TABLE_MENU_BUTTON)},!0);if(t)return void y.showSub(t.parentNode);var n;if(t=h.getParentByFilter(e.target,function(e){return h.hasClass(e,E.clickItem)},!0),t&&!h.hasClass(t,E.disabled)){var o=t.getAttribute("data-type"),r=!0;switch(o){case u.TYPE.TABLE.CLEAR_CELL:s.clearCellValue();break;case u.TYPE.TABLE.MERGE_CELL:s.merge();break;case u.TYPE.TABLE.SPLIT_CELL:s.split();break;case u.TYPE.TABLE.INSERT_ROW_UP:s.insertRow(!0);break;case u.TYPE.TABLE.INSERT_ROW_DOWN:s.insertRow();break;case u.TYPE.TABLE.INSERT_COL_LEFT:s.insertCol(!0);break;case u.TYPE.TABLE.INSERT_COL_RIGHT:s.insertCol();break;case u.TYPE.TABLE.DELETE_ROW:s.deleteRows();break;case u.TYPE.TABLE.DELETE_COL:s.deleteCols();break;case u.TYPE.TABLE.SET_CELL_BG:var i=t.getAttribute("data-color");s.setCellBg(i),n=h.getParentByFilter(t,function(e){return h.hasClass(e,"wiz-table-color-pad")},!1),h.removeClass(n.querySelectorAll(".wiz-table-color-pad ."+E.colorPadItem+"."+E.active),E.active),h.addClass(t,E.active),l.setAttribute("data-last-color",i);break;case u.TYPE.TABLE.SET_CELL_ALIGN:var a=null,d=null;"align"==t.getAttribute("data-align-type")?a=t.getAttribute("data-align-value"):d=t.getAttribute("data-align-value"),s.setCellAlign(a,d),n=t.parentNode,h.removeClass(n.querySelectorAll("."+E.active),E.active),h.addClass(t,E.active),r=!1;break;case u.TYPE.TABLE.DELETE_TABLE:s.deleteTable();break;case u.TYPE.TABLE.DISTRIBUTE_COLS:s.distributeCols();break;default:r=!1}r&&y.hideSub()}},onMouseOver:function(e){var t=h.getParentByFilter(e.target,function(e){return h.hasClass(e,E.colorPadItem)},!0);t&&l&&(l.style.color=t.getAttribute("data-color")||"#fff")},onScroll:function(e){d&&"none"!=d.style.display&&a()}}},y={init:function(e){s=e},hide:function(){d&&(d.style.display="none"),b.unbind()},hideSub:function(){if(d){var e=d.querySelectorAll("."+u.CLASS.TABLE_MENU_ITEM+"."+E.active);h.removeClass(e,E.active),l&&(l.style.color=l.getAttribute("data-last-color")||"#fff")}},remove:function(){d&&(d.parentNode.removeChild(d),d=null)},show:function(){if(!c.client.type.isPhone&&!c.client.type.isPad){var e=p.getZone();if(!e.grid||!e.range)return void y.hide();var t=h.getParentByFilter(e.table,function(e){return h.hasClass(e,u.CLASS.TABLE_CONTAINER)},!1);d=o(),h.attr(d,{contenteditable:"false"}),y.hideSub(),t.appendChild(d),h.css(d,{top:i()}),d.style.display="block",a(),b.bind()}},showSub:function(e){if(h.hasClass(e,E.active))return void h.removeClass(e,E.active);var t,n,o,r,i=p.getZone();e.id===T.cells?(t=m.canMerge(i.grid,i.range),n=m.canSplit(i.grid,i.range),r=e.querySelector("[data-type="+u.TYPE.TABLE.MERGE_CELL+"]"),r&&t?h.removeClass(r,E.disabled):r&&h.addClass(r,E.disabled),r=e.querySelector("[data-type="+u.TYPE.TABLE.SPLIT_CELL+"]"),r&&n?h.removeClass(r,E.disabled):r&&h.addClass(r,E.disabled)):e.id===T.align&&(o=m.getAlign(i.grid,i.range),r=e.querySelector("."+E.alignItem+"."+E.active+"[data-align-type=align]"),!r||o.align&&r.getAttribute("data-align-value").toLowerCase()===o.align||(h.removeClass(r,E.active),r=null),!r&&o.align&&(r=e.querySelector("[data-align-value="+o.align+"]"),h.addClass(r,E.active)),r=e.querySelector("."+E.alignItem+"."+E.active+"[data-align-type=valign]"),!r||o.valign&&r.getAttribute("data-align-value").toLowerCase()===o.valign||(h.removeClass(r,E.active),r=null),!r&&o.valign&&(r=e.querySelector("[data-align-value="+o.valign+"]"),h.addClass(r,E.active))),y.hideSub(),h.addClass(e,E.active)}};t.exports=y},{"../common/const":15,"../common/env":17,"../common/lang":19,"../domUtils/domExtend":26,"./tableUtils":47,"./tableZone":48}],46:[function(e,t,n){"use strict";function o(){d&&clearTimeout(d),d=setTimeout(i,100)}function r(){a()}function i(){var e=c.doc.querySelectorAll("table");if(0!==e.length){var t,n,o;for(p=[],o=e.length-1;o>=0;o--)t=e[o],n=g.getContainer(t),n||(g.initTableContainer(t),n=g.getContainer(t)),p.push({table:t,tableBody:n.querySelector("."+u.CLASS.TABLE_BODY),top:n.offsetTop,height:n.offsetHeight});a()}}function a(){if(0!==p.length){var e,t,n=document.documentElement.clientHeight,o=c.doc.body.scrollTop,r=o+n;for(e=p.length-1;e>=0;e--)t=p[e],t.top<r&&t.top+t.height>r&&t.tableBody.offsetWidth<t.tableBody.scrollWidth?s(t):l(t)}}function l(e){var t=e.tableBody.parentNode.querySelector("."+u.CLASS.TABLE_SCROLL);t&&(t.style.display="none",h.unbindScroll(e.tableBody,t))}function s(e){var t,n;t=e.tableBody.parentNode.querySelector("."+u.CLASS.TABLE_SCROLL),t?n=t.children[0]:(t=c.doc.createElement(u.TAG.TMP_TAG),n=c.doc.createElement("div"),t.appendChild(n),m.addClass(t,u.CLASS.TABLE_SCROLL)),m.css(n,{width:e.tableBody.scrollWidth+"px",height:"1px","background-color":"rgba(255, 255, 255, 0.2)"}),m.css(t,{"background-color":"rgba(255, 255, 255, 0.2)",height:"17px",width:e.tableBody.offsetWidth+"px","overflow-x":"scroll","overflow-y":"hidden",position:"fixed",bottom:"0px","z-index":999,display:"block"}),t.scrollLeft=e.tableBody.scrollLeft,m.after(t,e.tableBody),h.bindScroll(e.tableBody,t)}var d,c=e("../common/env"),u=e("../common/const"),f=e("../common/lang"),g=(f.getLang(),e("./tableUtils")),m=(e("./tableZone"),e("../domUtils/domExtend")),p=[],h={bind:function(){h.unbind(),c.event.add(u.EVENT.ON_SCROLL,h.handler.onScroll),c.event.add(u.EVENT.UPDATE_RENDER,h.handler.updateRender),c.win.addEventListener("resize",h.handler.updateRender)},bindScroll:function(e,t){h.unbindScroll(e,t),t.addEventListener("scroll",h.handler.onSxScroll),e.addEventListener("scroll",h.handler.onTxScroll)},unbind:function(){c.event.remove(u.EVENT.ON_SCROLL,h.handler.onScroll),c.event.remove(u.EVENT.UPDATE_RENDER,h.handler.updateRender),c.win.removeEventListener("resize",h.handler.updateRender)},unbindScroll:function(e,t){t.removeEventListener("scroll",h.handler.onSxScroll),e.removeEventListener("scroll",h.handler.onTxScroll)},handler:{onScroll:function(){r()},onSxScroll:function(e){var t=e.target,n=e.target.parentNode.querySelector("."+u.CLASS.TABLE_BODY);n.scrollLeft=t.scrollLeft},onTxScroll:function(e){var t=e.target,n=e.target.parentNode.querySelector("."+u.CLASS.TABLE_SCROLL);n.scrollLeft=t.scrollLeft},updateRender:function(){o()}}},T={init:function(){c.client.type.isIOS||c.client.type.isAndroid||(h.bind(),o())}};t.exports=T},{"../common/const":15,"../common/env":17,"../common/lang":19,"../domUtils/domExtend":26,"./tableUtils":47,"./tableZone":48}],47:[function(e,t,n){"use strict";var o=e("./../common/env"),r=e("./../common/const"),i=e("./../common/utils"),a=e("./../domUtils/domExtend"),l=e("../rangeUtils/rangeExtend"),s={init:function(){},canCreateTable:function(e){var t,n=l.getRange();return(!n||!(t=a.getParentByTagName(n.startContainer,["table"],!0,null)||a.getParentByTagName(n.endContainer,["table"],!0,null)))&&!e.range},canMerge:function(e,t){return e&&t&&e[t.minY][t.minX].cell!==e[t.maxY][t.maxX].cell},canSplit:function e(t,n){if(!t||!n)return!1;var o,r={},e=!1;return s.eachRange(t,n,function(n){o=n.x_src+"_"+n.y_src,n.fake&&!r[o]&&(r[o]=t[n.y_src][n.x_src],e=!0)}),!!e&&r},checkCaretInTableContainer:function(e){var t,n,o,r,i,d={tableContainer:null,before:!1,after:!1},c=/^(mouse|touch)/i;if(e&&c.test(e.type))r=e.target;else{if(t=l.getRange(),!t||!t.collapsed)return d;r=t.startContainer,i=t.startOffset,1===r.nodeType?r=r.childNodes[i]:3===r.nodeType&&i==a.getEndOffset(r)&&(r=r.nextSibling)}return a.isTag(r,"table")&&s.initTableContainer(r),s.isMenu(r)?d:(n=s.getContainerExcludeTable(r),n&&(d.tableContainer=n,e&&c.test(e.type)?o=n.querySelector("table"):i>0?d.after=!0:d.before=!0),d)},clearCellValue:function(e,t){e&&t&&s.eachRange(e,t,function(e){e.fake||(e.cell.innerHTML="<br/>")})},cloneCell:function(e,t){var n=o.doc.createElement(e.tagName);return n.style.cssText=e.style.cssText,t?n.innerHTML="<br/>":(n.colSpan=e.colSpan,n.rowSpan=e.rowSpan,n.innerHTML=e.innerHTML),
n},createCell:function(e){var t=o.doc.createElement("td");return t.setAttribute("align","left"),t.setAttribute("valign","middle"),e&&t.setAttribute("style","width:"+e+"px"),t.appendChild(o.doc.createElement("br")),t},createTable:function(e,t){if(e&&t){var n,r,i,a=o.doc.createElement("table"),l=o.doc.createElement("tbody");for(i=0;i<t;i++){for(n=o.doc.createElement("tr"),r=0;r<e;r++)n.appendChild(s.createCell(o.options.table.colWidth));l.appendChild(n)}return a.appendChild(l),a.style.width=o.options.table.colWidth*e+"px",a}},deleteCols:function(e,t){if(e&&0!==e.length&&!(t>e[0].length)){var n,r,i,l=a.getParentByTagName(e[0][0].cell,"table",!1,null),d=[],c=o.options.table.colWidth;for(n=0;n<e.length;n++)r=e[n][t],r.y_src==n&&r.cell.colSpan>1?(r.cell.colSpan--,d.push(r.cell)):r.y_src==n&&(c=s.getCellWidth(r.cell),r.cell.parentElement.removeChild(r.cell)),e[n].splice(t,1);for(n=0;n<d.length;n++)i=d[n],i.style.width=s.getCellWidth(i)-c+"px";l.getElementsByTagName("td").length||l.getElementsByTagName("th").length?s.fixTableWidth(l):l.parentElement.removeChild(l)}},deleteRows:function(e,t){if(e&&0!==e.length&&!(t>e.length)){var n,o,r,i=a.getParentByTagName(e[0][0].cell,"table",!1,null),l=i.rows;for(n=e[t].length-1;n>=0;n--)o=e[t][n],o.x_src==n&&o.y_src<o.y?o.cell.rowSpan--:o.x_src==n&&o.y_src==o.y&&o.cell.rowSpan>1&&t+1<e.length&&(o.cell.rowSpan--,r=s.getNextCellDataInRow(e[t+1],n),r=r?r.cell:null,l[t+1].insertBefore(o.cell,r));e.splice(t,1),l[t].parentElement.removeChild(l[t]),i.getElementsByTagName("tr").length?s.fixTableWidth(i):i.parentElement.removeChild(i)}},distributeCols:function(e,t){if(e&&t){var n=t[0].length;if(0!==n){var o,r,i,a=e.rows,l=e.offsetWidth/n;for(o=a.length-1;o>=0;o--)for(r=a[o].cells.length-1;r>=0;r--)i=a[o].cells[r],i.style.width=l*i.colSpan+"px";e.style.width=e.offsetWidth+"px"}}},eachRange:function(e,t,n){if(e&&t&&n&&"function"==typeof n){var o,r,i=!0;for(r=t.minY;i!==!1&&r<e.length&&r<=t.maxY;r++)for(o=t.minX;i!==!1&&o<e[r].length&&o<=t.maxX;o++)i=n(e[r][o])}},fixSelection:function(){var e=l.getRange();if(e&&!e.collapsed){var t=e.startContainer,n=e.startOffset,o=e.endContainer,r=e.endOffset,i=s.getContainer(t),d=s.getContainer(o);if(!(!i&&!d||i&&d)){for(var c,u=i?i:d;c=s.getContainer(u);)u=i?a.getNextNode(c,!1,o):a.getPreviousNode(c,!1,t);i?(t=u?u:o,n=0):(o=u?u:t,r=a.getEndOffset(o)),i?l.setRange(o,r,t,n):l.setRange(t,n,o,r)}}},fixTableWidth:function(e){if(e){var t,n,o,r=e.rows,i=0;for(t=0;t<r[0].cells.length;t++)n=r[0].cells[t],o=s.getCellWidth(n),i+=o;e.style.width=i+"px"}},getAlign:function(e,t){if(!e||!t)return!1;var n,o,r,i={align:"",valign:""};return s.eachRange(e,t,function(e){return r=e.cell,e.fake||(n=r.align.toLowerCase(),o=r.vAlign.toLowerCase()),""===i.align&&(i.align=n,i.valign=o),null!==i.align&&(i.align=i.align===n?n:null),null!==i.valign&&(i.valign=i.valign===o?o:null),null!==i.align||null!==i.valign}),i},getCellWidth:function(e){return parseInt(e.style.width||e.offsetWidth,10)},getCellData:function(e,t){if(!e||!t)return null;var n,o,r;for(n=0;n<e.length;n++)for(o=0;o<e[n].length;o++)if(r=e[n][o],r.cell===t)return r;return null},getCellsByRange:function(e,t){var n=[];return e&&t?(s.eachRange(e,t,function(e){e.fake||n.push(e.cell)}),n):n},getContainer:function(e){return a.getParentByFilter(e,function(e){return a.hasClass(e,r.CLASS.TABLE_CONTAINER)},!0)},getTableBody:function(e){return a.getParentByFilter(e,function(e){return a.hasClass(e,r.CLASS.TABLE_BODY)},!0)},getContainerExcludeTable:function(e){var t=a.getParentByTagName(e,["th","td"],!0,null),n=t?null:s.getContainer(e);return n},getDomsByCellList:function(e){var t,n,o,r,i=[];if(!e)return i;for(t=0,n=e.length;t<n;t++)o=e[t],r=a.getDomListA2B({startDom:o.firstChild,startOffset:0,endDom:o.lastChild,endOffset:1,noSplit:!0}),i=i.concat(r.list);return i},getNextCellInTable:function(e){var t=e.nextElementSibling;if(t)return t;for(var n=e.parentNode.nextElementSibling;n;){if(n.cells.length>0)return n.cells[0];n=n.nextElementSibling}return null},getNextCellDataInRow:function(e,t){if(!e)return null;var n;for(n=t;n<e.length;n++)if(!e[n].fake)return e[n];return null},getMousePosition:function(e,t){var n=i.getEventClientPos(e),r=s.getTableBody(t||e.target),a=n.x+o.doc.body.scrollLeft+(r?r.scrollLeft:0),l=n.y+o.doc.body.scrollTop+(r?r.scrollTop:0);return{x:a,y:l}},getPreviousCellDataInRow:function(e,t){if(!e)return null;var n;for(n=t;n>=0;n--)if(!e[n].fake)return e[n];return null},getRangeByCellData:function(e){return e?{minX:e.x_src,minY:e.y_src,maxX:e.x_src+e.cell.colSpan-1,maxY:e.y_src+e.cell.rowSpan-1}:{minX:0,minY:0,maxX:0,maxY:0}},getRangeByCellsData:function(e,t,n){if(!e||!t||!n)return null;var o=s.getRangeByCellData(t);if(t.cell===n.cell)return o;for(var r,i,a,l,d,c,u,f,g,m=s.getRangeByCellData(n),p=Math.min(o.minX,m.minX),h=Math.min(o.minY,m.minY),T=Math.max(o.maxX,m.maxX),E=Math.max(o.maxY,m.maxY),v={},b=!0;b;)for(b=!1,r=p,i=h,a=T,l=E,c=h;c<=E;c++){for(d=p;d<=T;d++)if(c>h&&c<E&&d<T-1)d=T-1;else if(u=e[c][d],g=u.x_src+"_"+u.y_src,!v[g]&&(f=s.getRangeByCellData(u),p=Math.min(p,f.minX),h=Math.min(h,f.minY),T=Math.max(T,f.maxX),E=Math.max(E,f.maxY),p!==r||h!==i||T!==a||E!==l)){b=!0;break}if(b)break}return{minX:p,minY:h,maxX:T,maxY:E}},getTableGrid:function(e){function t(e,t){for(;E[t][e];)e++;return e}if(!e||!a.isTag(e,"table"))return null;var n,o,r,i,l,s,d,c,u,f,g,m,p,h,T,E=[];for(r=e.rows,o=0;o<r.length;o++)for(i=r[o],l=i.cells,E[o]||(E[o]=[]),n=0;n<l.length;n++)for(s=l[n],d=s.colSpan,c=s.rowSpan,T=t(n,o),u=0;u<c;u++)for(E[o+u]||(E[o+u]=[]),f=0;f<d;f++)m=o+u,g=t(T+f,m),0==u&&0==f&&(p=g,h=m),E[m][g]={cell:s,x:g,y:m,x_src:p,y_src:h,fake:u>0||f>0};return E},getTemplateByHtmlForPaste:function(e){var t,n,r,i,l,s=!1,d=o.doc.createElement("div");if(d.innerHTML=e,a.childNodesFilter(d),t=d.querySelectorAll("table"),1==t.length&&(n=t[0],n.parentNode.removeChild(n),a.isEmptyDom(d)?(s=!0,r=n):d.innerHTML=e),!s){for(t=d.querySelectorAll("table"),i=t.length-1;i>=0;i--)n=t[i],a.before(o.doc.createTextNode(n.innerText),n),n.parentNode.removeChild(n);for(i=d.childNodes.length-1;i>=0;i--)l=d.childNodes[i],1!==l.nodeType&&3!==l.nodeType&&a.isEmptyDom(l)&&d.removeChild(l);r=d}return{isTable:s,pasteDom:r}},getTemplateByTxtForPaste:function(e){e=(e||"").trim();var t,n,r,i,a,l=e.split("\n"),d=o.doc.createElement("table"),c=o.doc.createElement("tbody"),u=0;for(d.appendChild(c),n=0;n<l.length;n++){for(r=l[n].split("\t"),i=o.doc.createElement("tr"),t=0;t<r.length;t++)a=s.createCell(),r[t]&&(a.innerHTML="",a.appendChild(o.doc.createTextNode(r[t]))),i.appendChild(a);u=Math.max(u,i.cells.length),c.appendChild(i)}for(l=d.rows,n=0;n<l.length;n++)for(i=l[n],r=i.cells,t=r.length;t<u;t++)i.appendChild(s.createCell());return{isTable:!0,pasteDom:d}},initTable:function(e){var t,n,o;for(t=e.rows.length-1;t>=0;t--)for(n=e.rows[t].cells.length-1;n>=0;n--)o=e.rows[t].cells[n],o.style.width=o.offsetWidth+"px";e.style.width=e.offsetWidth+"px"},initTableContainer:function(e){function t(e,t){var n=e.parentNode;return t(n)||(n=o.doc.createElement("div"),a.before(n,e),n.appendChild(e)),n}var n,i,l,s,d,c=e?[e]:o.doc.querySelectorAll("table");for(s=0,d=c.length;s<d;s++)n=c[s],l=t(n,function(e){return a.hasClass(e,r.CLASS.TABLE_BODY)}),i=t(l,function(e){return a.hasClass(e,r.CLASS.TABLE_CONTAINER)}),a.addClass(i,r.CLASS.TABLE_CONTAINER),a.css(i,{position:"relative",padding:"15px 0 5px"}),a.addClass(l,r.CLASS.TABLE_BODY),a.removeClass(l,r.CLASS.TABLE_MOVING)},insertCol:function(e,t){if(e){t=t||0;var n,r,i,l,d,c,u=a.getParentByTagName(e[0][0].cell,"table",!1,null),f=u.rows,g=null;for(n=0;n<e.length;n++)r=e[n],r.length>t?(i=e[n][t],l=i.cell):(i=null,l=null),l&&l!==g&&i.x_src<t?(i.cell.colSpan++,i.cell.style.width=s.getCellWidth(i.cell)+o.options.table.colWidth+"px"):(!l||l&&i.x_src==t)&&(d=s.createCell(o.options.table.colWidth),l&&i.y_src<i.y?(c=s.getNextCellDataInRow(e[n],t),f[n].insertBefore(d,c?c.cell:null)):f[n].insertBefore(d,l)),g=i?i.cell:null;s.fixTableWidth(u)}},insertRow:function(e,t){if(e){t=t||0;var n,r,i,l=(a.getParentByTagName(e[0][0].cell,"table",!1,null),o.doc.createElement("tr")),d=e[e.length>t?t:e.length-1];for(n=0;n<d.length;n++)r=d[n],e.length>t&&r.y_src<r.y&&r.x_src==r.x?r.cell.rowSpan++:(e.length<=t||r.y_src==r.y)&&(i=s.cloneCell(r.cell,!0),r.cell.colSpan>1&&(i.style.width=r.cell.offsetWidth/r.cell.colSpan+"px"),l.appendChild(i));var c=d[0].cell.parentElement,u=c.parentElement;e.length<=t&&(c=null),u.insertBefore(l,c)}},isMenu:function(e){return!!e&&!!a.getParentByFilter(e,function(e){return a.hasClass(e,r.CLASS.TABLE_TOOLS)},!0)},mergeCell:function(e,t){if(!s.canMerge(e,t))return null;var n=t.maxY-t.minY+1,r=t.maxX-t.minX+1,i=e[t.minY][t.minX].cell,l=o.doc.createElement("div");for(s.eachRange(e,t,function(e){if(!e.fake&&e.cell!=i){if(!a.isEmptyDom(e.cell))for(l.lastChild&&l.appendChild(o.doc.createElement("br"));e.cell.firstChild;)l.appendChild(e.cell.firstChild);e.cell.parentNode.removeChild(e.cell)}});l.firstChild;)i.appendChild(l.firstChild);return i.rowSpan=n,i.colSpan=r,i},setCellAlign:function(e,t,n){if(e&&t){var o={};null!=n.align&&(o.align=n.align||"left"),null!=n.valign&&(o.valign=n.valign||"middle"),s.eachRange(e,t,function(e){e.fake||(o.align&&a.css(e.cell,{"text-align":""}),o.valign&&a.css(e.cell,{"text-valign":""}),a.attr(e.cell,o))})}},setCellBg:function(e,t,n){e&&t&&(n=n||"","transparent"===n.toLowerCase()&&(n=""),s.eachRange(e,t,function(e){e.fake||a.css(e.cell,{"background-color":n})}))},getKeyForColWidth:function(e){return e.x_src+"_"+e.y_src},fixColTimer:-1,fixColWidth:function(e,t,n,i,a){a>=0||(s.fixColTimer&&clearTimeout(s.fixColTimer),s.fixColTimer=setTimeout(function(){var l,d,c,u,f=a;for(e.style.width=t+"px",l=0,d=n.length;l<d;l++)c=n[l],u=c.cell.offsetWidth-i[s.getKeyForColWidth(c)]+a,f=0===l?u:Math.max(f,u);if(f>a){for(e.style.width=t-a+f+"px",l=0,d=n.length;l<d;l++)c=n[l],c.cell.style.width=i[s.getKeyForColWidth(c)]-a+f+"px";o.event.call(r.EVENT.UPDATE_RENDER)}},0))},setColWidth:function(e,t,n,r){function i(){var e,i,a,l,s=r;for(e=0;e<t.length;e++){if(i=t[e][n],l=o.options.table.colWidthMin-i.cell.offsetWidth,1==i.cell.colSpan){s=l,a=i.cell;break}s<l&&(s=l,a=i.cell)}return r<s?s:r}r=i();var a,l,d,c,u=e.offsetWidth+r,f=[],g={};for(a=0,l=t.length;a<l;a++)d=t[a][n],c=s.getKeyForColWidth(d),g[c]||(g[c]=d.cell.offsetWidth+r,f.push(d));for(e.style.width=u+"px",a=0,l=f.length;a<l;a++)d=f[a],d.cell.style.width=g[s.getKeyForColWidth(d)]+"px";s.fixColWidth(e,u,f,g,r)},setRowHeight:function(e,t,n,r){var i,a,l,s,d=r;for(i=0;i<t[n].length;i++){if(a=t[n][i],s=o.options.table.rowHeightMin-a.cell.offsetHeight,1==a.cell.rowSpan){d=s,l=a.cell;break}d<s&&(d=s,l=a.cell)}l&&(r<d?l.parentNode.style.height=o.options.table.rowHeightMin+"px":l.parentNode.style.height=a.cell.offsetHeight+r+"px")},splitCell:function(e,t,n){var o,r,i,a,l,d,c=s.canSplit(t,n);if(!c)return null;var u,f,g;for(a in c)if(c.hasOwnProperty(a))for(i=c[a],d=i.cell.rowSpan,l=i.cell.colSpan,r=i.y_src;r<i.y_src+d;r++)for(o=i.x_src;o<i.x_src+l;o++)u=t[r][o],u.fake?(f=s.getNextCellDataInRow(t[r],o),f=f?f.cell:null,g=s.cloneCell(u.cell,!0),e.rows[r].insertBefore(g,f),u.fake=!1,u.cell=g,u.y_src=r,u.x_src=o):(u.cell.rowSpan=1,u.cell.colSpan=1),u.cell.style.width="";return n}};t.exports=s},{"../rangeUtils/rangeExtend":41,"./../common/const":15,"./../common/env":17,"./../common/utils":21,"./../domUtils/domExtend":26}],48:[function(e,t,n){"use strict";function o(e){D.table=e,D.grid=S.getTableGrid(D.table)}function r(){if(D.table){var e,t=D.table.getElementsByClassName(y.CLASS.SELECTED_CELL);for(e=t.length-1;e>=0;e--)N.removeClass(t[e],[y.CLASS.SELECTED_CELL,y.CLASS.SELECTED_CELL_MULTI])}}function i(){if(!D.grid||!D.range)return null;var e=[];return S.eachRange(D.grid,D.range,function(t){t.fake||e.push(t)}),e}function a(e,t,n){var o=e.querySelector("#"+t);return o||(o=b.doc.createElement(n),o.id=t,e.appendChild(o)),o}function l(){if(!D.grid||!D.range)return!1;var e=!1;return S.eachRange(D.grid,D.range,function(t){return e=t.fake,!e}),!1}function s(){if(!D.grid||!D.range)return!1;var e=D.grid[D.range.minY][D.range.minX],t=D.grid[D.range.maxY][D.range.maxX],n=D.start;return e.cell==t.cell&&t.cell==n.cell}function d(){var e=_.getRange();if(!e)return b.client.type.isPhone||b.client.type.isPad||!s();var t,n,o;return D.grid&&D.start&&(t=N.getParentByTagName(e.startContainer,["th","td"],!0,null),n=e.collapsed?t:N.getParentByTagName(e.endContainer,["th","td"],!0,null)),!D.start||D.start.cell==t&&t==n||!e.collapsed&&D.start.cell==t&&t!=n&&0===e.endOffset&&n==S.getNextCellInTable(t)&&(n=t.lastChild,o=N.getEndOffset(n),setTimeout(function(){_.setRange(e.startContainer,e.startOffset,n,o)},200),!0)}function c(e){if(e){var t,n;for(t=0,n=e.length;t<n;t++)N.addClass(e[t].cell,y.CLASS.SELECTED_CELL+(n>1?" "+y.CLASS.SELECTED_CELL_MULTI:""))}}function u(e){if(D.table){var t=p(),n=t.colLine.minLeft;e<n&&(e=n),N.css(t.colLine,{top:D.table.offsetTop+"px",left:e+"px",height:D.table.offsetHeight+"px",display:"block"}),t.container.style.display="block"}}function f(e){if(D.table){var t=p(),n=t.rowLine.minTop;e<n&&(e=n),N.css(t.rowLine,{left:D.table.offsetLeft+"px",top:e+"px",width:D.table.offsetWidth+"px",display:"block"}),t.container.style.display="block"}}function g(e){S.initTableContainer(D.table);var t=D.table.parentNode;t.appendChild(e.container)}function m(){r(),c(i());var e=p();if(!D.start||!D.range)return e.container.style.display="none",e.start.dom.style.display="none",void(e.range.dom.style.display="none");g(e);var t,n,o,a,l,d,u,f,m=b.doc.body.clientTop,T=b.doc.body.clientLeft,E=D.start?D.start.cell:null,v=D.grid[D.range.minY][D.range.minX],y=D.grid[D.range.maxY][D.range.maxX];v&&y&&(v=v.cell,y=y.cell,E&&(n=m+E.offsetTop,t=T+E.offsetLeft,o=E.offsetWidth,a=E.offsetHeight),d=m+v.offsetTop,l=T+v.offsetLeft,v==y?(u=v.offsetWidth,f=v.offsetHeight):(u=y.offsetLeft+y.offsetWidth-l,f=y.offsetTop+y.offsetHeight-d),N.css(e.start.dom,{top:n+"px",left:t+"px"}),N.css(e.start.top,{width:o+"px"}),N.css(e.start.left,{height:a+"px"}),N.css(e.start.bottom,{top:a-1+"px",width:o+"px"}),N.css(e.start.right,{left:o-1+"px",height:a+"px"}),N.css(e.start.dot,{top:a-1-4+"px",left:o-1-4+"px"}),N.css(e.range.dom,{top:d+"px",left:l+"px"}),N.css(e.range.top,{width:u+"px"}),N.css(e.range.left,{height:f+"px"}),N.css(e.range.bottom,{top:f+"px",width:u+"px"}),N.css(e.range.right,{left:u+"px",height:f+"px"}),N.css(e.range.dot,{top:f-4+"px",left:u-4+"px"}),e.start.dom.style.display="block",s()?(e.start.dot.style.display="block",e.range.dom.style.display="none"):(e.start.dot.style.display="none",e.range.dom.style.display="block"),e.container.style.display="block",e.start.dot.style.display="none",e.range.dot.style.display="none",h())}function p(){var e={container:null,rowLine:null,colLine:null,start:{dom:null,top:null,right:null,bottom:null,left:null,dot:null},range:{dom:null,top:null,right:null,bottom:null,left:null,dot:null}};return e.container=a(b.doc.body,y.ID.TABLE_RANGE_BORDER,y.TAG.TMP_TAG),N.attr(e.container,{contenteditable:"false"}),e.colLine=a(e.container,y.ID.TABLE_COL_LINE,"div"),e.rowLine=a(e.container,y.ID.TABLE_ROW_LINE,"div"),e.start.dom=a(e.container,y.ID.TABLE_RANGE_BORDER+"_start","div"),e.start.top=a(e.start.dom,y.ID.TABLE_RANGE_BORDER+"_start_top","div"),e.start.right=a(e.start.dom,y.ID.TABLE_RANGE_BORDER+"_start_right","div"),e.start.bottom=a(e.start.dom,y.ID.TABLE_RANGE_BORDER+"_start_bottom","div"),e.start.left=a(e.start.dom,y.ID.TABLE_RANGE_BORDER+"_start_left","div"),e.start.dot=a(e.start.dom,y.ID.TABLE_RANGE_BORDER+"_start_dot","div"),e.range.dom=a(e.container,y.ID.TABLE_RANGE_BORDER+"_range","div"),e.range.top=a(e.range.dom,y.ID.TABLE_RANGE_BORDER+"_range_top","div"),e.range.right=a(e.range.dom,y.ID.TABLE_RANGE_BORDER+"_range_right","div"),e.range.bottom=a(e.range.dom,y.ID.TABLE_RANGE_BORDER+"_range_bottom","div"),e.range.left=a(e.range.dom,y.ID.TABLE_RANGE_BORDER+"_range_left","div"),e.range.dot=a(e.range.dom,y.ID.TABLE_RANGE_BORDER+"_range_dot","div"),e}function h(){var e;return D.grid&&D.range&&!s()?(e=b.doc.getSelection(),void e.empty()):void(d()||_.setRange(D.start.cell,D.start.cell.childNodes.length))}var T,E,v,b=e("../common/env"),y=e("../common/const"),A=e("../common/utils"),C=e("../common/historyUtils"),S=e("./tableUtils"),N=e("../domUtils/domExtend"),_=e("../rangeUtils/rangeExtend"),D={active:!1,table:null,start:null,end:null,range:null,grid:null},w={bind:function(){w.unbind(),b.event.add(y.EVENT.ON_SELECT_CHANGE,w.handler.onSelectionChange),b.event.add(y.EVENT.UPDATE_RENDER,w.handler.updateRender),D.table&&(D.table.addEventListener("DOMSubtreeModified",w.handler.onDomModified),b.doc.body.addEventListener("resize",w.handler.onDomModified))},unbind:function(){var e=x.getZone();b.event.remove(y.EVENT.ON_SELECT_CHANGE,w.handler.onSelectionChange),b.event.remove(y.EVENT.UPDATE_RENDER,w.handler.updateRender),e.table&&(e.table.removeEventListener("DOMSubtreeModified",w.handler.onDomModified),b.doc.body.removeEventListener("resize",w.handler.onDomModified))},bindStopSelectStart:function(){w.unbindStopSelectStart(),b.event.add(y.EVENT.ON_SELECT_START,w.handler.onStopSelectStart)},unbindStopSelectStart:function(){b.event.remove(y.EVENT.ON_SELECT_START,w.handler.onStopSelectStart)},bindDragLine:function(){w.unbindDragLine(),w.bindStopSelectStart(),b.event.add(y.EVENT.ON_MOUSE_MOVE,w.handler.onDragLineMove),b.event.add(y.EVENT.ON_MOUSE_UP,w.handler.onDragLineEnd)},unbindDragLine:function(){w.unbindStopSelectStart(),b.event.remove(y.EVENT.ON_MOUSE_MOVE,w.handler.onDragLineMove),b.event.remove(y.EVENT.ON_MOUSE_UP,w.handler.onDragLineEnd)},handler:{onDragLineMove:function(e){var t=p(),n=S.getMousePosition(e,D.table);"block"==t.colLine.style.display?u(n.x-t.colLine.startMouse+t.colLine.startLine):f(n.y-t.rowLine.startMouse+t.rowLine.startLine)},onDragLineEnd:function(e){w.unbindDragLine();var t,n=p(),o=S.getMousePosition(e,D.table),r="block"==n.colLine.style.display,i="block"==n.rowLine.style.display;n.colLine.style.display="none",n.rowLine.style.display="none",C.saveSnap(!1),r&&n.colLine.startMouse!==o.x?(t=n.colLine.cellData,t&&(S.initTable(D.table),S.setColWidth(D.table,D.grid,t.x,o.x-n.colLine.startMouse))):i&&n.rowLine.startMouse!==o.y&&(t=n.rowLine.cellData,t&&(S.initTable(D.table),S.setRowHeight(D.table,D.grid,t.y,o.y-n.rowLine.startMouse))),n.colLine.cellData=null,n.colLine.minLeft=null,n.colLine.startLine=null,n.colLine.startMouse=null,n.rowLine.cellData=null,n.rowLine.minTop=null,n.rowLine.startLine=null,n.rowLine.startMouse=null,b.event.call(y.EVENT.UPDATE_RENDER)},onSelectionChange:function(e){var t=b.doc.getSelection();d()||(t.empty(),A.stopEvent(e))},onDomModified:function(e){var t=e&&"DOMSubtreeModified"==e.type&&1===e.target.nodeType&&e.target.querySelector("img");v&&clearTimeout(v),v=setTimeout(function(){b.event.call(y.EVENT.UPDATE_RENDER,e,t)},100)},onStopSelectStart:function(e){return A.stopEvent(e),!1},updateRender:function(e,t){function n(e){m(),e&&E<60&&(T&&clearTimeout(T),T=setTimeout(function(){E++,n(e)},500))}E=0,n(t)}}},x={clear:function(){D.active=!1,D.start=null,D.end=null,D.range=null,D.grid=null,m();var e=p();return e.colLine.style.display="none",e.rowLine.style.display="none",D.table=null,w.unbind(),x},getFragmentForCopy:function(){var e=null;if(!D.range)return e;var t,n,o,r,i,a=b.doc.createElement("table"),l=b.doc.createElement("tbody");for(a.appendChild(l),n=D.range.minY;n<=D.range.maxY;n++){for(r=b.doc.createElement("tr"),t=D.range.minX;t<=D.range.maxX;t++)o=D.grid[n][t],o.fake||(i=S.cloneCell(o.cell,!1),r.children.length>0&&r.appendChild(b.doc.createTextNode("\t")),r.appendChild(i));r.appendChild(b.doc.createTextNode("\n")),l.appendChild(r)}return e=b.doc.createElement("div"),e.appendChild(a),e},getRangeBorder:p,getSelectedCells:function(){return S.getCellsByRange(D.grid,D.range)},getZone:function(){return{active:D.active,table:D.table,start:D.start,end:D.end,range:D.range,grid:D.grid}},hasMergeCell:l,isRangeActiving:function(){return D.start&&D.active},isSingleCell:s,isZoneBorder:function(e){var t,n=e.target,o=e.offsetX,r=e.offsetY,i=A.getEventClientPos(e),a=!1,l=!1,s=!1,d=!1,c=!1,u=!!N.getParentByFilter(n,function(e){return e&&1==e.nodeType&&(e.id==y.ID.TABLE_RANGE_BORDER+"_start_dot"||e.id==y.ID.TABLE_RANGE_BORDER+"_range_dot")},!0);u||(s=!!N.getParentByFilter(n,function(e){if(e&&1==e.nodeType&&(e.id==y.ID.TABLE_RANGE_BORDER+"_start_right"||e.id==y.ID.TABLE_RANGE_BORDER+"_range_right"))return!0;var t,n;return!(!e||1!=e.nodeType||!N.isTag(e,["td","th"]))&&(t=e.offsetWidth-4,n=e.offsetWidth+4,o>=t&&o<=n)},!0)),u||s||(d=!!N.getParentByFilter(n,function(e){if(e&&1==e.nodeType&&(e.id==y.ID.TABLE_RANGE_BORDER+"_start_bottom"||e.id==y.ID.TABLE_RANGE_BORDER+"_range_bottom"))return!0;var t,n;return!(!e||1!=e.nodeType||!N.isTag(e,["td","th"]))&&(t=e.offsetHeight-4,n=e.offsetHeight+4,r>=t&&r<=n)},!0)),d||u||s||(l=!!N.getParentByFilter(n,function(e){return e&&1==e.nodeType&&e.id==y.ID.TABLE_RANGE_BORDER},!0));var f,g,m;return d||u||s||l||(c=!!S.getContainerExcludeTable(n),c||n!=b.doc.body||(f=b.win.getComputedStyle(n),g=parseInt(f.paddingLeft),m=parseInt(f.paddingRight),a=i.x<=g||i.x>=b.doc.body.offsetWidth-m)),t=(e.target.clientWidth>0&&e.target.clientWidth<e.offsetX||e.target.clientHeight>0&&e.target.clientHeight<e.offsetY)&&(e.target.offsetWidth>=e.offsetX||e.target.offsetHeight>=e.offsetY),{isBodyBorder:a,isBorder:l,isBottom:d,isContainer:c,isDot:u,isRight:s,isScroll:t}},modify:function(e){if(!D.active||!e)return x;var t=N.getParentByTagName(e,["table"],!0,null);if(!t||t!==D.table)return x;var n=S.getCellData(D.grid,e);D.range=S.getRangeByCellsData(D.grid,D.start,n),D.end=n,m();var o=N.getParentByFilter(D.table,function(e){return N.hasClass(e,y.CLASS.TABLE_BODY)},!1);return N.addClass(o,y.CLASS.TABLE_MOVING),x},remove:function(){x.clear();var e,t=p();t&&(e=t.container.parentNode,e&&e.removeChild(t.container))},setEnd:function(e,t){t&&(D.active=!0),x.modify(e),D.active=!1,h(),b.event.call(y.EVENT.ON_SELECT_CHANGE,null);var n=N.getParentByFilter(D.table,function(e){return N.hasClass(e,y.CLASS.TABLE_BODY)},!1);return N.removeClass(n,y.CLASS.TABLE_MOVING),x},setStart:function(e,t,n){if(!e)return x.clear(),x;var r=N.getParentByTagName(e,["table"],!0,null);if(!r)return x.clear(),x;if(r!==D.table&&(x.clear(),o(r)),D.active=!0,D.end=null,D.start=S.getCellData(D.grid,e),"undefined"!=typeof t&&"undefined"!=typeof n)try{var i=D.grid[n][t];i&&i.cell==D.start.cell&&(D.start=i)}catch(e){}return D.range=S.getRangeByCellsData(D.grid,D.start,D.start),m(),w.bind(),x},setStartRange:h,startDragColLine:function(e,t){var n,i;if(e&&1==e.nodeType&&e.id==y.ID.TABLE_RANGE_BORDER+"_start_right")i=D.start,e=D.start.cell,n=D.table;else if(e&&1==e.nodeType&&e.id==y.ID.TABLE_RANGE_BORDER+"_range_right")i=D.grid[D.range.maxY][D.range.maxX],e=i.cell,n=D.table;else{if(e=N.getParentByTagName(e,["th","td"],!0,null),!e)return;if(n=N.getParentByTagName(e,["table"],!0,null),!n)return;n!==D.table&&(r(),x.clear()),D.grid||o(n),i=S.getCellData(D.grid,e)}for(var a,l=i.x;l+1<D.grid[i.y].length&&(l++,a=D.grid[i.y][l],a.cell==e);)i=a;var s=e.offsetLeft+e.offsetWidth,d=p();g(d),d.colLine.minLeft=n.offsetLeft,d.colLine.startLine=s,d.colLine.startMouse=t,d.colLine.cellData=i,u(s);var c=b.doc.getSelection();c.empty(),w.bindDragLine()},startDragRowLine:function(e,t){var n,i;if(e&&1==e.nodeType&&e.id==y.ID.TABLE_RANGE_BORDER+"_start_bottom")i=D.start,e=D.start.cell,n=D.table;else if(e&&1==e.nodeType&&e.id==y.ID.TABLE_RANGE_BORDER+"_range_bottom")i=D.grid[D.range.maxY][D.range.maxX],e=i.cell,n=D.table;else{if(e=N.getParentByTagName(e,["th","td"],!0,null),!e)return;if(n=N.getParentByTagName(e,["table"],!0,null),!n)return;n!==D.table&&(r(),x.clear()),D.grid||o(n),i=S.getCellData(D.grid,e)}for(var a,l=i.y;l+1<D.grid.length&&(l++,a=D.grid[l][i.x],a.cell==e);)i=a;var s=e.offsetTop+e.offsetHeight,d=p();g(d),d.rowLine.minTop=n.offsetTop,d.rowLine.startLine=s,d.rowLine.startMouse=t,d.rowLine.cellData=i,f(s);var c=b.doc.getSelection();c.empty(),w.bindDragLine()},switchCell:function(e,t){function n(){t.canChangeRow&&r>=0&&r<D.grid.length&&(o<0?(o=D.grid[r].length-1,r-=1):o>=D.grid[r].length&&(o=0,r+=1))}if(!t||!D.start)return null;t.x=t.x?t.x>0?1:-1:0,t.y=t.y?t.y>0?1:-1:0;var o=e.x+t.x,r=e.y+t.y;n();for(var i=e;r>=0&&r<D.grid.length&&o>=0&&o<D.grid[r].length&&i.cell==e.cell;)i=D.grid[r][o],o+=t.x,r+=t.y,n();return i},updateGrid:function(){var e,t;return D.table&&(D.grid&&(e=D.grid[D.range.minY][D.range.minX],t=D.grid[D.range.maxY][D.range.maxX]),o(D.table),e=S.getCellData(D.grid,e.cell),t=S.getCellData(D.grid,t.cell),D.range=S.getRangeByCellsData(D.grid,e,t),D.start=S.getCellData(D.grid,D.start.cell),D.end&&(D.end=S.getCellData(D.grid,D.end.cell))),b.event.call(y.EVENT.UPDATE_RENDER),x}};t.exports=x},{"../common/const":15,"../common/env":17,"../common/historyUtils":18,"../common/utils":21,"../domUtils/domExtend":26,"../rangeUtils/rangeExtend":41,"./tableUtils":47}],49:[function(e,t,n){"use strict";function o(e){if(!g.hasPermission())return null;var t=e.target;if(!d.hasClass(t,a.CLASS.TODO_CHECKBOX))return null;var n=f.getContainerFromChild(t),o=f.getContainerFromChild(n.parentNode);return o&&f.fixNewTodo(o),i.readonly&&p.curCheckbox?null:void(!i.readonly||p.docLockChecked?r(t,e):(p.curCheckbox=t,g.checkDocLock("onCheckDocLock")))}function r(e,t){var n=f.checkTodo(e,g);n&&(p.addModifiedId(n),t&&s.stopEvent(t))}var i=e("../common/env"),a=e("../common/const"),l=e("../common/wizStyle"),s=e("../common/utils"),d=e("../domUtils/domExtend"),c=e("../rangeUtils/rangeExtend"),u=e("./todoRouteForClient"),f=e("./todoUtils"),g=null,m=null,p={curCheckbox:null,docLockChecked:!1,modifiedIdMap:null,modifiedIdList:{},htmlToSave:"",init:function(){i.readonly&&(p.modifiedIdList={})},addModifiedId:function(e){if(i.readonly){var t,n,o;if(!p.modifiedIdMap)for(p.modifiedIdMap={},t=i.doc.querySelectorAll("."+a.CLASS.TODO_CHECKBOX),n=0;n<t.length;n++)o=t[n],p.modifiedIdMap[o.id]=n;var r=p.modifiedIdList[e.id];r&&r!==e.checked?delete p.modifiedIdList[e.id]:p.modifiedIdList[e.id]=e.checked}},getModifiedIdList:function(){var e,t=[];for(e in p.modifiedIdList)p.modifiedIdList.hasOwnProperty(e)&&t.push({id:e,checked:p.modifiedIdList[e],index:p.modifiedIdMap[e]});return t},modifyDoc:function(){var e="",t=p.getModifiedIdList();if(0===t.length)return e;e=g.getOriginalDoc();var n=i.doc.getElementById(a.ID.IFRAME_FOR_SAVE);n||(n=i.doc.createElement("iframe"),n.id=a.ID.IFRAME_FOR_SAVE,i.doc.body.appendChild(n)),n.style.display="none";var o,r,l,s,c,u,m,h=i.doc,T=i.win,E=n.contentDocument,v=g.isPersonalDocument();for(E.open("text/html","replace"),E.write(e),E.close(),i.doc=E,i.win=n.contentWindow,f.oldPatch.fixOldTodo(),f.fixNewTodo(),c=i.doc.querySelectorAll("."+a.CLASS.TODO_CHECKBOX),o=t.length-1;o>=0;o--)r=t[o].id,s=t[o].index,l=t[o].checked,u=i.doc.getElementById(r),u||(u=c[s]),u&&(m=f.getMainFromChild(u),f.check(m,l),v||f.addUserInfo(m,l,r,g));return f.checkTodoStyle(!0),e=d.getContentHtml(),i.doc=h,i.win=T,i.doc.body.removeChild(n),e}},h={bind:function(){h.unbind(),i.event.add(a.EVENT.ON_SELECT_CHANGE,h.handler.onSelectionChange),i.event.add(a.EVENT.AFTER_RESTORE_HISTORY,h.handler.afterRestoreHistory),i.event.add(a.EVENT.ON_EXEC_COMMAND,h.handler.onExecCommand),i.event.add(a.EVENT.ON_PASTE,h.handler.onPaste),i.event.add(a.EVENT.AFTER_INSERT_DOM,h.handler.afterInsertDom),i.client.type.isIOS||i.client.type.isAndroid?(i.event.add(a.EVENT.ON_TOUCH_END,h.handler.onTouchEnd),i.event.add(a.EVENT.ON_TOUCH_START,h.handler.onTouchStart)):i.event.add(a.EVENT.ON_CLICK,h.handler.onClick)},unbind:function(){i.event.remove(a.EVENT.ON_CLICK,h.handler.onClick),i.event.remove(a.EVENT.ON_SELECT_CHANGE,h.handler.onSelectionChange),i.event.remove(a.EVENT.ON_TOUCH_END,h.handler.onTouchEnd),i.event.remove(a.EVENT.ON_TOUCH_START,h.handler.onTouchStart),i.event.remove(a.EVENT.AFTER_RESTORE_HISTORY,h.handler.afterRestoreHistory)},handler:{afterRestoreHistory:function(){f.checkTodoStyle(!1),l.restoreUserAvatarStyle()},onClick:function(e){o(e)},onCheckDocLock:function(e,t){p.docLockChecked=!t,e||r(p.curCheckbox),p.curCheckbox=null},onExecCommand:function(){var e,t,n,o,r=c.getRange();if(r&&(e=r.collapsed?r.startContainer:d.getParentRoot([r.startContainer,r.endContainer]),e=d.getBlockParent(e,!0)))for(t=e.querySelectorAll("."+a.CLASS.TODO_CHECKBOX),n=0,o=t.length;n<o;n++)f.fixCheckbox(t[n],!1)},onKeyDown:function(e){if(!g.hasPermission())return!0;var t=c.getRange();if(!t)return!0;var n,o,r,l,u,m,p,h,T,E,v,b,y,A,C,S,N,_,D=e.keyCode||e.which;if(!t.collapsed){if(8!==D&&46!==D&&s.checkNonTxtKey(e))return!0;if(_=c.getRangeDomList({noSplit:!0}))for(r=t.endContainer,l=t.endOffset,3!==r.nodeType&&(t.endOffset===r.childNodes.length?(r=d.getLastDeepChild(r),l=d.getEndOffset(r)):(r=r.childNodes[t.endOffset],l=0)),E=f.getContainerFromChild(r),S=_.list.length-1;S>=0;S--)N=_.list[S],f.isCheckbox(N)&&(T=f.getContainerFromChild(N),h=f.getMainFromChild(N),h&&(p=h.parentNode,f.cancelTodo(p,!0)),E&&T==E&&(r.parentNode||(r=p,l=d.getEndOffset(r)),c.setRange(t.startContainer,t.startOffset,r,l)));return!0}if(u=f.isCaretAfterCheckbox(),m=f.getMainByCaret(),p=m?d.getBlockParent(m,!1):f.getContainerFromChild(t.startContainer),v=d.getEndOffset(t.endContainer)===t.endOffset,!p&&!v)return!0;if(8===D&&u)return f.cancelTodo(p),s.stopEvent(e),!1;if(46===D&&(n=t.startContainer,o=t.startOffset,c.selectCharIncludeFillChar(),t=c.getRange(),r=t.endContainer,0===t.endOffset&&(r=d.getPreviousNode(r)),h=f.getMainFromChild(r)||f.getMainInDom(r),c.setRange(n,o),h&&h!=m))return f.cancelTodo(h.parentNode,!0),!1;if(37===D&&u&&(N=d.getPreviousNode(p)))return c.setRange(N,d.getEndOffset(N)),s.stopEvent(e),!1;if(!p||13!==D||e.shiftKey)return!0;if(f.isEmptyContainer(p))return p.innerHTML="<br>",d.removeClass(p,a.CLASS.TODO_LAYER),c.setRange(p,1),s.stopEvent(e),!1;t.deleteContents(),f.fixNewTodo(p);var w=!1;m&&(t.startContainer==m&&t.startOffset!==d.getEndOffset(m)?w=!0:f.getMainFromChild(t.startContainer)&&(t.startOffset!==d.getEndOffset(t.startContainer)||t.startContainer.nextSibling)&&(w=!0)),t.setEndAfter(w?m:p);var x=t.cloneContents(),O=i.doc.createElement("div");for(x.appendChild(O);x.childNodes.length>1;)O.appendChild(x.firstChild);b=d.isEmptyDom(O);var L;if(b)A=f.cloneTodo(p),m=f.getMainInDom(A),d.after(A,p),f.setTodo(A,g),N=d.getLastDeepChild(A),3===N.nodeType?N.nodeValue=a.FILL_CHAR+a.FILL_CHAR:(N.appendChild(i.doc.createTextNode(a.FILL_CHAR+a.FILL_CHAR)),N=N.childNodes[0]),c.setRange(N,1);else{for(L=t.extractContents(),C=[],S=0;S<L.childNodes.length;S++)C.push(L.childNodes[S]);for(y=p!=i.doc.body&&d.isBlockDom(p)?p.tagName:"div",A=i.doc.createElement(y),d.after(A,p),m=f.setTodo(A,g),f.insertToMain(C,m),S=0;S<C.length;S++)f.clearBlock(C[S]);c.setRange(m,1)}if(s.stopEvent(e),m.getBoundingClientRect().top+m.clientHeight>i.doc.documentElement.clientHeight||m.getBoundingClientRect().top+m.clientHeight<0){var R=m.getBoundingClientRect().left+i.doc.body.scrollLeft,I=i.doc.body.scrollTop+m.clientHeight;window.scrollTo(R,I)}},afterInsertDom:function(){f.fixNewTodo(),f.checkTodoStyle(!1)},onPaste:function(){setTimeout(function(){h.handler.afterInsertDom()},300)},onSelectionChange:function(e){var t=c.getRange();if(t){var n,o,r;t.collapsed||(o=t.endContainer,r=t.endOffset);var i=f.isCaretBeforeCheckbox();i.enable&&(n=i.checkbox,n&&n.nextSibling?(o=n.nextSibling,r=0):n&&(o=n.parentNode,r=d.getDomIndex(n)+1),t.collapsed?c.setRange(o,r):c.setRange(t.startContainer,t.startOffset,o,r))}},onTouchStart:function(e){m=e.target},onTouchEnd:function(e){e.target===m&&(m=null,o(e))}}},T={init:function(){},on:function(){f.oldPatch.fixOldTodo(),f.fixNewTodo(),p.init(),h.bind(),g||(g=u.getRoute()),f.checkTodoStyle(!0)},off:function(){h.unbind()},checkTodoStyle:function(){f.checkTodoStyle(!1)},closeDocument:function(){var e;return g||(g=u.getRoute()),e=i.client.type.isWin&&i.options.pc.pluginModified?d.getContentHtml():p.modifyDoc(),!e||i.client.type.isIOS||i.client.type.isMac||g.saveDoc(e,""),g.beforeCloseDoc&&g.beforeCloseDoc(),p.init(),e},onCheckDocLock:h.handler.onCheckDocLock,
onKeyDown:h.handler.onKeyDown,setTodo:function(){f.setTodo(null,g)},setTodoInfo:function(e){g.setTodoInfo&&g.setTodoInfo(e)}};t.exports=T},{"../common/const":15,"../common/env":17,"../common/utils":21,"../common/wizStyle":22,"../domUtils/domExtend":26,"../rangeUtils/rangeExtend":41,"./todoRouteForClient":50,"./todoUtils":51}],50:[function(e,t,n){"use strict";function o(){function e(){return s.UserAlias}function t(){return s.GetUserGUID()}function n(e){return s.GetUserAvatarFileName(e)}function o(){try{return s.WizDocument.IsPersonalDocument()}catch(e){return!1}}function r(e){s.WizDocument&&(s.WizDocument.Type=e)}function i(){return!u.readonly||s.WizDocument.CanEdit}function a(){try{return s.WizDocument.GetHtml()}catch(e){return""}}function l(e,t){s.WizDocument.SetHtml2(e,t)}function d(e){return o()?void WizReader.todo[e](!1,!1):void s.ExecuteCommand("OnClickingChecklist","WizReader.todo."+e+"({cancel}, {needCallAgain});","readingnote")}s=u.win.external,this.getUserAlias=e,this.getUserGuid=t,this.getUserAvatarFileName=n,this.isPersonalDocument=o,this.setDocumentType=r,this.hasPermission=i,this.getOriginalDoc=a,this.saveDoc=l,this.checkDocLock=d}function r(){function e(){return"zzz"}function t(){return"63272832-e387-4d31-85c6-7549555f2231"}function n(){return"/wizas/a/users/avatar/63272832-e387-4d31-85c6-7549555f2231?default=true"}function o(){return!1}function r(e){}function i(){return!0}function a(){return u.doc.body.outerHTML}function l(e,t){console.log("saveDoc")}function s(e){setTimeout(function(){WizReader.todo.onCheckDocLock(!1,!1)},500)}this.getUserAlias=e,this.getUserGuid=t,this.getUserAvatarFileName=n,this.isPersonalDocument=o,this.setDocumentType=r,this.hasPermission=i,this.getOriginalDoc=a,this.saveDoc=l,this.checkDocLock=s}function i(){function e(){return d.userAlias}function t(){return d.userGuid}function n(e){return d.userAvatarFilePath}function o(){return d.isPersonalDocument}function r(e){d.changeCurrentDocumentType(e)}function i(){return!u.readonly||d.hasEditPermissionOnCurrentNote}function a(){return d.currentNoteHtml}function l(e,t){}function s(e){return d.clickingTodoCallBack.connect(WizReader.todo[e]),d.checkListClickable()}d=u.win.WizQtEditor,this.getUserAlias=e,this.getUserGuid=t,this.getUserAvatarFileName=n,this.isPersonalDocument=o,this.setDocumentType=r,this.hasPermission=i,this.getOriginalDoc=a,this.saveDoc=l,this.checkDocLock=s}function a(){function e(){return c.getUserAlias()}function t(){return c.getUserGuid()}function n(e){return c.getUserAvatarFileName(e)}function o(){return c.isPersonalDocument()}function r(e){c.setDocumentType(e)}function i(){return!u.readonly||c.hasPermission()}function a(){return c.getDocHtml()}function l(e,t){c.setDocHtml(e,t)}function s(e){c.checkDocLock()}function d(){c.onWizTodoReadCheckedClose()}c=u.win.WizNote,this.getUserAlias=e,this.getUserGuid=t,this.getUserAvatarFileName=n,this.isPersonalDocument=o,this.setDocumentType=r,this.hasPermission=i,this.getOriginalDoc=a,this.saveDoc=l,this.checkDocLock=s,this.beforeCloseDoc=d}function l(){function e(e){this.userAlias=e.alias,this.userGuid=e.userGuid,this.avatarFileName=e.avatar,this.personalDocument="true"===e.isPersonal,this._hasPermission="true"===e.hasPermission,this.originalHtml=f.decode(e.docHtml)}function t(){return this.userAlias}function n(){return this.userGuid}function o(e){return this.avatarFileName}function r(){return this.personalDocument}function i(e){u.win.location.href="wiztodolist://setDocumentType/?type="+e}function a(){return!u.readonly||this._hasPermission}function l(){return this.originalHtml}function s(e){u.win.location.href="wiztodolist://tryLockDocument/?callback="+e}this.getUserAlias=t,this.getUserGuid=n,this.getUserAvatarFileName=o,this.isPersonalDocument=r,this.setDocumentType=i,this.setTodoInfo=e,this.hasPermission=a,this.getOriginalDoc=l,this.checkDocLock=s,this.userAlias="",this.userGuid="",this.avatarFileName="",this.personalDocument=!1,this._hasPermission=!1,this.originalHtml=""}var s,d,c,u=e("../common/env"),f=e("../common/base64"),g={getRoute:function(){var e=null;return e=u.client.type.isWin?new o:u.client.type.isMac?new i:u.client.type.isIOS?new l:u.client.type.isAndroid?new a:new r},setQtEditor:function(){d=u.win.WizQtEditor}};t.exports=g},{"../common/base64":14,"../common/env":17}],51:[function(e,t,n){"use strict";var o=e("../common/env"),r=e("../common/const"),i=e("../common/lang"),a=i.getLang(),l=e("./../common/base64"),s=e("../common/wizStyle"),d=e("../domUtils/domExtend"),c=e("../rangeUtils/rangeExtend"),u=e("../common/historyUtils"),f={addUserInfo:function(e,t,n,i){if(e){var a,l,u,g,m,p,h,T,E;if(a=f.deleteUserInfo(e.parentNode),!t)return void s.removeUnUsedTodoStyle(a);for(a=i.getUserGuid(),l=i.getUserAlias(),u=i.getUserAvatarFileName(r.CSS.TODO_LIST.IMG_WIDTH),g=f.getTime(),f.setUserAvatarStyle(a,u),m=f.getUserInfoHtml(a,l,g),p=o.doc.createElement("span"),d.addClass(p,r.CLASS.TODO_USER_INFO),p.innerHTML=m,p.setAttribute(r.ATTR.TODO_ID,n),E=e.childNodes.length-1;E>=0;E--)h=e.childNodes[E],h.tagName&&"br"==h.tagName.toLowerCase()&&e.removeChild(h);for(T=e.nextElementSibling;T;){if(f.isMain(T)){e.parentElement.insertBefore(p,T);break}if("br"==T.tagName.toLowerCase()){e.parentElement.insertBefore(p,T);break}T=T.nextElementSibling}T||e.parentElement.appendChild(p),p.hasChildNodes()||p.appendChild(o.doc.createElement("br")),c.setRange(p,p.childNodes.length)}},canBeContainer:function(e){return!d.isTag(e,["body","td","th"])&&d.isBlockDom(e)},cancelTodo:function(e,t){if(e){u.saveSnap(!1);var n,i,a,l,g,m=c.getRange();n=m?m.startContainer:null,i=m?m.startOffset:0,a=f.getMainInDom(e),g=f.deleteUserInfo(e),s.removeUnUsedTodoStyle(g),l=f.deleteMain(a),l=l?l.start:null,d.removeClass(e,r.CLASS.TODO_LAYER),l||(l=o.doc.createElement("br"),e.appendChild(l)),t||(n&&n.parentNode||(n=l,i=0),c.setRange(n,i)),f.checkTodoStyle(!1)}},check:function e(t,n){n?(d.removeClass(t,r.CLASS.TODO_UNCHECKED),d.addClass(t,r.CLASS.TODO_CHECKED)):(d.removeClass(t,r.CLASS.TODO_CHECKED),d.addClass(t,r.CLASS.TODO_UNCHECKED));var e=f.getCheckbox(t),o=n?"checked":"unchecked";e.setAttribute(r.ATTR.TODO_CHECK,o)},checkTodo:function(e,t){var n={id:"",checked:!1};u.saveSnap(!1);var o,i=f.getMainFromChild(e);return i&&i.children[0]==e||f.fixCheckbox(e,!1),o="checked"!==e.getAttribute(r.ATTR.TODO_CHECK),f.check(i,o),n.id=e.id,n.checked=o,t.isPersonalDocument()||f.addUserInfo(i,o,e.id,t),n},checkTodoStyle:function(e){var t=o.doc.querySelector("."+r.CLASS.TODO_CHECKBOX);t?s.insertTodoStyle(e):s.removeTodoStyle()},clearBlock:function(e){if(!e||1!==e.nodeType&&3!==e.nodeType&&11!==e.nodeType)return!1;var t,n;for(n=0;n<e.childNodes.length;n++)t=e.childNodes[n],f.clearBlock(t)&&t!=e.childNodes[n]&&n--;var o=11==e.nodeType,r=!o&&f.isTodoTag(e),i=!o&&d.isBlockDom(e);if(i&&d.isEmptyDom(e)){if(!(e.children.length>0))return e.parentNode.removeChild(e),!0;d.stripDom(e)}else(i||r)&&d.stripDom(e);return!1},clearTodoClass:function(e){e&&d.removeClass(e,[r.CLASS.TODO_ACCOUNT,r.CLASS.TODO_AVATAR,r.CLASS.TODO_DATE,r.CLASS.TODO_LAYER,r.CLASS.TODO_MAIN,r.CLASS.TODO_CHECKED,r.CLASS.TODO_UNCHECKED,r.CLASS.TODO_USER_INFO])},cloneTodo:function(e){if(!e)return null;var t,n,i,a,l;if(t=d.clone(e,!0),a=f.getMainInDom(e),!a)return null;n=d.clone(a,!0),d.removeClass(n,r.CLASS.TODO_CHECKED),d.addClass(n,r.CLASS.TODO_UNCHECKED);for(var s=a,u=n;s&&s.childNodes&&s.childNodes.length;){for(l=s.childNodes[s.childNodes.length-1];l&&(3===l.nodeType&&0===l.nodeValue.replace(r.FILL_CHAR_REG,"").length||d.isBlockDom(l)||d.isSelfClosingTag(l));)l=l.previousSibling;!l||f.isCheckbox(l)?(i=o.doc.createTextNode(""),l=null):i=d.clone(l,!0),u.appendChild(i),u=i,s=l}return t.appendChild(n),c.setRange(n,1),t},deleteMain:function(e){return d.stripDom(e,function(e){return!f.isMain(e)&&!f.isCheckbox(e)})},deleteUserInfo:function(e){var t="",n=f.getMainInDom(e),o=e.querySelector("."+r.CLASS.TODO_AVATAR),i=o?o.className:"",a=new RegExp("^(.*"+r.CLASS.TODO_USER_AVATAR+")([^ ]*)(.*)$","i");i.indexOf(r.CLASS.TODO_USER_AVATAR)>-1&&(t=i.replace(a,"$2"));for(var l,s=n?n.nextElementSibling:e.firstChild;s&&!f.isMain(s);)f.isUserInfo(s)?(l=s,s=s.nextElementSibling,e.removeChild(l)):s=s.nextElementSibling;return t},fixCheckbox:function(e,t){if(e&&(e.id||(e.id=f.getCheckId()),d.attr(e,{style:null}),t||!f.getMainFromChild(e))){var n,i,a,l,s=d.getBlockParent(e),c=f.canBeContainer(s),u=o.doc.createElement("span"),g=!1;for(u.className=(t?r.CLASS.TODO_LABEL_OLD:r.CLASS.TODO_MAIN)+" "+r.CLASS.TODO_UNCHECKED,n=o.doc.createElement(c?s.tagName:"div"),c?d.after(n,s):d.before(n,e),n.appendChild(u),i=e;i;){if(a=i.nextSibling,d.isBlockDom(i)){if(!c)break;g=!0,l=n.nextSibling}g?d.before(i,l):f.isUserInfo(i)?d.after(i,u):u.appendChild(i),i=a}d.addClass(n,r.CLASS.TODO_LAYER);var m=f.getContainerFromChild(n.parentNode);m&&d.removeClass(m,r.CLASS.TODO_LAYER),c&&d.isEmptyDom(s)&&s.parentNode.removeChild(s)}},fixMain:function(e){if(e){var t,n,o=d.getLastDeepChild(e),i=f.getCheckbox(e);d.attr(e,{style:null}),t=f.getContainerFromChild(e),t&&t!==e.parentNode&&t.appendChild(e);var a=e.querySelectorAll("."+r.CLASS.TODO_MAIN);for(n=a.length-1;n>=0;n--)d.after(a[n],e);if(d.isEmptyDom(e)&&e.parentNode&&e.parentNode.removeChild(e),o!=i&&(1!==o.nodeType&&3!==o.nodeType||1==o.nodeType&&d.isTag(o,"br")||3===o.nodeType&&0===o.nodeValue.replace(r.FILL_CHAR_REG,"").length)){for(t=o.parentNode;t!=e&&1==t.childNodes.length;)o=t,t=t.parentNode;o.parentNode.removeChild(o),f.fixMain(e)}}},fixNewTodo:function(e){var t,n,i,a,l,s,c,u,g,m,p,h,T,E;for(n=e?e:o.doc,i=n.querySelectorAll("."+r.CLASS.TODO_LAYER),t=0;t<i.length;t++)if(a=i[t],d.attr(a,{style:null}),l=a.querySelectorAll("."+r.CLASS.TODO_LAYER),0!==l.length&&(s=l[0],c=s.parentNode,h=f.isTodoTag(c)?s:c,T=a,T!==h)){for(;E=h.nextSibling;)d.after(E,T),T=E;d.after(h,a)}for(m=n.querySelectorAll("."+r.CLASS.TODO_MAIN),t=0;t<m.length;t++)p=m[t],f.fixMain(p);for(u=n.querySelectorAll("."+r.CLASS.TODO_CHECKBOX),t=0;t<u.length;t++)g=u[t],f.fixCheckbox(g,!1)},getCheckbox:function(e){return e?e.querySelector("."+r.CLASS.TODO_CHECKBOX):null},getCheckId:function(){return"wiz_todo_"+Date.now()+"_"+Math.floor(1e6*Math.random()+1)},getContainerFromChild:function(e){return e?d.getParentByFilter(e,function(e){return f.isLayer(e)},!0):null},getMainByCaret:function(){var e=c.getRange();if(!e)return null;var t=e.endContainer;return 1===t.nodeType&&(t=t.childNodes[e.endOffset]),f.getMainFromChild(t)},getMainFromChild:function(e){return e?d.getParentByFilter(e,function(e){return d.hasClass(e,r.CLASS.TODO_MAIN)},!0):null},getMainHtml:function(){var e='<span class="'+r.CLASS.TODO_MAIN+" "+r.CLASS.TODO_UNCHECKED+'"><input readonly id="%1" class="'+r.CLASS.TODO_CHECKBOX+" "+r.CLASS.IMG_NOT_DRAG+'" '+r.ATTR.TODO_CHECK+'="unchecked" /></span>';return e=e.replace("%1",f.getCheckId())},getMainInDom:function(e){return e&&e.hasChildNodes()?f.isMain(e)?e:f.isLayer(e)?e.querySelector("."+r.CLASS.TODO_MAIN):null:null},getUserInfoInDom:function(e){return e.querySelector("."+r.CLASS.TODO_USER_INFO)},getUserInfoHtml:function(e,t,n){var o='<span class="'+r.CLASS.TODO_ACCOUNT+'"><input readonly class="%1" />%2, </span><span class="'+r.CLASS.TODO_DATE+'">%3.</span>',i=r.CLASS.TODO_USER_AVATAR+l.encode(e);return o.replace("%1",r.CLASS.IMG_NOT_DRAG+" "+r.CLASS.TODO_AVATAR+" "+i).replace("%2",t).replace("%3",n)},getTime:function(){function e(e){return(e<10?"0":"")+e}var t,n,o=new Date;return n=e(o.getHours())+":"+e(o.getMinutes()),t="en"==a.version?a.Month[o.getMonth()]+" "+o.getDate()+", "+o.getFullYear()+" at "+n:o.getFullYear()+a.Date.Year+(o.getMonth()+1)+a.Date.Month+o.getDate()+a.Date.Day+" "+n},insertToMain:function(e,t){if(e&&t){var n,o,r=null;for(n=e.length-1;n>=0;n--)o=e[n],f.clearTodoClass(o),t.insertBefore(o,r),r=o}},isCaretAfterCheckbox:function(){var e=c.getRange();if(!e)return!1;var t,n,o,r;if(r=f.getMainByCaret(),!r)return!1;if(e.collapsed){if(t=e.startContainer,n=e.startOffset,1===t.nodeType)t=t.childNodes[e.startOffset];else if(3==t.nodeType&&n>0)return!1;return o=d.getPreviousNode(t,!1,r),f.isCheckbox(o)}return!1},isCaretBeforeCheckbox:function(){var e={enable:!1,checkbox:null},t=c.getRange();if(!t)return e;var n=t.endContainer;return 1===n.nodeType?n=n.childNodes[t.endOffset]:3===n.nodeType&&d.isEmptyDom(n)&&t.endOffset==n.nodeValue.length&&!f.getContainerFromChild(n)&&(n=d.getNextNode(n,!1),n&&(n=d.getParentByFilter(n,function(e){return f.isLayer(e)},!0))),f.isLayer(n)||f.isMain(n)?(e.enable=!0,e.checkbox=f.getCheckbox(n)):f.isCheckbox(n)&&(e.enable=!0,e.checkbox=n),e},isCheckbox:function(e){return d.hasClass(e,r.CLASS.TODO_CHECKBOX)},isEmptyContainer:function(e){if(!e)return!0;var t,n,o=e.childNodes;for(t=0;t<o.length;t++)if(n=o[t],f.isMain(n)){if(!f.isEmptyMain(n))return!1}else if(!d.isEmptyDom(n))return!1;return!0},isEmptyMain:function(e){if(!e)return!0;var t,n,o=e.childNodes;for(t=0;t<o.length;t++)if(n=o[t],!f.isCheckbox(n)&&!d.isEmptyDom(n))return!1;return!0},isMain:function(e){return d.hasClass(e,r.CLASS.TODO_MAIN)},isLayer:function(e){return d.hasClass(e,r.CLASS.TODO_LAYER)},isTodoTag:function(e){return!!e&&(f.isMain(e)||f.isUserInfo(e)||d.hasClass(e,r.CLASS.TODO_ACCOUNT)||d.hasClass(e,r.CLASS.TODO_DATE))},isUserInfo:function(e){return d.hasClass(e,r.CLASS.TODO_USER_INFO)},setTodo:function(e,t){var n,i,a,l,s,g,m,p,h,T,E=c.getRange(),v=[];if(e)i=e;else{if(!E)return null;if(n=c.getRangeDomList({noSplit:!0}),d.packageByDiv(n.startDom),i=d.getBlockParent(n.startDom,!0)||o.doc.body,!E.collapsed&&n.endDom!=n.startDom&&(a=d.getBlockParent(n.endDom,!0)||o.doc.body,a!=i))return null;var b=d.getPrevBlock(n.startDom),y=d.getNextBlock(n.startDom);y&&y!==i&&(d.splitDom(i,y),d.isTag(y,"br")&&y.parentNode.removeChild(y)),b&&b!==i&&(i=d.splitDom(i,b),d.isTag(b,"br")?b.parentNode.removeChild(b):d.before(b,i))}s=f.getMainInDom(i),g=f.getUserInfoInDom(i),u.saveSnap(!1);var A=!!f.getCheckbox(s);if((s||g)&&f.cancelTodo(i),A)return null;for(l=f.getMainHtml(),m=o.doc.createElement("div"),d.addClass(m,r.CLASS.TODO_LAYER),f.canBeContainer(i)?d.addClass(i,r.CLASS.TODO_LAYER):l='<div class="'+r.CLASS.TODO_LAYER+'">'+l+"</div>",m.innerHTML=l,s=f.getMainInDom(m),a=s.lastChild,h=0,T=i.childNodes.length;h<T&&(p=i.childNodes[h],!d.isBlockDom(p));h++)v.push(p);for(f.insertToMain(v,s);m.lastChild;)i.insertBefore(m.lastChild,i.firstChild);return d.isSelfClosingTag(a)?c.setRange(a.parentNode,d.getDomIndex(a)+1):c.setRange(a,d.getEndOffset(a)),t.setDocumentType(r.TYPE.TODO),f.checkTodoStyle(!1),s},setUserAvatarStyle:function(e,t){var n=l.encode(e),i=r.ID.TODO_AVATAR_STYLE+n,a=r.CLASS.TODO_USER_AVATAR+n,c=o.doc.getElementById(i);if(!c)return(c=o.win.parent.document.getElementById(i))?void s.insertStyle({id:i},c.innerHTML):void d.convertImageToBase64(t,50,50,function(e){var t=o.doc.getElementById(i);t||s.insertStyle({id:i},"."+a+"{background-image:url("+e+");}")})},oldPatch:{fixImg:function(e){if(e){var t=o.doc.createElement("input");t.className=e.className,d.removeClass(t,r.CLASS.TODO_CHECK_IMG_OLD),d.addClass(t,r.CLASS.TODO_CHECKBOX),t.readOnly=!0,e.id&&(t.id=e.id),e.getAttribute("state")&&t.setAttribute(r.ATTR.TODO_CHECK,e.getAttribute("state"));var n=e.parentNode;n.insertBefore(t,e),n.removeChild(e)}},fixLabel:function(e){if(e&&(d.removeClass(e,r.CLASS.TODO_LABEL_OLD),d.addClass(e,r.CLASS.TODO_MAIN),d.hasClass(e,r.CLASS.TODO_CHECKED_OLD)?(d.removeClass(e,r.CLASS.TODO_CHECKED_OLD),d.addClass(e,r.CLASS.TODO_CHECKED)):d.hasClass(e,r.CLASS.TODO_UNCHECKED_OLD)&&(d.removeClass(e,r.CLASS.TODO_UNCHECKED_OLD),d.addClass(e,r.CLASS.TODO_UNCHECKED))),e&&!d.isTag(e,"span")){var t=e.parentNode;if(t){var n=o.doc.createElement("span");for(n.className=e.className;e.firstChild;)n.appendChild(e.firstChild);t.insertBefore(n,e),t.removeChild(e)}}},fixOldTodo:function(){var e,t,n,i,a,l,s,c,u,g,m,p;for(s=o.doc.querySelectorAll("."+r.CLASS.TODO_CHECK_IMG_OLD),e=s.length-1;e>=0;e--)c=s[e],g=f.oldPatch.getLabelFromChild(c),g&&g.children[0]==c||f.fixCheckbox(c,!0),f.oldPatch.fixImg(c);for(u=o.doc.querySelectorAll("."+r.CLASS.TODO_LABEL_OLD),e=0;e<u.length;e++){for(g=u[e],a=f.oldPatch.packageTodo(g),d.addClass(a,r.CLASS.TODO_LAYER),n=a.querySelectorAll("."+r.CLASS.TODO_LABEL_OLD),t=n.length-1;t>0;t--)i=n[t],l=f.oldPatch.packageTodo(i),d.after(l,a);f.oldPatch.fixUserInfo(g)}for(u=o.doc.querySelectorAll("."+r.CLASS.TODO_LABEL_OLD),e=u.length-1;e>=0;e--)f.oldPatch.fixLabel(u[e]);for(m=o.doc.querySelectorAll("."+r.CLASS.TODO_TAIL_OLD),e=m.length-1;e>=0;e--)p=m[e],d.isEmptyDom(p)?p.parentNode.removeChild(p):d.removeClass(r.CLASS.TODO_TAIL_OLD)},fixUserInfo:function(e){var t,n,o=e.parentNode,i=f.oldPatch.getCheckImg(e),a=i?i.id:"",l=o.childNodes,s=!1;for(n=0;n<l.length;n++)t=l[n],d.hasClass(t,r.CLASS.TODO_USER_INFO)&&(s?(o.removeChild(t),n--):(s=!0,t.setAttribute(r.ATTR.TODO_ID,a)))},getCheckImg:function(e){return e?e.querySelector("."+r.CLASS.TODO_CHECK_IMG_OLD):null},getLabelFromChild:function(e){return e?d.getParentByFilter(e,function(e){return d.hasClass(e,r.CLASS.TODO_LABEL_OLD)},!0):null},isFirstLabel:function(e){if(!e)return!1;var t,n,o=e.parentNode,r=o.childNodes;for(t=0;t<r.length;t++){if(n=r[t],n===e)return!0;if(!d.isEmptyDom(n))return!1}return!1},packageTodo:function(e){if(!e)return null;var t=e.parentNode;if(t!==o.doc.body&&f.oldPatch.isFirstLabel(e))return t;var n,i=f.oldPatch.getCheckImg(e),a=i?i.id:"",l=a?t.querySelector("span["+r.ATTR.TODO_ID+"="+a+"]"):null,s=e.nextSibling,d=o.doc.createElement("div");for(d.appendChild(e);s;)n=s.nextSibling,d.appendChild(s),s=s==l?null:n;return t.insertBefore(d,n),d}}};t.exports=f},{"../common/const":15,"../common/env":17,"../common/historyUtils":18,"../common/lang":19,"../common/wizStyle":22,"../domUtils/domExtend":26,"../rangeUtils/rangeExtend":41,"./../common/base64":14}],52:[function(e,t,n){"use strict";var o=e("../common/env"),r=e("../common/const"),i=(e("../common/utils"),e("../domUtils/domExtend"),e("../rangeUtils/rangeExtend"),e("../common/historyUtils"),e("./wizBlockUtils")),a={bind:function(){a.unbind(),o.client.type.isPhone||o.client.type.isPad?o.event.add(r.EVENT.ON_TOUCH_START,a.handler.onMouseDown):o.event.add(r.EVENT.ON_MOUSE_DOWN,a.handler.onMouseDown)},unbind:function(){o.event.remove(r.EVENT.ON_TOUCH_START,a.handler.onMouseDown),o.event.remove(r.EVENT.ON_MOUSE_DOWN,a.handler.onMouseDown)},handler:{onMouseDown:function(e){var t="mousedown"!==e.type||0===e.button||1===e.button;t&&i.checkAndInsertEmptyLine(e)}}},l={on:function(){o.readonly||a.bind()},off:function(){a.unbind()}};t.exports=l},{"../common/const":15,"../common/env":17,"../common/historyUtils":18,"../common/utils":21,"../domUtils/domExtend":26,"../rangeUtils/rangeExtend":41,"./wizBlockUtils":53}],53:[function(e,t,n){"use strict";function o(e,t,n){for(var o,r,i=!1,a=!1,s=e?c.getFirstDeepChild(l.doc.body):c.getLastDeepChild(l.doc.body);s&&!c.canEdit(s);)s=e?c.getNextNodeCanEdit(s,!1):c.getPreviousNodeCanEdit(s,!1);return s&&(3==s.nodeType&&(s=s.parentNode),o=c.getOffset(s),r=c.getParentByFilter(s,n,!0),e&&t<o.top&&r?i=!0:!e&&t>o.top+s.offsetHeight&&r?a=!0:s=null),{container:r,isFirst:i,isLast:a}}function r(e){return c.hasClass(e,s.CLASS.CODE_CONTAINER_OLD)||c.hasClass(e,s.CLASS.TABLE_CONTAINER)}function i(e){return c.getParentByFilter(e,r,!0)}function a(e){return c.hasClass(e,s.CLASS.CODE_CONTAINER_OLD)||c.hasClass(e,s.CLASS.TABLE_CONTAINER)||c.hasClass(e,s.CLASS.TABLE_BODY)}var l=e("../common/env"),s=e("../common/const"),d=e("../common/utils"),c=e("../domUtils/domExtend"),u=e("../tableUtils/tableZone"),f=e("../rangeUtils/rangeExtend"),g={checkAndInsertEmptyLine:function(e){var t,n,s,u,f=e.changedTouches?e.changedTouches[0]:null,m=f?f.target:e.target,p=d.getEventClientPos(e),h=l.doc.body.scrollTop+p.y,T=!1,E=!1;m===l.doc.body||m===l.doc.body.parentNode?(m===l.doc.body&&(s=o(!0,h,r),E=s.isFirst,n=s.container),E||(s=o(!1,h,r),T=s.isLast,n=s.container)):a(m)&&(n=i(m),u=0,n&&(u=h-c.getOffset(n).top),n&&u<15?(t=c.getPreviousNodeCanEdit(m,!1),t&&!i(t)||(E=!0)):n&&m.offsetHeight-u<15&&(t=c.getNextNodeCanEdit(m,!1),t&&!i(t)||(T=!0))),n&&(T||E)?g.insertEmptyLine(n,T):t=null},insertEmptyLine:function(e,t){if(e){var n=l.doc.createElement("div"),o=l.doc.createElement("br");n.appendChild(o),c.before(n,e,t),u.clear(),f.setRange(o,0)}}};t.exports=g},{"../common/const":15,"../common/env":17,"../common/utils":21,"../domUtils/domExtend":26,"../rangeUtils/rangeExtend":41,"../tableUtils/tableZone":48}],54:[function(e,t,n){"use strict";var o=e("./common/env"),r=e("./WizEditor"),i=e("./WizReader"),a=e("./todoUtils/todoRouteForClient"),l=r.init;r.init=function(e){return l(e),i.init(),o.win.initForWebEngine=function(){a.setQtEditor()},r},t.exports=r},{"./WizEditor":5,"./WizReader":6,"./common/env":17,"./todoUtils/todoRouteForClient":50}]},{},[54]);